angular.module("module.wireless.rogueAp",[]).controller("RogueApViewController",["$scope","singleModal","authentifiedRequest","InterService","batchSyncConfig",function(e,t,n,a,i){function r(e){var t=new Object;t.key=e[0].hapMac,t.total=0,t.values=[["Interfering AP",0],["Rogue AP",0]];for(var n=0;n<e.length;n++)0===e[n].TYPE?t.values[0][1]++:t.values[1][1]++,t.total++;s.push(t)}e.rogueApParams={suppressSwitch:!1,blackSwitch:!1},e.noDataInfo={type:"chart",value:""},e.rogueApData=[],e.toolTipContentFunction=function(){return function(e,t,n,a,i){return"<b>"+e+"</b> have <b>"+parseInt(n)+"</b> "+t}},e.yAxisTickFormatFunction=function(){return function(e){return parseInt(e)}};var s=[];e.sortRogueApData=function(t){0==t.length?(e.noDataInfo.type="error",e.noDataInfo.value="The background scanning is temporarily stopped to guarantee the quality of service, no unknown AP information available."):(t.sort(function(e,t){return t.total-e.total}),e.rogueApData=t.slice(0,5))},e.toggleManager.rogueApInit=function(){e.suppressQuery(),e.query()},e.suppressQuery=function(){var t={};n.get("/rogueApSwitch",t,function(t,n){200==n&&null!=t&&t.success&&(e.rogueApParams=t.result)},function(){})},e.query=function(){var t={},i=!0;s=[];for(var o=a.getCanConfigAps(),l=0;l<o.length&&i;l++){var c=o[l].ip;mac=o[l].mac;var u="http://"+c+":8080/rogueAps/"+mac;n.get(u,t,function(t,n){200==n&&null!=t?t.success?(r(t.result),e.noDataInfo.type="chart",e.noDataInfo.value=""):"error1"==t.result?(e.noDataInfo.type="error",e.noDataInfo.value="The background scanning is temporarily stopped to guarantee the quality of service or it's turned OFF, no unknown AP information available.",i=!1):"error2"==t.result&&(e.noDataInfo.type="error",e.noDataInfo.value="The background scanning is turned OFF, no unknown AP information available.",i=!1):(e.noDataInfo.type="error",e.noDataInfo.value="The background scanning is temporarily stopped to guarantee the quality of service or it's turned OFF, no unknown AP information available.",i=!1),l==o.length&&i&&e.sortRogueApData(s)},function(){})}},e.modal=null,e.openConfigPage=function(){t.open({templateUrl:"wireless/rogue-ap/rogue-ap-conf.html",controller:"RogueApConfController",size:"lg",backdrop:!0})},e.configSuppressSwitch=function(){var t,n=JSON.stringify(e.rogueApParams);t=e.rogueApParams.suppressSwitch?"rogueAp_edit_suppressSwitch_1":"rogueAp_edit_suppressSwitch_2",i.request("put","/suppressSwitch",null,n,function(){e.suppressQuery()},null,t)},e.configBlackSwitch=function(){var t,n=JSON.stringify(e.rogueApParams);t=e.rogueApParams.blackSwitch?"rogueAp_edit_blackSwitch_1":"rogueAp_edit_blackSwitch_2",i.request("put","/blackSwitch",null,n,function(){e.suppressQuery()},null,t)}}]),angular.module("module.wireless.rogueAp").filter("typeFilter",[function(){var e=function(e){switch(e){case 1:return"Rogue";case 0:return"Interfering"}};return e}]).filter("distanceFilter",[function(){var e=function(e){return 25>e?"farest":e>=25&&50>=e?"far":e>=51&&75>=e?"near":"nearest"};return e}]).filter("authTypeFilter",[function(){var e=function(e){switch(e){case 0:return"open";case 1:return"shared-key";case 2:return"WPA";case 3:return"WPA2/RSNA";case!1:return"WAPI"}};return e}]).filter("alreadyInBlackFilter",[function(){var e=function(e){switch(e){case 1:return"Yes";case 0:return"No"}};return e}]).controller("RogueApConfController",["$scope","$modalInstance","$translate","authentifiedRequest","InterService","batchSyncConfig","toastr",function(e,t,n,a,i,r,s){function o(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,n={},a=t.search.replace(/^\?/,"").split("&"),i=a.length,r=0;i>r;r++)a[r]&&(e=a[r].split("="),n[e[0]]=e[1]);return n}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}}function l(e,t){for(var n=0;n<e.length;n++)if(t==e[n].ip)return e[n]}e.skin=i.skin,e.InterService=i,e.whiteListParams={},e.dynamicBlackListParams={},Array.prototype.remove=function(e){if(isNaN(e)||e>this.length)return!1;for(var t=0,n=0;t<this.length;t++)this[t]!=this[e]&&(this[n++]=this[t]);this.length-=1},e.removeDuplicates=function(t){for(var n=angular.copy(e.rogueApListParams),a=0;a<t.length;a++)for(var i=t[a].MAC,r=t[a].SSID,s=t[a].RSSI,o=0;o<n.length;o++)if(i==n[o].MAC&&r==n[o].SSID){s>n[o].RSSI?(n.remove(o),o--):(t.remove(a),a--);break}return n.concat(t)},e.rogueApListParams=[],e.query=function(){for(var t={},n=!0,r=i.getCanConfigAps(),s=0;s<r.length;s++){var c=r[s].ip,u=r[s].mac,p="http://"+c+":8080/rogueAps/"+u;a.get(p,t,function(t,a,i,s){if(200==a&&null!=t&&t.success){for(var c=0;c<t.result.length;c++){var u=o(s.url).host,p=l(r,u);t.result[c].apInfo=p.apname,t.result[c].apName=p.name}0==e.rogueApListParams.length?e.rogueApListParams=angular.copy(t.result):e.rogueApListParams=e.removeDuplicates(t.result),n&&t.result.length>0&&(0==e.whiteList&&0==e.dynamicBlackList&&(e.rogueApDetail=!0),e.currentRogueAP=e.rogueApListParams[0],n=!1)}},function(){})}},e.query(),e.queryWhiteList=function(){var t={};a.get("/rogueApWhiteList",t,function(t,n){200==n&&null!=t&&t.success&&(e.whiteListParams=t.result)},function(){})},e.cancel=function(){e.rogueApDetail=!1,e.rogueApClientNum=!1,e.whiteList=!1,e.dynamicBlackList=!1,t.close()},e.rogueApDetail=!1,e.rogueApClientNum=!1,e.whiteList=!1,e.dynamicBlackList=!1,e.showDetail=function(t){e.rogueApDetail=!0,e.rogueApClientNum=!1,e.whiteList=!1,e.dynamicBlackList=!1,e.currentRogueAP=t},e.submitPara={},e.showWhiteList=function(){e.rogueApDetail=!1,e.rogueApClientNum=!1,e.whiteList=!0,e.dynamicBlackList=!1,e.submitPara.whitelistValue="",e.queryWhiteList()},e.isWhiteListRepeat=function(e,t){for(var n=0;n<e.length;n++)if(t==e[n].whitelistMac)return!0;return!1},e.addWhitelist=function(){e.parasedSubmitPara={whitelistValue:""};var t=e.submitPara.whitelistValue;if(t){var a=RegExp(":","gi"),i=0,o=t.match(a);switch(i=null==o?0:o.length){case 0:e.parasedSubmitPara.whitelistValue=t.concat(":*:*:*:*:*");break;case 1:e.parasedSubmitPara.whitelistValue=t.concat(":*:*:*:*");break;case 2:e.parasedSubmitPara.whitelistValue=t.concat(":*:*:*");break;case 3:e.parasedSubmitPara.whitelistValue=t.concat(":*:*");break;case 4:e.parasedSubmitPara.whitelistValue=t.concat(":*");break;case 5:e.parasedSubmitPara.whitelistValue=t}var l=JSON.stringify(e.parasedSubmitPara),c=e.parasedSubmitPara.whitelistValue.toLowerCase(),u=e.isWhiteListRepeat(e.whiteListParams.whitelist,c);if(u)s.info(n.instant("whiteListMacRepeat"),"");else if(20==e.whiteListParams.whitelistNum)s.info(n.instant("whiteListMacAlready20"),"");else{var p="rogueAp_add_whiteList",d=e.parasedSubmitPara.whitelistValue;r.request("post","/rogueApWhiteList",null,l,function(){e.queryWhiteList(),e.rogueApListParams=[],e.query()},null,p,null,d)}e.submitPara.whitelistValue=""}},e.trust=function(t){var a={whitelistValue:t},i="rogueAp_add_whiteList",s=t,o=n.instant("trustThisAp")+"("+t+")?";bootbox.confirm(o,function(t){t&&r.request("post","/rogueApWhiteList",null,a,function(){e.queryWhiteList(),e.rogueApListParams=[],e.query()},null,i,null,s)})},e.deleteWhitelist=function(t){var a="rogueAp_delete_whiteList",i=t,s=n.instant("deleteWhiteListMac")+t+"?";bootbox.confirm(s,function(n){n&&r.request("delete","/rogueApWhiteList/"+t,null,null,function(){e.queryWhiteList(),e.rogueApListParams=[],e.query()},null,a,null,i)})},e.showDynamicBlackList=function(){e.rogueApDetail=!1,e.rogueApClientNum=!1,e.whiteList=!1,e.dynamicBlackList=!0,e.queryDynamicBlackList()},e.queryDynamicBlackList=function(){var t={};a.get("/rogueApDynamicBlackList",t,function(t,n){200==n&&null!=t&&t.success&&(e.dynamicBlackListParams=t.result)},function(){})},e.deleteDynamicBlackList=function(t){var a="rogueAp_delete_blackList",i=t,s=n.instant("deleteBlackListMac")+t+"?";bootbox.confirm(s,function(n){n&&r.request("delete","/rogueApDynamicBlackList/"+t,null,null,function(){e.queryDynamicBlackList(),e.rogueApListParams=[],e.query()},null,a,null,i)})}}]),angular.module("module.wireless.rfManagement",[]).controller("RfManagementViewController",["$scope","singleModal","authentifiedRequest","InterService",function(e,t,n,a){function i(t){e.twoChannelData=[],e.fiveChannelData=[];for(var n=0;n<t.length;n++){var a=t[n].channel_2g,i=t[n].channel_5g,r=new Object,s=new Object;if(0==n)r.key=a,r.y=1,e.twoChannelData.push(r),s.key=i,s.y=1,e.fiveChannelData.push(s);else{for(var o=0;o<e.twoChannelData.length;o++){var l=e.twoChannelData[o];if(a==l.key){l.y++;break}}o==e.twoChannelData.length&&(r.key=a,r.y=1,e.twoChannelData.push(r));for(var c=0;c<e.fiveChannelData.length;c++){var u=e.fiveChannelData[c];if(i==u.key){u.y++;break}}c==e.fiveChannelData.length&&(s.key=i,s.y=1,e.fiveChannelData.push(s))}}"2.4G"==e.RF.type&&(0==e.twoChannelData?e.RF.noData=!0:e.RF.noData=!1),"5G"==e.RF.type&&(0==e.fiveChannelData?e.RF.noData=!0:e.RF.noData=!1)}e.RF={type:"2.4G",noData:!1},e.twoChannelData=[],e.fiveChannelData=[],e.xFunction=function(){return function(e){return e.key}},e.yFunction=function(){return function(e){return e.y}},e.toolTipContentFunction=function(){return function(e,t,n,a,i){return"<p> Channel <b>"+e+"</b> have <b>"+parseInt(t)+"</b> RF</p>"}},e.toggleManager.rfInit=function(){for(var e={},t=[],r=a.getCanConfigAps(),s=0;s<r.length;s++){var o=r[s].ip,l="http://"+o+":8080/rf";n.get(l,e,function(e,n){200==n&&null!=e&&e.success&&t.push(e.result),s==r.length&&i(t)},function(){})}},e.modal=null,e.openConfigPage=function(){t.open({templateUrl:"wireless/rf-management/rf-management-conf.html",controller:"RfManagementConfController",size:"lg",backdrop:!0},function(t){e.toggleManager.rfInit()},function(t){e.toggleManager.rfInit()})}}]),angular.module("module.wireless.rfManagement").filter("channelPowerFilter",[function(){var e=function(e){return null===e?"waiting":e};return e}]).controller("RfManagementConfController",["$scope","$modalInstance","authentifiedRequest","InterService","lockScreen","operationLog","toastr","$translate",function(e,t,n,a,i,r,s,o){function l(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,n={},a=t.search.replace(/^\?/,"").split("&"),i=a.length,r=0;i>r;r++)a[r]&&(e=a[r].split("="),n[e[0]]=e[1]);return n}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}}function c(e,t){for(var n=0;n<e.length;n++)if(t==e[n].ip)return e[n]}e.skin=a.skin,e.InterService=a,e.apListParams={},e.Channel0_US=[1,2,3,4,5,6,7,8,9,10,11],e.Channel0_JP=[1,2,3,4,5,6,7,8,9,10,11,12,13,14],e.Channel0_DE=[1,2,3,4,5,6,7,8,9,10,11,12,13],e.Channel0_CS=[],e.Channel1_US=[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,149,153,157,161],e.Channel1_CA=[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,132,136,140,149,153,157,161,165],e.Channel1_JP=[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,132,136,140],e.Channel1_KR=[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,132,136,140,149,153,157,161],e.Channel1_CN=[36,40,44,48,52,56,60,64,149,153,157,161,165],e.Channel1_TW=[56,60,64,100,104,108,112,116,120,124,128,132,136,140,149,153,157,161,165],e.Channel1_IL=[36,40,44,48,52,56,60,64],e.Channel1_BO=[52,56,60,64,140,149,153,157,161,165],e.Channel1_ID=[149,153,157,161],e.Channel1_PK=[149,153,157,161,165],e.Channel1_DZ=[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,132],e.ChannelScope0=[],e.select2gChannelScope=function(t){switch(t){case"JP":e.ChannelScope0=e.Channel0_JP;break;case"DE":case"NL":case"IT":case"PT":case"LU":case"NO":case"FI":case"DK":case"CH":case"CZ":case"ES":case"GB":case"KR":case"CN":case"FR":case"HK":case"SG":case"BR":case"IL":case"SA":case"LB":case"AE":case"ZA":case"AR":case"AU":case"AT":case"BO":case"CL":case"GR":case"IS":case"IN":case"KW":case"LI":case"LT":case"MX":case"MA":case"NZ":case"PL":case"SK":case"EE":case"MU":case"RO":case"ID":case"PE":case"VE":case"JM":case"BH":case"OM":case"JO":case"CO":case"GT":case"PH":case"LK":case"SV":case"TN":case"PK":case"QA":case"DZ":e.ChannelScope0=e.Channel0_DE;break;case"CS":e.ChannelScope0=e.Channel0_CS;break;default:e.ChannelScope0=e.Channel0_US}},e.ChannelScope1=[],e.select5gChannelScope=function(t){switch(t){case"CA":case"HK":case"SG":case"BR":case"LB":case"AE":case"ZA":case"AR":case"AU":case"MX":case"NZ":case"PR":case"MU":case"CS":case"PE":case"JM":case"BM":case"CO":case"PH":case"LK":e.ChannelScope1=e.Channel1_CA;break;case"JP":case"DE":case"NL":case"IT":case"PT":case"LU":case"NO":case"FI":case"DK":case"CH":case"CZ":case"ES":case"GB":case"FR":case"SA":case"AT":case"GR":case"IS":case"LI":case"LT":case"PL":case"SK":case"EE":case"RO":case"OM":case"GT":e.ChannelScope1=e.Channel1_JP;break;case"KR":e.ChannelScope1=e.Channel1_KR;break;case"CN":case"CL":case"IN":case"VE":case"BH":case"DO":case"SV":e.ChannelScope1=e.Channel1_CN;break;case"TW":e.ChannelScope1=e.Channel1_TW;break;case"IL":case"KW":case"MA":case"TN":e.ChannelScope1=e.Channel1_IL;break;case"BO":e.ChannelScope1=e.Channel1_BO;break;case"ID":e.ChannelScope1=e.Channel1_ID;break;case"PK":case"QA":e.ChannelScope1=e.Channel1_PK;break;case"DZ":e.ChannelScope1=e.Channel1_DZ;break;default:e.ChannelScope1=e.Channel1_US}},e.initDivShow=function(){e.rfDetail=!1,e.rfEdit=!1},e.initDivShow(),e.apListParams=[],e.query=function(t){for(var i={},r=!0,s=a.getCanConfigAps(),o=0;o<s.length;o++){var u=s[o].ip,p="http://"+u+":8080/rf";n.get(p,i,function(n,a,i,o){if(200==a&&null!=n&&n.success){var u=l(o.url).host,p=c(s,u);n.result.host=p.ip,n.result.apInfo=p.apname,n.result.apName=p.name,n.result.mac=p.mac,e.apListParams.push(n.result),r&&(e.rfDetail=!0,""!=t&&t==mac?e.currentAP=n.result:""==t&&(e.currentAP=e.apListParams[0]),r=!1)}},function(){})}},e.query(""),e.newCurrentAP={},e.save=function(){i.lock();var t=e.currentAP.host,a="http://"+t+":8080/rf",l={};e.newCurrentAP.host=e.currentAP.host,e.newCurrentAP.apInfo=e.currentAP.apInfo,e.newCurrentAP.apName=e.currentAP.apName,e.newCurrentAP.mac=e.currentAP.mac,e.newCurrentAP.country=e.currentAP.country,e.oldAP.acsSwitch_2g!=e.currentAP.acsSwitch_2g?"ON"==e.currentAP.acsSwitch_2g?e.newCurrentAP.channel_2g="auto":e.newCurrentAP.channel_2g=e.currentAP.channel_2g:e.oldAP.channel_2g!=e.currentAP.channel_2g&&"OFF"==e.currentAP.acsSwitch_2g&&(e.newCurrentAP.channel_2g=e.currentAP.channel_2g),e.oldAP.acsSwitch_5g!=e.currentAP.acsSwitch_5g?"ON"==e.currentAP.acsSwitch_5g?e.newCurrentAP.channel_5g="auto":e.newCurrentAP.channel_5g=e.currentAP.channel_5g:e.oldAP.channel_5g!=e.currentAP.channel_5g&&"OFF"==e.currentAP.acsSwitch_5g&&(e.newCurrentAP.channel_5g=e.currentAP.channel_5g),e.oldAP.apcSwitch_2g!=e.currentAP.apcSwitch_2g?"ON"==e.currentAP.apcSwitch_2g?e.newCurrentAP.power_2g="auto":e.newCurrentAP.power_2g=e.currentAP.power_2g:e.oldAP.power_2g!=e.currentAP.power_2g&&"OFF"==e.currentAP.apcSwitch_2g&&(e.newCurrentAP.power_2g=e.currentAP.power_2g),e.oldAP.apcSwitch_5g!=e.currentAP.apcSwitch_5g?"ON"==e.currentAP.apcSwitch_5g?e.newCurrentAP.power_5g="auto":e.newCurrentAP.power_5g=e.currentAP.power_5g:e.oldAP.power_5g!=e.currentAP.power_5g&&"OFF"==e.currentAP.apcSwitch_5g&&(e.newCurrentAP.power_5g=e.currentAP.power_5g);var c=JSON.stringify(e.newCurrentAP);n.put(a,l,c,function(n){i.unlock(),e.initDivShow(),e.rfDetail=!0,e.apListParams=[],e.query(e.currentAP.mac),e.newCurrentAP={};var a="rf_edit",l=e.currentAP.mac,c=[{ip:t,success:"module_operate_failure",msg:""}];null==n||""==n?(c[0].success="module_operate_failure",c[0].msg="log_backendServer_error",s.info(o.instant("log_backendServer_error"))):(n.success?c[0].success="module_operate_success":c[0].success="module_operate_failure",c[0].msg=n.msg,s.info(o.instant(n.msg))),r.setLog(a,c,l)},function(){i.unlock()})},e.cancel=function(){t.close()},e.showDetail=function(t){e.rfDetail=!0,e.rfEdit=!1,e.currentAP=t},e.oldAP={},e.showEdit=function(t){e.rfDetail=!1,e.rfEdit=!0,e.currentAP=angular.copy(t),e.oldAP=angular.copy(t),e.select2gChannelScope(t.country),e.select5gChannelScope(t.country)}}]),angular.module("module.wireless.others",[]).controller("OthersViewController",["$scope","$modal","authentifiedRequest","batchSyncConfig","InterService",function(e,t,n,a,i){e.InterService=i,e.backgroupScanningParams={backgroupScanning:!1,scanInterval:5,foreignChannelDuration:20},e.bandSteeringParams={bandSteering:!1},e.awareParams={aware:!1},e.igmpSnoopingParams={snoopingSwitch:!1,mulitowuicastSwitch:!1,hostLifeAgeingTime:90},e.ARPProxySnooping={proxySwitch:!1},e.sliderParams={scanIntervalOptions:[5,6,7,8,9,10],foreignChannelOptions:[20,30,40,50,60],agingTimeOptions:[60,90,120,150,180]},e.setBackgroupSlider=function(){var t=e.backgroupScanningParams.scanInterval-5,n=e.backgroupScanningParams.foreignChannelDuration/10-2;$("#scan-interval-slider").slider("value",t),$("#foreign-channel-slider").slider("value",n),1==e.backgroupScanningParams.backgroupScanning?($("#scan-interval-slider").slider("enable"),$("#foreign-channel-slider").slider("enable")):($("#scan-interval-slider").slider("disable"),$("#foreign-channel-slider").slider("disable"))},e.setIGMPAgingTimgSlider=function(){var t=e.igmpSnoopingParams.hostLifeAgeingTime/30-2;$("#aging-time-slider").slider("value",t),1==e.igmpSnoopingParams.snoopingSwitch?$("#aging-time-slider").slider("enable"):$("#aging-time-slider").slider("disable")},e.igmpSnoopingQuery=function(){n.get("/network/igmpSnooping/confParams",null,function(t){null!=t&&t.success&&(e.igmpSnoopingParams=t.result,e.setIGMPAgingTimgSlider())},function(){})},e.ARPProxySnoopingQuery=function(){n.get("/network/arpProxy/confParams",null,function(t){null!=t&&t.success&&(e.ARPProxySnooping=t.result)},function(){})},e.toggleManager.otherInit=function(){e.BackgroundScanningQuery(),e.BandSteeringQuery(),e.AwareWirelessQuery(),e.igmpSnoopingQuery(),e.ARPProxySnoopingQuery()},e.BackgroundScanningQuery=function(){var t={};n.get("/backgroupScanning",t,function(t,n){200==n&&null!=t&&t.success&&(e.backgroupScanningParams=t.result,e.setBackgroupSlider())},function(){})},e.configBackgroupScanningSwtich=function(){var t,n=JSON.stringify(e.backgroupScanningParams);t=e.backgroupScanningParams.backgroupScanning?"other_wireless_edit_backgroupScanningSwitch_1":"other_wireless_edit_backgroupScanningSwitch_2",a.request("put","/backgroupScanningSwitch",null,n,function(){e.BackgroundScanningQuery()},null,t)},e.configScanInterval=function(){var t=JSON.stringify(e.backgroupScanningParams),n="other_wireless_edit_scanInterval",i=e.backgroupScanningParams.scanInterval;a.request("put","/scanInterval",null,t,function(){e.BackgroundScanningQuery()},null,n,null,i)};var r=e.backgroupScanningParams.scanInterval-5;$("#scan-interval-slider").slider({min:0,max:e.sliderParams.scanIntervalOptions.length-1,value:r}).slider("pips",{rest:"label",labels:e.sliderParams.scanIntervalOptions}).on("slidestop",function(t,n){$("#scanIntervalValue").text(e.sliderParams.scanIntervalOptions[n.value]),e.backgroupScanningParams.scanInterval=e.sliderParams.scanIntervalOptions[n.value],e.configScanInterval()}),e.configForeignChannelDuration=function(){var t=JSON.stringify(e.backgroupScanningParams),n="other_wireless_edit_foreignChannelDuration",i=e.backgroupScanningParams.foreignChannelDuration;a.request("put","/foreignChannelDuration",null,t,function(){e.BackgroundScanningQuery()},null,n,null,i)};var s=e.backgroupScanningParams.foreignChannelDuration/10-2;$("#foreign-channel-slider").slider({min:0,max:e.sliderParams.foreignChannelOptions.length-1,value:s}).slider("pips",{rest:"label",labels:e.sliderParams.foreignChannelOptions}).on("slidestop",function(t,n){$("#foreignChannelValue").text(e.sliderParams.foreignChannelOptions[n.value]),e.backgroupScanningParams.foreignChannelDuration=e.sliderParams.foreignChannelOptions[n.value],e.configForeignChannelDuration()}),e.BandSteeringQuery=function(){var t={};n.get("/bandSteering",t,function(t,n){200==n&&null!=t&&t.success&&(e.bandSteeringParams=t.result)},function(){})},e.configBandSteering=function(){var t,n=JSON.stringify(e.bandSteeringParams);t=e.bandSteeringParams.bandSteering?"other_wireless_edit_bandSteering_1":"other_wireless_edit_bandSteering_2",a.request("put","/bandSteering",null,n,function(){e.BandSteeringQuery()},null,t)},e.AwareWirelessQuery=function(){var t={};n.get("/aware",t,function(t,n){200==n&&null!=t&&t.success&&(e.awareParams=t.result)},function(){})},e.configAware=function(){var t,n=JSON.stringify(e.awareParams);t=e.awareParams.aware?"other_wireless_edit_aware_1":"other_wireless_edit_aware_2",a.request("put","/aware",null,n,function(){e.AwareWirelessQuery()},null,t)},e.igmpSnoopingParamChange=function(t){var n={igmpOption:t,igmpOptionValue:0},i="";switch(t){case"switch":e.igmpSnoopingParams.snoopingSwitch?(n.igmpOptionValue=1,i="other_log_igmpSnoopingSwitch_open"):(e.igmpSnoopingParams.mulitowuicastSwitch=!1,i="other_log_igmpSnoopingSwitch_close");break;case"multounicast":e.igmpSnoopingParams.mulitowuicastSwitch?(n.igmpOptionValue=1,i="other_log_MulticastToUnicastSwitch_open"):i="other_log_MulticastToUnicastSwitch_close";break;case"hostlifeinterval":n.igmpOptionValue=Number(e.igmpSnoopingParams.hostLifeAgeingTime),i="other_log_igmpSnoopingAgingTime_config"}a.request("put","/network/igmpSnooping/confParams",null,n,function(){e.igmpSnoopingQuery()},null,i)};var o=e.igmpSnoopingParams.hostLifeAgeingTime/30-2;$("#aging-time-slider").slider({min:0,max:e.sliderParams.agingTimeOptions.length-1,value:o}).slider("pips",{rest:"label",labels:e.sliderParams.agingTimeOptions}).on("slidestop",function(t,n){$("#age_value").text(e.sliderParams.agingTimeOptions[n.value]),e.igmpSnoopingParams.hostLifeAgeingTime=e.sliderParams.agingTimeOptions[n.value],e.igmpSnoopingParamChange("hostlifeinterval")}),e.ARPProxySnoopingChange=function(){var t={proxySwitch:0},n="other_log_proxySwitch_close";e.ARPProxySnooping.proxySwitch&&(t.proxySwitch=1,n="other_log_proxySwitch_open"),a.request("put","/network/arpProxy/confParams",null,t,function(){e.ARPProxySnoopingQuery()},null,n)}}]),angular.module("module.terminal.authentication",[]).controller("TerminalAuthViewController",["$scope","singleModal","authentifiedRequest","InterService","batchSyncConfig",function(e,t,n,a,i){e.InterService=a,e.aps=a.getCanConfigAps(),e.$watch("InterService",function(t,n){t!==n&&(e.aps=a.getCanConfigAps())},!0),e.Auth={type:"device"},e.deviceType=[],e.osType=[],e.xFunction=function(){return function(e){return e.key}},e.yFunction=function(){return function(e){return e.y}},e.toggleManager.getauthinfo=function(){e.deviceType=[],e.osType=[],i.getAll("/authclientinfo",null,function(t){var n=0;for(e.tempdev=[{key:"iPhone",y:0},{key:"iPad",y:0},{key:"Mobile",y:0},{key:"PC",y:0},{key:"Mac PC",y:0},{key:"unknown",y:0}],e.tempos=[{key:"IOS",y:0},{key:"Android",y:0},{key:"BlackBerry",y:0},{key:"Mac OS",y:0},{key:"Windows ME",y:0},{key:"Windows Server",y:0},{key:"Windows Vista",y:0},{key:"Windows XP",y:0},{key:"Windows 7",y:0},{key:"Windows 8",y:0},{key:"Windows 10",y:0},{key:"Linux",y:0},{key:"unknown",y:0}],n=0;n<t.length;n++)for(var a=0;a<t[n].length;a++)6>a?"devUnknown"==t[n][a].key?e.tempdev[5].y+=t[n][a].y:e.tempdev[a].key==t[n][a].key&&(e.tempdev[a].y+=t[n][a].y):e.tempos[a-6].key==t[n][a].key&&(e.tempos[a-6].y+=t[n][a].y);for(n=0;n<e.tempdev.length;n++)if(e.tempdev[n].y){e.deviceType=e.tempdev;break}for(n=0;n<e.tempos.length;n++)if(e.tempos[n].y){e.osType=e.tempos;break}})},e.toggleManager.AuthViewInit=function(){},e.openAuthenticationViewPageInit=function(){t.open({templateUrl:"terminal/authentication/authentication-conf.html",controller:"TerminalAuthConfController",size:"lg",backdrop:!0},function(t){e.toggleManager.getauthinfo()},function(t){e.toggleManager.AuthViewInit()})}}]),angular.module("module.terminal.authentication").controller("TerminalAuthConfController",["$scope","$modalInstance","$translate","authentifiedRequest","InterService","batchSyncConfig","FileUploader","toastr","hanCrypto","$http",function(e,t,n,a,i,r,s,o,l,c){e.skin=i.skin,e.InterService=i,e.aps=i.getCanConfigAps();var u="http://",p=":8080";e.$watch("InterService",function(t,n){t!==n&&(e.aps=i.getCanConfigAps())},!0),e.authenticationParams={CaptiveStatus:!1,CaptiveType:0,CaptiveTime:""},e.Authconf={type:"account"},e.CurrentWLANLists=["test","haplet","test2"],e.customized_portal=!1,e.add_local_auth_user=!1,e.add_access_code=!1,e.batch_import=!1,e.batch_code=!1,e.localuser_detail=!1,e.edit_local_auth_user=!1,e.modifybefore={},e.isGetTime=!0,e.localUserList=[],e.localUserListTemp={UserName:"",Password:"",PasswordConfirm:"","FirstName ":"",LastName:"",Mail:"",Phone:"",Company:"",StartingDate:"",EndingDate:""},e.accessCodeList=[],e.accessCodeTemp={access_code:""},e.tftpInfo={FTFPStatus:"",TFTPIp:"",TFTPCycle:"",TFTPIpManu:""},e.tftpCycle=[{name:"1h",value:"1"},{name:"2h",value:"2"},{name:"4h",value:"4"}],e.cycleLevel=e.tftpCycle[0],e.echoCycleLevels=function(t){1==t?e.cycleLevel=e.tftpCycle[0]:2==t?e.cycleLevel=e.tftpCycle[1]:4==t&&(e.cycleLevel=e.tftpCycle[2])},e.getcaptiveportalinfo=function(){a.get("/getauthswitch",null,function(t,n){200==n&&null!=t&&t.success&&(e.authenticationParams=t.result,e.isGetTime=!1,0==e.authenticationParams.CaptiveType?e.Authconf.type="account":1==e.authenticationParams.CaptiveType?e.Authconf.type="accesscode":2==e.authenticationParams.CaptiveType&&(e.Authconf.type="terms"))},function(){})},e.setPortalSwitch=function(){var t="access_captiveportal_switch",n=JSON.stringify(e.authenticationParams.CaptiveStatus);r.request("put","/setportalswitch",null,n,function(){e.getcaptiveportalinfo()},null,t)},e.setPortalType=function(t){var n="access_captiveportal_type",a=JSON.stringify(t);r.request("put","/setportaltype",null,a,function(){e.getcaptiveportalinfo()},null,n)},e.getLocalUser=function(){var t={};a.get("/userlist",t,function(t,n){if(200==n&&null!=t&&t.success&&(e.localUserList=t.result,null!=e.localUserList))for(var a=0;a<e.localUserList.length;a++)e.localUserList[a].Password=l.decoder(e.localUserList[a].Password)},function(){})},e.userFilterDuplicateObject=function(e,t){var n=!1,a=t;return $.each(e,function(e,t){return t.UserName==a.UserName?(n=!0,!1):void 0}),n},e.Add_Localauth_User=function(t){var a=$("#add_start_date_value").val(),i=$("#add_end_date_value").val(),s={};e.localUserListTemp.StartingDate=a,e.localUserListTemp.EndingDate=i,angular.copy(t,s);var c="access_addauthuser_2";if(null!=e.localUserList){var u=e.userFilterDuplicateObject(e.localUserList,s);if(1==u)return void o.info(n.instant("access_addauthuser_1"),"");if(""==s.StartingDate||""==s.EndingDate)return void o.info(n.instant("access_addauthuser_5"),"");if(e.authenticationParams.CaptiveTime>s.StartingDate&&s.StartingDate>s.EndingDate)return void o.info(n.instant("access_addauthuser_5"),"")}s.Password=l.encoder(s.Password);var p=JSON.stringify(s);r.request("put","/adduser",null,p,function(){e.getLocalUser()},null,c),$("form[name='add_localauth_user']")[0].reset(),e.Cancel()},e.Edit_localauth_user=function(t){var a=$("#edit_start_value").val(),i=$("#edit_end_value").val(),s="modify local auth user",c=[],u=e.modifybefore;if(t.StartingDate=a,t.EndingDate=i,""==t.StartingDate||""==t.EndingDate)return void o.info(n.instant("access_addauthuser_5"),"");if(e.authenticationParams.CaptiveTime>t.StartingDate&&t.StartingDate>t.EndingDate)return void o.info(n.instant("access_addauthuser_5"),"");u.Password=l.encoder(u.Password),t.Password=l.encoder(t.Password),c.push(u),c.push(t);var p=JSON.stringify(c);r.request("put","/modifyuser",null,p,function(){e.getLocalUser()},null,s),$("form[name='edit_localauth_user']")[0].reset(),e.Cancel()},e.usernum=0;var d=e.user=new s({removeAfterUpload:!1,headers:{Authorization:"sessionName "+window.localStorage.sessionId}});e.clearuser=function(){d.clearQueue()},d.onAfterAddingFile=function(t){var a=/[\S|\s]+.csv$/,i=a.test(t.file.name.toLowerCase());i||(e.clearuser(),o.info(n.instant("access_file_format_csv"),""))},d.onCompleteItem=function(t,a,i,r){if(e.usernum++,e.usernum<e.aps.length)e.importuser(d.queue[0]);else{e.usernum=0,e.getLocalUser();var s=n.instant("access_addauthuser_3")+a.total+" "+n.instant("access_addauthuser_4")+a.successTotal+"!";o.info(s,"")}},e.importuser=function(t){null!=e.aps&&(e.filename=t,d.queue[0].url=u+e.aps[e.usernum].ip+p+"/importuser/"+t.file.name,d.queue[0].upload())},e.downloadcsv=function(t){var a="Download account file template",i=[{ip:e.aps[0].ip,success:!1,msg:""}];bootbox.confirm(n.instant("access_download_account_file"),function(e){e&&c({method:"get",url:"/downloadcsv",headers:{Authorization:"sessionName "+window.localStorage.sessionId}}).success(function(e,t,n){var a="application/octet-stream",i=!1;n=n();var r=n["content-disposition"],s=new Array;s=r.split("=");var o=s[1],l=n["content-type"]||a;try{var c=new Blob([e],{type:l});if(navigator.msSaveBlob)navigator.msSaveBlob(c,o);else{var u=navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob;if(void 0===u)throw"Not supported";u(c,o),i=!0}}catch(p){}if(!i){var d=window.URL||window.webkitURL||window.mozURL||window.msURL;if(d){var f=document.createElement("a");if("download"in f)try{var c=new Blob([e],{type:l}),g=d.createObjectURL(c);f.setAttribute("href",g),f.setAttribute("download",o);var m=document.createEvent("MouseEvents");m.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(m),i=!0}catch(p){}if(!i)try{var c=new Blob([e],{type:a}),g=d.createObjectURL(c);window.location=g,i=!0}catch(p){}}}i||window.open(httpPath,"_blank","")}).error(function(e,t){i[0].success=!1,i[0].msg="Failed to communicate with the backend server !",operationLog.setLog(a,i),o.warning(n.instant("access_communicate_error"))})})},e.Delete_LocalUser=function(t){var a="access_delauthuser_1",i=n.instant("access_delauthuser_2")+t.UserName+"?";bootbox.confirm(i,function(n){if(n){t.Password=l.encoder(t.Password);var i=t;r.request("put","/deleteuser",null,i,function(){e.getLocalUser()},null,a)}})},e.getAccessCode=function(){var t={};a.get("/getaccesscode",t,function(t,n){if(200==n&&null!=t&&t.success&&(e.accessCodeList=t.result,null!=e.accessCodeList))for(var a=0;a<e.accessCodeList.length;a++)e.accessCodeList[a].access_code=l.decoder(e.accessCodeList[a].access_code)},function(){})},e.codeFilterDuplicateObject=function(e,t){var n=-1,a=t;return $.each(e,function(e,t){return t.access_code==a.access_code?n=0:void 0}),n},e.Add_AccessCode=function(){var t="access_add_accesscode_1";if(e.accessCodeInfo={},angular.copy(e.accessCodeTemp,e.accessCodeInfo),0!=e.accessCodeList.length){var a=e.codeFilterDuplicateObject(e.accessCodeList,e.accessCodeInfo);if(0==a)return void o.info(n.instant("access_add_accesscode_2"),"")}e.accessCodeInfo.access_code=l.encoder(e.accessCodeInfo.access_code);var i=JSON.stringify(e.accessCodeInfo.access_code);r.request("put","/addaccesscode",null,i,function(){e.getAccessCode()},null,t),e.Cancel()},e.codenum=0;var f=e.code=new s({removeAfterUpload:!1,headers:{Authorization:"sessionName "+window.localStorage.sessionId}});e.clearcode=function(){f.clearQueue()},f.onAfterAddingFile=function(t){var a=/[\S|\s]+.csv$/,i=a.test(t.file.name.toLowerCase());i||(e.clearcode(),o.info(n.instant("access_file_format_csv"),""))},f.onCompleteItem=function(t,a,i,r){if(e.codenum++,e.codenum<e.aps.length)e.importcode(f.queue[0]);else{e.codenum=0,e.getAccessCode();var s=n.instant("access_addauthuser_3")+a.total+" "+n.instant("access_addauthuser_4")+a.successTotal+"!";o.info(s,"")}},e.importcode=function(t){null!=e.aps&&(e.filename=t,f.queue[0].url=u+e.aps[e.codenum].ip+p+"/importcode/"+t.file.name,f.queue[0].upload())},e.downloadcodecsv=function(t){var n="Download accesscode file template",a=[{ip:e.aps[0].ip,success:!1,msg:""}];bootbox.confirm("download the acceecode file template?",function(e){
e&&c({method:"get",url:"/downloadcodecsv",headers:{Authorization:"sessionName "+window.localStorage.sessionId}}).success(function(e,t,n){var a="application/octet-stream",i=!1;n=n();var r=n["content-disposition"],s=new Array;s=r.split("=");var o=s[1],l=n["content-type"]||a;try{console.log("Trying saveBlob method ...");var c=new Blob([e],{type:l});if(navigator.msSaveBlob)navigator.msSaveBlob(c,o);else{var u=navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob;if(void 0===u)throw"Not supported";u(c,o),console.log("saveBlob succeeded"),i=!0}}catch(p){console.log("saveBlob method failed with the following exception:"),console.log(p)}if(!i){var d=window.URL||window.webkitURL||window.mozURL||window.msURL;if(d){var f=document.createElement("a");if("download"in f)try{console.log("Trying download link method with simulated click ...");var c=new Blob([e],{type:l}),g=d.createObjectURL(c);f.setAttribute("href",g),f.setAttribute("download",o);var m=document.createEvent("MouseEvents");m.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(m),console.log("Download link method with simulated click succeeded"),i=!0}catch(p){console.log("Download link method with simulated click failed with the following exception:"),console.log(p)}if(!i)try{console.log("Trying download link method with window.location ...");var c=new Blob([e],{type:a}),g=d.createObjectURL(c);window.location=g,console.log("Download link method with window.location succeeded"),i=!0}catch(p){console.log("Download link method with window.location failed with the following exception:"),console.log(p)}}}i||(console.log("No methods worked for saving the arraybuffer, using last resort window.open"),window.open(httpPath,"_blank",""))}).error(function(e,t){console.log("Request failed with status: "+t),a[0].success=!1,a[0].msg="Failed to communicate with the backend server !",operationLog.setLog(n,a),o.warning("Failed to communicate with the backend server !")})})},e.DelAccessCode=function(t){var a="access_del_accesscode_1",i=n.instant("access_del_accesscode_2")+t+"?";bootbox.confirm(i,function(n){n&&(t=l.encoder(t),r.request("delete","/deleteaccesscode/"+t,null,null,function(){e.getAccessCode(),e.accessCodeTemp={access_code:""}},null,a))})},e.restoredefault=function(){bootbox.confirm(n.instant("access_restore_portal_1"),function(e){if(e){var t="access_restore_portal_2";r.request("put","/restoredefault",null,null,function(){},null,t)}})},e.filename={},e.logonum=0,e.bgnum=0,e.licnum=0;var g=e.logo=new s({removeAfterUpload:!1,headers:{Authorization:"sessionName "+window.localStorage.sessionId}});e.clearlogo=function(){g.clearQueue()},g.onAfterAddingFile=function(t){var a=/[\S|\s]+.png$/,i=a.test(t.file.name.toLowerCase());i||(e.clearlogo(),o.info(n.instant("access_file_format_png"),""));var r=t.file.size/1024;return r>20?(e.clearlogo(),void o.warning(n.instant("access_logo_toobig"),"")):void 0},g.onCompleteAll=function(){e.logonum++,e.logonum<e.aps.length?e.uploadlogo(g.queue[0]):e.logonum=0},e.uploadlogo=function(t){null!=e.aps&&(e.filename=t,g.queue[0].url=u+e.aps[e.logonum].ip+p+"/uploadlogo/"+t.file.name,g.queue[0].upload())};var m=e.main=new s({removeAfterUpload:!1,headers:{Authorization:"sessionName "+window.localStorage.sessionId}});e.clearmain=function(){m.clearQueue()},m.onAfterAddingFile=function(t){var a=/[\S|\s]+.png$/,i=a.test(t.file.name.toLowerCase());i||(e.clearmain(),o.info(n.instant("access_file_format_png"),""));var r=t.file.size/1024;return r>40?(e.clearmain(),void o.warning(n.instant("access_background_toobig"),"")):void 0},m.onCompleteAll=function(){e.bgnum++,e.bgnum<e.aps.length?e.uploadmain(m.queue[0]):e.bgnum=0},e.uploadmain=function(t){null!=e.aps&&(e.filename=t,m.queue[0].url=u+e.aps[e.bgnum].ip+p+"/uploadmain/"+t.file.name,m.queue[0].upload())};var _=e.license=new s({removeAfterUpload:!1,headers:{Authorization:"sessionName "+window.localStorage.sessionId}});e.clearlicense=function(){_.clearQueue()},_.onAfterAddingFile=function(t){var a=/[\S|\s]+.txt$/,i=a.test(t.file.name);i||(e.clearlicense(),o.info(n.instant("access_file_format_txt"),""));var r=t.file.size/1024;return r>50?(e.clearlicense(),void o.warning(n.instant("access_term_toobig"),"")):void 0},_.onCompleteAll=function(){e.licnum++,e.licnum<e.aps.length?e.uploadlicense(_.queue[0]):e.licnum=0},e.uploadlicense=function(t){null!=e.aps&&(e.filename=t,_.queue[0].url=u+e.aps[e.licnum].ip+p+"/uploadlicense/"+t.file.name,_.queue[0].upload())},e.Cancel=function(){e.customized_portal=!1,e.add_local_auth_user=!1,e.localuser_detail=!1,e.edit_local_auth_user=!1,e.localuser_detail=!1,e.add_access_code=!1,e.batch_import=!1,e.batch_code=!1},e.ShowAddLocalUser=function(){e.Cancel(),e.localUserListTemp={},$("form[name='add_localauth_user']")[0].reset(),this.add_localauth_user.$setPristine(),e.add_local_auth_user=!0;var t=e.authenticationParams.CaptiveTime;t=t.replace(/\./g,"/");var n=t;$("#add_startdatepicker").datetimepicker({format:"YYYY.MM.DD",useCurrent:!1,ignoreReadonly:!0,minDate:n}).on("dp.change",function(e){$("#add_enddatepicker").data("DateTimePicker").minDate(e.date)}),$("#add_enddatepicker").datetimepicker({format:"YYYY.MM.DD",useCurrent:!1,ignoreReadonly:!0,minDate:n}).on("dp.change",function(e){$("#add_startdatepicker").data("DateTimePicker").maxDate(e.date)})},e.ShowLocalUserDetail=function(t){e.Cancel(),e.localuser_detail=!0,angular.copy(t,e.localUserListTemp)},e.Show_Edit_Localauth_User=function(t){var n,a,i,r;n=e.authenticationParams.CaptiveTime,a=n.replace(/\./g,"/"),i=t.StartingDate,i=i.replace(/\./g,"/"),r=a>i?i:a,$("#edit_start_date").datetimepicker({format:"YYYY.MM.DD",useCurrent:!1,ignoreReadonly:!0,minDate:r}).on("dp.change",function(e){var t=$("#edit_start_value").val(),n=t.replace(/\./g,"/");n>a?$("#edit_end_date").data("DateTimePicker").minDate(e.date):$("#edit_end_date").data("DateTimePicker").minDate(a)}),$("#edit_start_date").data("DateTimePicker").minDate(r),$("#edit_end_date").datetimepicker({format:"YYYY.MM.DD",useCurrent:!1,ignoreReadonly:!0,minDate:a}).on("dp.change",function(e){$("#edit_start_date").data("DateTimePicker").maxDate(e.date)}),e.Cancel(),e.edit_local_auth_user=!0,e.localuser_param_error=!1,e.mailError=!1,angular.copy(t,e.modifybefore),angular.copy(t,e.localUserListTemp),e.localUserListTemp.PasswordConfirm=e.localUserListTemp.Password,$("#edit_start_date").data("DateTimePicker").date(e.localUserListTemp.StartingDate),$("#edit_end_date").data("DateTimePicker").date(e.localUserListTemp.EndingDate)},e.ShowCustomizedPortal=function(){e.Cancel(),e.customized_portal=!0},e.ShowAddWhite=function(){$("form[name='add_whitelist']")[0].reset(),e.customized_portal=!1,e.add_local_auth_user=!1,e.add_access_code=!1,e.batch_import=!1,e.batch_code=!1,e.localuser_detail=!1},e.ShowAddMACAccount=function(){$("form[name='add_local_mac']")[0].reset(),e.customized_portal=!1,e.add_local_auth_user=!1,e.add_access_code=!1,e.batch_import=!1,e.batch_code=!1,e.localuser_detail=!1},e.ShowAddAccessCode=function(){e.Cancel(),e.add_access_code=!0},e.ShowBatchImport=function(){e.Cancel(),e.batch_import=!0,e.batch_code=!1},e.ShowCodeImport=function(){e.customized_portal=!1,e.add_local_auth_user=!1,e.add_access_code=!1,e.batch_import=!1,e.batch_code=!0},e.getTftpInfo=function(){a.get("/getTftpInfo",null,function(t,n){200==n&&null!=t&&t.success&&(e.tftpInfo=t.result,e.echoCycleLevels(e.tftpInfo.TFTPCycle))},function(){})},e.setTftpSwitch=function(){var t="access_tftp_switch",n=JSON.stringify(e.tftpInfo.FTFPStatus);r.request("put","/settftpswitch",null,n,function(){},null,t)},e.saveTftpInfo=function(){var t="access_save_tftp_conf";e.tftpInfo.TFTPCycle=this.cycleLevel.value;var n=JSON.stringify(e.tftpInfo);r.request("put","/savetftpinfo",null,n,function(){},null,t)},e.uploadTftpNow=function(){var t="access_tftp_upload_now";e.tftpInfoTemp=e.tftpInfo,e.tftpInfoTemp.TFTPCycle=0;var n=JSON.stringify(e.tftpInfoTemp);r.request("put","/uploadtftpinfo",null,n,function(){},null,t)},e.currentLine=0,e.getCurrentClientDetail=function(t){e.localUserListTemp=t},e.close=function(){t.close()},e.localuser_param_error=!1,e.mailError=!1,e.checkMail=function(t){if(null!=t&&""!=t){var n=t.length;n>30?(e.localuser_param_error=!0,e.mailError=!0):(e.localuser_param_error=!1,e.mailError=!1)}else e.localuser_param_error=!1,e.mailError=!1},e.getcaptiveportalinfo(),e.getLocalUser(),e.getAccessCode(),e.getTftpInfo()}]),angular.module("module.terminal.acl",[]).controller("TerminalAclViewController",["$scope","$http","singleModal","authentifiedRequest",function(e,t,n,a){e.aclList=[],e.toggleManager.aclGetRule=function(){var t={};e.aclList=[],a.get("/aclrule",t,function(t,n){200==n&&null!=t&&t.success&&(e.aclList=t.result)},function(){})},e.openAclViewPageInit=function(){n.open({templateUrl:"terminal/acl/acl-conf.html",controller:"TerminalAclConfController",size:"lg",backdrop:!0},function(t){e.toggleManager.aclGetRule()},function(t){e.toggleManager.aclGetRule()})}}]),angular.module("module.terminal.acl").controller("TerminalAclConfController",["$scope","$http","$modalInstance","$translate","authentifiedRequest","InterService","batchSyncConfig","toastr",function(e,t,n,a,i,r,s,o){e.skin=r.skin,e.InterService=r,e.ACLDetailGroupList=[],e.defaultACLAction="accept",e.aclDetail=!1,e.aclEdit=!1,e.aclAdd=!1,e.isAddACL=!1,e.isEditACL=!1,e.ACLIPProtocal=["ALL","TCP","UDP","ICMP"],e.ACLTarget=["ACCEPT","REJECT"],e.ACLDetailTemp={src_ip:"",src_port:"",dest_ip:"",dest_port:"",src_ip_flag:!1,src_port_flag:!1,dest_ip_flag:!1,dest_port_flag:!1,proto:"",target:""},e.ACLDetailCopy={},e.ShowEditACL=function(t){e.aclDetail=!1,e.aclEdit=!0,e.aclAdd=!1,e.ACLDetailTemp=angular.copy(t),e.ACLDetailCopy=angular.copy(e.ACLDetailTemp),e.anycheck(e.ACLDetailTemp)},e.ShowAclDetail=function(t){e.aclDetail=!0,e.aclEdit=!1,e.aclAdd=!1,e.ACLDetailTemp=t},e.ShowAddACL=function(){e.ACLDetailTemp={},$("form[name='addacl']")[0].reset(),this.addacl.$setPristine(),e.ACLDetailTemp.src_ip_flag=!1,e.ACLDetailTemp.src_port_flag=!1,e.ACLDetailTemp.dest_ip_flag=!1,e.ACLDetailTemp.dest_port_flag=!1,e.ACLDetailTemp.proto="TCP",e.ACLDetailTemp.target="REJECT",e.aclAdd=!0,e.aclDetail=!1,e.aclEdit=!1},e.aclGetDetailRule=function(){var t={},n=0;null!=e.ACLDetailGroupList&&(n=e.ACLDetailGroupList.length),i.get("/aclrule",t,function(t,a){if(200==a&&null!=t&&t.success)if(e.ACLDetailGroupList=t.result,null!=e.ACLDetailGroupList){if(e.aclDetail=!0,e.aclAdd=!1,e.aclEdit=!1,e.tempindex>0&&e.isEditACL)e.ACLDetailTemp=e.ACLDetailGroupList[e.tempindex];else if(1==e.isAddACL){var i=e.ACLDetailGroupList.length;i>n&&(e.ACLDetailTemp=e.ACLDetailGroupList[i-1])}else 0==e.isEditACL&&0==e.isAddACL&&angular.copy(e.ACLDetailGroupList[0],e.ACLDetailTemp);for(var r=0;r<e.ACLDetailGroupList.length;r++)"Any"==e.ACLDetailGroupList[r].src_ip&&(e.ACLDetailGroupList[r].src_ip_flag=!0),"Any"==e.ACLDetailGroupList[r].src_port&&(e.ACLDetailGroupList[r].src_port_flag=!0),"Any"==e.ACLDetailGroupList[r].dest_ip&&(e.ACLDetailGroupList[r].dest_ip_flag=!0),"Any"==e.ACLDetailGroupList[r].dest_port&&(e.ACLDetailGroupList[r].dest_port_flag=!0)}else e.aclDetail=!1},function(){})},e.getDefaultACLAction=function(){var t={};i.get("/getdefaultACL",t,function(t,n){200==n&&null!=t&&t.success&&(e.defaultACLAction=t.result)},function(){})},e.setDefaultACLAction=function(t){e.defaultACLAction=t;var n="access_set_acl_1",a=JSON.stringify(e.defaultACLAction);s.request("put","/setdefaultACL",null,a,function(){e.getDefaultACLAction()},null,n)},e.DelACL=function(t){var n="access_del_acl_1",i="/deleterule/"+t.rule,r=a.instant("access_del_acl_2");bootbox.confirm(r,function(t){t&&s.request("delete",i,null,null,function(){e.aclGetDetailRule()},null,n)})},e.filterDuplicateObject=function(e,t){var n=!1,a=!1,i=angular.copy(t);return a=i.hasOwnProperty("src_ip"),0!=a&&""!=i.src_ip||(i.src_ip="Any"),a=i.hasOwnProperty("src_port"),0!=a&&""!=i.src_port||(i.src_port="Any"),a=i.hasOwnProperty("dest_ip"),0!=a&&""!=i.dest_ip||(i.dest_ip="Any"),a=i.hasOwnProperty("dest_port"),0!=a&&""!=i.dest_port||(i.dest_port="Any"),$.each(e,function(e,t){return t.src_ip==i.src_ip&&t.src_port==i.src_port&&t.dest_ip==i.dest_ip&&t.dest_port==i.dest_port&&t.proto==i.proto&&t.target==i.target?(n=!0,!1):void 0}),n},e.AddACL=function(){var t="access_add_acl_1";if(e.isEditACL=!1,e.isAddACL=!0,null!=e.ACLDetailGroupList){if(e.ACLDetailGroupList.length>=128)return void o.info(a.instant("access_add_acl_2"),"");var n=e.filterDuplicateObject(e.ACLDetailGroupList,e.ACLDetailTemp);if(1==n)return void o.info(a.instant("access_add_acl_3"),"")}var i=JSON.stringify(e.ACLDetailTemp);s.request("put","/addfirewall",null,i,function(){e.aclGetDetailRule(),e.ACLDetailTemp={}},null,t)},e.anycheck=function(e){"Any"==e.src_ip?(e.src_ip="",e.src_ip_flag=!0):e.src_ip_flag=!1,"Any"==e.src_port?(e.src_port="",e.src_port_flag=!0):e.src_port_flag=!1,"Any"==e.dest_ip?(e.dest_ip="",e.dest_ip_flag=!0):e.dest_ip_flag=!1,"Any"==e.dest_port?(e.dest_port="",e.dest_port_flag=!0):e.dest_port_flag=!1},e.check_src_ip=function(){1==e.ACLDetailTemp.src_ip_flag?e.ACLDetailTemp.src_ip="":e.ACLDetailTemp.src_ip=e.ACLDetailCopy.src_ip},e.check_src_port=function(){1==e.ACLDetailTemp.src_port_flag?e.ACLDetailTemp.src_port="":e.ACLDetailTemp.src_port=e.ACLDetailCopy.src_port},e.check_dest_ip=function(){1==e.ACLDetailTemp.dest_ip_flag?e.ACLDetailTemp.dest_ip="":e.ACLDetailTemp.dest_ip=e.ACLDetailCopy.dest_ip},e.check_dest_port=function(){1==e.ACLDetailTemp.dest_port_flag?e.ACLDetailTemp.dest_port="":e.ACLDetailTemp.dest_port=e.ACLDetailCopy.dest_port},e.EditACL=function(){var t="access_set_acl_2";e.isAddACL=!1,e.isEditACL=!0;var n=e.filterDuplicateObject(e.ACLDetailGroupList,e.ACLDetailTemp);if(1==n)return void o.info(a.instant("access_add_acl_3"),"");var i=JSON.stringify(e.ACLDetailTemp);e.tempindex=$.inArray(e.ACLDetailTemp,e.ACLDetailGroupList),s.request("put","/modifyfirewall",null,i,function(){e.aclGetDetailRule()},null,t)},e.close=function(){n.close()},e.Cancel=function(){e.aclAdd=!1,e.aclDetail=!1,e.aclEdit=!1},e.moveACLlist=function(t,n){var a="access_set_acl_3",i=[];e.anycheck(t),e.anycheck(n),i.push(t),i.push(n);var r=JSON.stringify(i);s.request("put","/moveACLlist",null,r,function(){e.aclGetDetailRule()},null,a)},e.Moveup=function(t){e.temp="",e.temp=e.ACLDetailGroupList[t-1],e.ACLDetailGroupList[t-1]=e.ACLDetailGroupList[t],e.ACLDetailGroupList[t]=e.temp,e.temp="";var n=e.ACLDetailGroupList[t],a=e.ACLDetailGroupList[t-1];e.moveACLlist(n,a)},e.Movedown=function(t){e.temp=e.ACLDetailGroupList[t+1],e.ACLDetailGroupList[t+1]=e.ACLDetailGroupList[t],e.ACLDetailGroupList[t]=e.temp,e.temp="";var n=e.ACLDetailGroupList[t],a=e.ACLDetailGroupList[t+1];e.moveACLlist(n,a)},e.aclGetDetailRule(),e.getDefaultACLAction()}]),angular.module("module.terminal.access",[]).controller("TerminalAccessController",["$scope","$translate","singleModal","authentifiedRequest","InterService","batchSyncConfig","FileUploader","toastr","hanCrypto",function(e,t,n,a,i,r,s,o,l){e.skin=i.skin,e.InterService=i,e.aps=i.getCanConfigAps();e.$watch("InterService",function(t,n){t!==n&&(e.aps=i.getCanConfigAps())},!0),e.BlackList=[],e.BlackListTemp={Begin_MAC:"",End_MAC:""},e.WhiteList=[],e.WhiteListTemp={Begin_MAC:"",End_MAC:""},e.WallList=[],e.WallListTemp={Begin_IP:"",End_IP:""},e.mac_compare=function(t,n,a){var i=t.length;if((17==i||1>=a)&&t==n.Begin_MAC)return!0;if(35==i||2>=a)if(e.arr=t.split("-"),""!=n.End_MAC){if(n.Begin_MAC<=e.arr[0]&&n.End_MAC>=e.arr[0])return!0;if(n.Begin_MAC>=e.arr[0]&&n.End_MAC<=e.arr[1])return!0;if(n.Begin_MAC<=e.arr[1]&&n.End_MAC>=e.arr[1])return!0}else if(n.Begin_MAC>=e.arr[0]&&n.Begin_MAC<=e.arr[1])return!0;if(8==i||3>=a){var r=n.Begin_MAC.substr(0,8);if(t==r)return!0}return!1},e.maclistFilterDuplicateObject=function(t,n){var a=!1,i=n,r="",s=0;if(""==i.End_MAC)s=8==i.Begin_MAC.length?3:1,r=i.Begin_MAC;else{s=2;var o=i.Begin_MAC.substr(0,8),l=i.End_MAC.substr(0,8);if(o!=l||i.Begin_MAC>i.End_MAC)return!0;r=i.Begin_MAC+"-"+i.End_MAC}return $.each(t,function(t,n){var r=e.mac_compare(n.MAC,i,s);return 1==r?a=!0:void 0}),a},e.toggleManager.getBlackList=function(){var t={};a.get("/getblacklist",t,function(t,n){200==n&&null!=t&&t.success&&(e.BlackList=t.result)},function(){})},e.Add_Blacklist=function(){if(null!=e.BlackList){if(e.BlackList.length>=256)return void o.info(t.instant("client_kick_user_1"),"");var n=e.maclistFilterDuplicateObject(e.BlackList,e.BlackListTemp);if(1==n)return void o.info(t.instant("access_add_blacklist_1"),"")}var a="access_add_blacklist_2",i=JSON.stringify(e.BlackListTemp);r.request("put","/addBlacklist",null,i,function(){e.toggleManager.getBlackList()},null,a),e.BlackListTemp.Begin_MAC="",$("form[name='add_black_mac']")[0].reset(),this.add_black_mac.$setPristine(),e.Cancel()},e.Del_Blacklist=function(n){var a="access_del_blacklist_1",i=t.instant("access_del_blacklist_2")+n+"?";bootbox.confirm(i,function(t){t&&r.request("delete","/delBlacklist/"+n,null,null,function(){e.toggleManager.getBlackList()},null,a)})},e.toggleManager.getWhiteList=function(){var t={};a.get("/getwhitelist",t,function(t,n){200==n&&null!=t&&t.success&&(e.WhiteList=t.result)},function(){})},e.Add_Whitelist=function(){var n="access_add_whitelist_1";if(null!=e.WhiteList){8==e.WhiteListTemp.Begin_MAC.length&&(e.WhiteListTemp.End_MAC="");var a=e.maclistFilterDuplicateObject(e.WhiteList,e.WhiteListTemp);if(1==a)return void o.info(t.instant("access_add_whitelist_2"),"")}var i=JSON.stringify(e.WhiteListTemp);r.request("put","/addwhitelist",null,i,function(){e.toggleManager.getWhiteList()},null,n),e.WhiteListTemp.Begin_MAC="",e.WhiteListTemp.End_MAC="",$("form[name='add_local_mac']")[0].reset(),this.add_local_mac.$setPristine(),e.Cancel()},e.Del_Whitelist=function(n){var a="access_del_whitelist_1",i=t.instant("access_del_whitelist_2")+n+"?";bootbox.confirm(i,function(t){if(t){var i="/delwhitelist/"+n;r.request("delete",i,null,null,function(){e.toggleManager.getWhiteList()},null,a)}})},e.ip2int=function(e){var t=0;return e=e.split("."),t=256*Number(e[0])*256*256+256*Number(e[1])*256+256*Number(e[2])+Number(e[3]),t>>>=0},e.ipaddr_compare=function(t){var n=!1;if(""==t.End_IP)return n;if(t.End_IP==t.Begin_IP)return n;var a=e.ip2int(t.Begin_IP),i=e.ip2int(t.End_IP);return a>i?n=!0:n},e.ip_range_compare=function(t,n,a){var i=0,r=0,s=0,o=0,l=0,c=!1;if(t.indexOf("-")>0&&(i=1,e.added=t.split("-")),1>=a)if(0==i){if(o=e.ip2int(t),r=e.ip2int(n.Begin_IP),o==r)return c=!0}else if(o=e.ip2int(e.added[0]),l=e.ip2int(e.added[1]),r=e.ip2int(n.Begin_IP),r>=o&&l>=r)return c=!0;if(1==i&&2>=a)if(o=e.ip2int(e.added[0]),l=e.ip2int(e.added[1]),r=e.ip2int(n.Begin_IP),s=e.ip2int(n.End_IP),0==s){if(r>=o&&l>=r)return c=!0}else{if(o>=r&&s>=o)return c=!0;if(r>=o&&l>=s)return c=!0;if(l>=r&&s>=l)return c=!0}return c},e.iplistFilterDuplicateObject=function(t,n){var a=!1,i=n,r="",s=0;return""==i.End_IP?(s=1,r=i.Begin_IP):(s=2,r=i.Begin_IP+"-"+i.End_IP),$.each(t,function(t,n){var r=e.ip_range_compare(n.Domain,i,s);return 1==r?a=!0:void 0}),a},e.toggleManager.getWallList=function(){a.get("/getwalllist",null,function(t,n){200==n&&null!=t&&t.success&&(e.WallList=t.result)},function(){})},e.Add_Walllist=function(){var n="access_walled_garden_4";if(null!=e.WallList){if(e.WallList.length>=128)return void o.info(t.instant("access_walled_garden_1"),"");var a=e.ipaddr_compare(e.WallListTemp);if(1==a)return void o.info(t.instant("access_walled_garden_2"),"");var a=e.iplistFilterDuplicateObject(e.WallList,e.WallListTemp);if(1==a)return void o.info(t.instant("access_walled_garden_3"),"")}var i=JSON.stringify(e.WallListTemp);r.request("put","/addwalllist",null,i,function(){e.toggleManager.getWallList(),e.WallListTemp.End_IP=""},null,n),e.WallListTemp.Begin_IP="",e.WallListTemp.End_IP="",$("form[name='add_whitelist']")[0].reset(),this.add_whitelist.$setPristine(),e.Cancel()},e.Del_Walllist=function(n){var a="access_del_walled_garden_1",i=t.instant("access_del_walled_garden_2")+n.Domain+"?";bootbox.confirm(i,function(t){t&&r.request("delete","/delwalllist/"+n.Domain,null,null,function(){e.toggleManager.getWallList()},null,a)})},e.Cancel=function(){},e.CheckStartingMac=function(){if(null!=e.WhiteListTemp.Begin_MAC||""!=e.WhiteListTemp.Begin_MAC){var t=e.WhiteListTemp.Begin_MAC.length;8==t&&(e.WhiteListTemp.End_MAC="")}}}]),angular.module("system",[]).service("ClusterService",["authentifiedRequest",function(e){var t=this;t.ClusterinfoSer={},t.getClusterinfoSer=function(){return t.ClusterinfoSer},t.setClusterinfoSer=function(e){t.ClusterinfoSer=e},t.HttpClusterInfo=function(n){e.get("/getcluster",null,function(e){null!=e&&e.success?(t.ClusterinfoSer=e.result,null!=n&&n()):console.info("haps fail")},function(){console.info("haps error")})}}]).controller("clusterController",["$scope","singleModal","authentifiedRequest","ClusterService",function(e,t,n,a){e.toggleManager.clusterInit=function(){a.HttpClusterInfo(null)},e.toggleManager.clusterInit(),e.$watch("ClusterService.ClusterinfoSer",function(t,n){console.log(t!==n),t!==n&&(e.clusterInfo=a.getClusterinfoSer())},!0),e.showCluster=function(){t.open({templateUrl:"system/cluster/cluster-config.html",controller:"clusterConfController",size:"lg",backdrop:!0})}}]).filter("userisEnable",[function(){var e=function(e){switch(e){case"0":return"Disabled";case"1":return"Enable "}};return e}]),angular.module("system").controller("syslogContronller",["$scope","InterService","authentifiedRequest","batchSyncConfig","lockScreen","$http","operationLog","toastr","$translate",function(e,t,n,a,i,r,s,o,l){function c(e,t,n){var a="application/octet-stream",i=!1;t=t();var r=t["content-type"]||a;try{var s=new Blob([e],{type:r});if(navigator.msSaveBlob)navigator.msSaveBlob(s,n);else{var o=navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob;if(void 0===o)throw"Not supported";o(s,n),i=!0}}catch(l){}if(!i){var c=window.URL||window.webkitURL||window.mozURL||window.msURL;if(c){var u=document.createElement("a");if("download"in u)try{var s=new Blob([e],{type:r}),p=c.createObjectURL(s);u.setAttribute("href",p),u.setAttribute("download",n);var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),u.dispatchEvent(d),i=!0}catch(l){}if(!i)try{var s=new Blob([e],{type:a}),p=c.createObjectURL(s);window.location=p,i=!0}catch(l){}}}i||window.open(httpPath,"_blank","")}e.InterService=t,e.syslogs=[],e.apInfo=[],e.syslogLevels=[{name:"Emergent",value:"LOG_EMERG"},{name:"Alert",value:"LOG_ALERT"},{name:"Critical",value:"LOG_CRIT"},{name:"Error",value:"LOG_ERR"},{name:"Warning",value:"LOG_WARNING"},{name:"Notice",value:"LOG_NOTICE"},{name:"Info",value:"LOG_INFO"},{name:"Debug/ALL",value:"LOG_DEBUG"}],e.syslogParmas={},e.selectedLevel=e.syslogLevels[3],e.echoSyslogLevels=function(t){"LOG_DEBUG"==t?e.selectedLevel=e.syslogLevels[7]:"LOG_INFO"==t?e.selectedLevel=e.syslogLevels[6]:"LOG_NOTICE"==t?e.selectedLevel=e.syslogLevels[5]:"LOG_WARNING"==t?e.selectedLevel=e.syslogLevels[4]:"LOG_ERR"==t?e.selectedLevel=e.syslogLevels[3]:"LOG_CRIT"==t?e.selectedLevel=e.syslogLevels[2]:"LOG_ALERT"==t?e.selectedLevel=e.syslogLevels[1]:"LOG_EMERG"==t&&(e.selectedLevel=e.syslogLevels[0])},e.toggleManager.syslogInit=function(){e.syslogInfoQuery(),e.syslogServerQuery(),e.apInfoQuery()},e.syslogServerQuery=function(){var t={};n.get("/syslogServerPara",t,function(t,n){200==n&&null!=t&&t.success&&(e.syslogParmas=t.result,e.echoSyslogLevels(e.syslogParmas.level))},function(){})},e.apInfoQuery=function(){e.apInfo=t.getCanConfigAps(),e.selectedAp=e.apInfo[0]},e.syslogInfoQuery=function(){var a={};e.syslogs=[];for(var i=t.getCanConfigAps(),r=0;r<i.length;r++){var s=i[r].ip,o="http://"+s+":8080/syslog";n.get(o,a,function(t,n){200==n&&null!=t&&t.success&&(0==e.syslogs.length?e.syslogs=angular.copy(t.result):e.syslogs=e.syslogs.concat(t.result))},function(){})}},e.saveServerLevel=function(){e.syslogParmas.level=e.selectedLevel.value;var t=JSON.stringify(e.syslogParmas),n="syslog_edit_level",i=e.syslogParmas.level;a.request("put","/syslogServerLevel",null,t,function(){e.syslogServerQuery()},null,n,null,i)},e.configLogRemote=function(){var t,n=JSON.stringify(e.syslogParmas);t=e.syslogParmas.logRemoteSwitch?"syslog_edit_remoteSwitch_1":"syslog_edit_remoteSwitch_2",a.request("put","/logRemoteSwitch",null,n,function(){e.syslogServerQuery()},null,t)},e.saveServerIp=function(){var t=JSON.stringify(e.syslogParmas),n="syslog_edit_serverIp",i=e.syslogParmas.ip;a.request("put","/syslogServerIp",null,t,function(){e.syslogServerQuery()},null,n,null,i)},e.downloadSyslog=function(){i.lock();var t=e.selectedAp.ip,n="http://"+t+":8080/downloadSyslog1",a="http://"+t+":8080/downloadSyslog2",u="http://"+t+":8080/downloadSyslog3",p="kes_syslog",d="kes_history_syslog.log",f="kes_history_traps.log",g="syslog_down",m=e.selectedAp.apname,_=[{ip:t,success:"module_operate_failure",msg:""}];r({method:"put",url:n,headers:{Authorization:"sessionName "+window.localStorage.sessionId}}).success(function(e,t,n){i.unlock(),null==e||""==e?(_[0].success="module_operate_failure",_[0].msg="log_backendServer_error"):("undefined"==typeof e.success?(c(e,n,p),_[0].success="module_operate_success",o.info(l.instant("syslog_down_success_1"),"")):(_[0].success="module_operate_failure",o.info(l.instant(e.msg),"")),_[0].msg=e.msg),s.setLog(g,_,m)}).error(function(){i.unlock(),_[0].success="module_operate_failure",_[0].msg="log_backendServer_error",s.setLog(g,_,m),o.warning(l.instant("log_backendServer_error"),"")}),r({method:"put",url:a,headers:{Authorization:"sessionName "+window.localStorage.sessionId}}).success(function(e,t,n){i.unlock(),null==e||""==e?(_[0].success="module_operate_failure",_[0].msg="log_backendServer_error"):("undefined"==typeof e.success?(c(e,n,d),_[0].success="module_operate_success",o.info(l.instant("syslog_down_success_2"),"")):(_[0].success="module_operate_failure",o.info(l.instant(e.msg),"")),_[0].msg=e.msg),s.setLog(g,_,m)}).error(function(){i.unlock(),_[0].success="module_operate_failure",_[0].msg="log_backendServer_error",s.setLog(g,_,m),o.warning(l.instant("log_backendServer_error"),"")}),r({method:"put",url:u,headers:{Authorization:"sessionName "+window.localStorage.sessionId}}).success(function(e,t,n){i.unlock(),null==e||""==e?(_[0].success="module_operate_failure",_[0].msg="log_backendServer_error"):("undefined"==typeof e.success?(c(e,n,f),_[0].success="module_operate_success",o.info(l.instant("syslog_down_success_3"),"")):(_[0].success="module_operate_failure",o.info(l.instant(e.msg),"")),_[0].msg=e.msg),s.setLog(g,_,m)}).error(function(){i.unlock(),_[0].success="module_operate_failure",_[0].msg="log_backendServer_error",s.setLog(g,_,m),o.warning(l.instant("log_backendServer_error"),"")})}}]),angular.module("system").controller("NTPContronller",["$scope","$translate","authentifiedRequest","batchSyncConfig","toastr","ntpTimeZoneConstant",function(e,t,n,a,i,r){e.timeZoneArray=r.utc,e.ntpConfig={dateTime:"",timeZone:"",ntpServerList:[],city:""},e.apDateTimeConfig={selectTimeZone:"",dateTime:"",showPickerFlag:!1,showTimezoneSelectFlag:!1,modifyFlag:!1},e.NTP_ServerIP_Temp="";var s=$("#ntpDatetime");e.dynamicTime=function(){e.currentDatetime.setSeconds(e.currentDatetime.getSeconds()+1);var t=e.currentDatetime.toTimeString().indexOf("GMT"),n=e.currentDatetime.toDateString()+" "+e.currentDatetime.toTimeString().substr(0,t-1);s.text(n)},e.time,e.ntpParamQuery=function(){n.get("/network/ntpClient/confParams",null,function(t){if(null!=t&&t.success){e.ntpConfig=t.result,e.setSelectTimeZone(e.ntpConfig.city);var n=new Date(Date.parse(e.ntpConfig.dateTime.replace(/-/g,"/")));e.currentDatetime=new Date(n),e.time&&clearInterval(e.time),e.dynamicTime(),e.time=setInterval(e.dynamicTime,1e3),e.apDateTimeConfig.modifyFlag=!0}},function(){})},e.setSelectTimeZone=function(t){if(null==t||""==t)return"";for(var n=e.timeZoneArray,a=0,i=n.length;i>a;a++)if(-1!=n[a].indexOf(t+"@")){e.apDateTimeConfig.selectTimeZone=n[a],e.ntpConfig.timeZone=n[a];break}},e.toggleManager.ntpInit=function(){e.ntpParamQuery()},e.toggleManager.ntpDestory=function(){e.time&&(clearInterval(e.time),e.time=null),e.ntpConfig={dateTime:"",timeZone:"",ntpServerList:[],city:""},e.apDateTimeConfig={selectTimeZone:"",dateTime:"",showPickerFlag:!1,showTimezoneSelectFlag:!1,modifyFlag:!1},s.text("")},e.SyncNTPServerIPList=function(){var t={ntpServerList:[]};t.ntpServerList=e.ntpConfig.ntpServerList;var n="ntp_log_adjustOrder";a.request("put","/network/ntpClient/ntpserver",null,t,function(){e.ntpParamQuery()},null,n)},e.removeNtpserver=function(n){if(1==e.ntpConfig.ntpServerList.length)return void i.warning(t.instant("ntpNotLess"));var r="ntp_log_removeServer",s=t.instant("delNtpServer")+n+"?";bootbox.confirm(s,function(t){t&&a.request("delete","/network/ntpClient/ntpserver/"+n,null,null,function(){e.ntpParamQuery()},null,r)})},e.AddNTPServerIP=function(){for(var n=e.ntpConfig.ntpServerList,r=!1,s=0;s<n.length;s++)if(n[s]==e.NTP_ServerIP_Temp){r=!0,i.warning(t.instant("notAllowedRepetitionNtp"));break}if(!r){var o="ntp_log_addServer",l={ntpserver:e.NTP_ServerIP_Temp};a.request("post","/network/ntpClient/ntpserver",null,l,function(){e.ntpParamQuery()},null,o),e.NTP_ServerIP_Temp=""}},e.Moveup=function(t){e.temp="",e.temp=e.ntpConfig.ntpServerList[t-1],e.ntpConfig.ntpServerList[t-1]=e.ntpConfig.ntpServerList[t],e.ntpConfig.ntpServerList[t]=e.temp,e.temp="",e.SyncNTPServerIPList()},e.Movedown=function(t){e.temp=e.ntpConfig.ntpServerList[t+1],e.ntpConfig.ntpServerList[t+1]=e.ntpConfig.ntpServerList[t],e.ntpConfig.ntpServerList[t]=e.temp,e.temp="",e.SyncNTPServerIPList()},e.showApDatetimePicker=function(t){e.apDateTimeConfig.showPickerFlag=t,t&&$("#apdatetimepicker").data("DateTimePicker").date(e.currentDatetime)},e.showTimezoneSelect=function(t){e.apDateTimeConfig.showTimezoneSelectFlag=t},e.modifyDatetime=function(){var n=e.apDateTimeConfig.dateTime,i={datetime:n},r="ntp_log_modifyApDatetime",s=t.instant("updateApDatetime");bootbox.confirm(s,function(t){t&&a.request("put","/network/ntpClient/datetime",null,i,function(){e.ntpParamQuery(),e.showApDatetimePicker(!1)},null,r)})},e.modifyTimezone=function(){var n=e.apDateTimeConfig.selectTimeZone;if(null!=n&&""!=n){var i=n.split("@"),r=i[0],s=i[1],o={timezone:s,city:r},l="ntp_log_modifyApTimezone",c=t.instant("updateApTimezone");bootbox.confirm(c,function(t){t&&a.request("put","/network/ntpClient/timezone",null,o,function(){e.ntpParamQuery(),e.showTimezoneSelect(!1)},null,l)})}},$("#apdatetimepicker").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1}),$("#apdatetimepicker").on("dp.change",function(t){e.apDateTimeConfig.dateTime=t.date.format("YYYY-MM-DD HH:mm:ss")})}]),angular.module("system").controller("clusterConfController",["$scope","$modal","$modalInstance","$translate","authentifiedRequest","InterService","ClusterService","batchSyncConfig","lockScreen","operationLog",function(e,t,n,a,i,r,s,o,l,c){function u(){l.lock(),s.HttpClusterInfo(function(){p()})}function p(){e.clusterinfo=s.getClusterinfoSer(),e.cluster_conf.cluster_id=parseInt(e.clusterinfo.cluster_id),e.cluster_conf.cluster_name=e.clusterinfo.cluster_name,e.cluster_conf.cluster_location=e.clusterinfo.cluster_location,e.cluster_conf.cluster_vip=e.clusterinfo.cluster_vip,e.cluster_conf.cluster_netmask=e.clusterinfo.cluster_netmask,e.accountInfo.viewerstatus=e.clusterinfo.Viewer,e.accountInfo.gueststatus=e.clusterinfo.GuestOperator,l.unlock()}e.skin=r.skin,e.InterService=r,e.accountInfo={admin:"",viewerstatus:"0",view:"",gueststatus:"0",guest:""},e.subInfo={admin:"",viewerstatus:"0",view:"",gueststatus:"0",guest:""},e.accountconfirm={adminconfirm:"",viewconfirm:"",guestconfirm:""},e.cluster_conf={cluster_id:0,cluster_name:"",cluster_location:"",cluster_vip:"",cluster_netmask:""},u(),e.exchange=function(t){100==t?(e.accountInfo.view="",e.accountconfirm.viewconfirm=""):200==t&&(e.accountInfo.guest="",e.accountconfirm.guestconfirm="")},e.saveGroupID=function(){var t="modify_cluster_id";bootbox.confirm(a.instant("modify_cluster_id_confirm"),function(n){
n?o.request("put","/editclusterid",null,e.cluster_conf,function(){u()},null,t):e.cluster_conf.cluster_id=parseInt(e.clusterinfo.cluster_id)}),e.cancel()},e.Clusterinfo=function(){var t=r.getPVCinfo(),n="";if(null==t||""==t)return void toastr.warning(a.instant("cannot_get_pvc_info"));n="http://"+t+":8080/editvip";var s="modify_cluster_baseinfo_log_name";o.request("put","/editclusterinfo",null,e.cluster_conf,function(){u()},null,s);var l="modify_cluster_vip",p=[{ip:"PVC",success:"module_oprate_failure",msg:""}];i.put(n,null,e.cluster_conf,function(e){null!=e&&e.success?(p[0].success="module_operate_success",p[0].msg="ap_log_success"):(p[0].success="module_oprate_failure",p[0].msg="ap_log_error_1",toastr.warning(a.instant("modify_cluster_vip_failed"))),c.setLog(l,p)},function(){p[0].success="module_oprate_failure",p[0].msg="failedServer",c.setLog(l,p),toastr.warning(a.instant("failedServer"))}),e.cancel()},e.Accountinfo=function(){e.accountInfo.admin.length>0&&(e.subInfo.admin=hex_md5(e.accountInfo.admin).toLowerCase()),e.accountInfo.view.length>0&&(e.subInfo.view=hex_md5(e.accountInfo.view).toLowerCase()),e.accountInfo.guest.length>0&&(e.subInfo.guest=hex_md5(e.accountInfo.guest).toLowerCase()),e.subInfo.viewerstatus=e.accountInfo.viewerstatus,e.subInfo.gueststatus=e.accountInfo.gueststatus;var t="modify_user_info_log_name";o.request("put","/editpasswd",null,e.subInfo,function(){e.accountInfo={admin:"",viewerstatus:"0",view:"",gueststatus:"0",guest:""},e.accountconfirm={adminconfirm:"",viewconfirm:"",guestconfirm:""},u(),e.cancel()},null,t)},e.cancel=function(){n.close()}}]),angular.module("common",[]).controller("aboutContronller",["$scope","$modalInstance","authentifiedRequest","InterService",function(e,t,n,a){e.skin=a.skin,e.aboutInfo={name:"",softVersion:"",website:"",legal:"",countryCode:""},e.cancel=function(){t.dismiss("cancel")},e.query=function(){n.get("/other/systemInfo",null,function(t){if(t.success){var n=t.result;e.aboutInfo.name=n.HanletName,e.aboutInfo.softVersion=n.SoftwareVer,e.aboutInfo.website=n.Website,e.aboutInfo.legal=n.Legal,e.aboutInfo.countryCode=n.countryCode}},function(){})},e.query()}]),angular.module("common").controller("toolsContronller",["$scope","$modalInstance","$translate","$modal","InterService","authentifiedRequest","toastr",function(e,t,n,a,i,r,s){e.skin=i.skin,e.InterService=i,e.showsysinfo_flag=!1,e.other_command_flag=!0,e.tools=[{id:0,name:"-Select Command-"},{id:1,name:"show system health"},{id:2,name:"show WIFI info"},{id:4,name:"show history syslog info"},{id:7,name:"tcpdump"},{id:8,name:"traceroute"},{id:9,name:"ping"},{id:10,name:"show history reset reason"}],e.operation={},e.operation.selectApIp="",e.aps=[],e.requestParams={command:0,hostname:""},e.showHostname=!1,e.operation.result="",e.initFuc=function(){e.aps=i.getCanConfigAps()},e.initFuc(),e.changeTool=function(){var t=e.requestParams.command;return 8==t||9==t?void(e.showHostname=!0):(e.showHostname=!1,void(e.requestParams.hostname=""))},e.exec=function(){if(""==e.operation.selectApIp)return void s.warning(n.instant("pleaseSelectAp"));if(0==e.requestParams.command)return void s.warning(n.instant("pleaseSelectTool"));var t=e.requestParams.command;if((8==t||9==t)&&""==e.requestParams.hostname)return void s.warning(n.instant("hostnameNotAllowEmpty"));e.operation.result="";var a="http://",i=":8080",o=a+e.operation.selectApIp+i+"/other/tools",l="30000";r.request("post",o,null,e.requestParams,l,function(t){if(null!=t&&t.success)if(e.operation.result=t.result,e.showsysinfo={free:[],df:[]},e.sysinfo_result={lineOne:"",lineTwo:"",lineThree:"",lineFour:"",lineFive:"",lineSix:""},1==e.requestParams.command){e.showsysinfo_flag=!0,e.other_command_flag=!1;for(var a=e.operation.result.split("\r\n"),i=0;i<a.length;i++)if(4>i){var r=a[i].replace(/[ ]+/g,"#"),s=r.split("#");""==s[0]||"Mem:"==s[0]?(e.sysinfo_result={},e.sysinfo_result.lineOne=s[0],e.sysinfo_result.lineTwo=s[1],e.sysinfo_result.lineThree=s[2],e.sysinfo_result.lineFour=s[3],e.sysinfo_result.lineFive=s[4],e.sysinfo_result.lineSix=s[5],e.showsysinfo.free.push(e.sysinfo_result),e.sysinfo_result={}):"-/+"==s[0]?(e.sysinfo_result={},s[0]=s[0]+" "+s[1],e.sysinfo_result.lineOne=s[0],e.sysinfo_result.lineTwo=s[2],e.sysinfo_result.lineThree=s[3],e.sysinfo_result.lineFour=" ",e.sysinfo_result.lineFive=" ",e.sysinfo_result.lineSix=" ",e.showsysinfo.free.push(e.sysinfo_result),e.sysinfo_result={}):"Swap:"==s[0]&&(e.sysinfo_result={},e.sysinfo_result.lineOne=s[0],e.sysinfo_result.lineTwo=s[1],e.sysinfo_result.lineThree=s[2],e.sysinfo_result.lineFour=s[3],e.sysinfo_result.lineFive=" ",e.sysinfo_result.lineSix=" ",e.showsysinfo.free.push(e.sysinfo_result),e.sysinfo_result={})}else{var o=a[i].replace(/[ ]+/g,"#"),l=o.split("#");"Mounted"==l[5]&&(l[5]="Mounted on"),e.sysinfo_result.lineOne=l[0],e.sysinfo_result.lineTwo=l[1],e.sysinfo_result.lineThree=l[2],e.sysinfo_result.lineFour=l[3],e.sysinfo_result.lineFive=l[4],e.sysinfo_result.lineSix=l[5],e.showsysinfo.df.push(e.sysinfo_result),e.sysinfo_result={}}}else e.showsysinfo_flag=!1,e.other_command_flag=!0;else{var c=n.instant("Operate")+" "+n.instant("module_operate_failure");e.operation.result=c}},function(){var t=n.instant("Operate")+" "+n.instant("module_operate_failure");e.operation.result=t})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("common").controller("helpContronller",["$modalInstance",function(e){$scope.cancel=function(){e.dismiss("cancel")}}]),angular.module("wlan",[]).filter("wlanEnableFilter",[function(){var e=function(e){switch(e){case!0:return"On";case!1:return"Off"}};return e}]).controller("wlanController",["$scope","singleModal","authentifiedRequest","batchSyncConfig","clientService","monitorService","hanCrypto",function(e,t,n,a,i,r,s){e.wlans={},e.urlEscape=function(e){return e=e.replace(/\+/g,"%2B"),e=e.replace(/\//g,"%2F"),e=e.replace(/\?/g,"%3F"),e=e.replace(/%/g,"%25"),e=e.replace(/#/g,"%23"),e=e.replace(/&/g,"%26"),e=e.replace(/=/g,"%3D"),e=e.replace(/\\/g,"%5C"),e=e.replace(/\./g,"%2E"),e=e.replace(/:/g,"%3A")},e.titleWidth="",e.wlanManagement.query=function(){var t={};n.get("/wlans",t,function(t,n){if(200==n&&null!=t&&t.success){for(var a=0;a<t.result.wlanList.length;a++)t.result.wlanList[a].key=s.decoder(t.result.wlanList[a].key),t.result.wlanList[a].authSecret=s.decoder(t.result.wlanList[a].authSecret),t.result.wlanList[a].acctSecret=s.decoder(t.result.wlanList[a].acctSecret);e.wlanInfo=t.result,e.wlans=e.wlanInfo.wlanList;for(var a=0;a<e.wlans.length;a++)e.wlanClients=i.getWlanClient(e.wlans[a].ssid),null!=e.wlanClients?e.wlans[a].clients=e.wlanClients.length:e.wlans[a].clients=0;e.wlans.length>5?e.titleWidth="padding-right:17px;":e.titleWidth=""}},function(){})},e.wlanManagement.query(),e.modal=null,e.newWlan=function(){t.open({templateUrl:"wlan/wlan-conf.html",controller:"wlanConfContronller",size:"md",backdrop:!0,resolve:{wlans:function(){return e.wlans}}},function(){e.wlanManagement.query()},function(){e.wlanManagement.query()})},e.showWlanList=function(){t.open({templateUrl:"wlan/wlan-list.html",controller:"listContronller",size:"lg",backdrop:!0,resolve:{wlans:function(){return e.wlans}}},function(t){e.wlanManagement.query()},function(t){e.wlanManagement.query()})},e.configStatus=function(t){t.key=s.encoder(t.key),t.authSecret=s.encoder(t.authSecret),t.acctSecret=s.encoder(t.acctSecret);var n,i=JSON.stringify(t);n=t.enable?"wlan_edit_status_1":"wlan_edit_status_2";var r=t.ssid;a.request("put","/wlanStatus/"+e.urlEscape(t.ssid),null,i,function(){e.wlanManagement.query()},null,n,null,r)},e.showMonitorData=function(t){var n="WLAN:"+t.ssid;r.changeObser("wlan",t.ssid,n),e.clientManagement.changeClient("wlan",t.ssid)}}]).directive("hover",["InterService",function(e){return{restrict:"A",link:function(t,n,a){n.bind("mouseover",function(t){"1"==n.attr("mnuelevel")?e.skin.isBlue?n.css("background-color","#608ebd"):e.skin.isPurple&&n.css("background-color","#9482a5"):"2"==n.attr("mnuelevel")?e.skin.isBlue?n.css("background-color","#c4dff1"):e.skin.isPurple&&n.css("background-color","#ddcfe0"):"0"==n.attr("mnuelevel")&&(e.skin.isBlue?n.css("background-color","#608ebd"):e.skin.isPurple&&n.css("background-color","#9482a5"))}),n.bind("mouseleave",function(){"0"!=n.attr("mnuelevel")?n.removeAttr("style"):n.attr("style","padding:0px;")})}}}]),angular.module("wlan").filter("enableFilter",[function(){var e=function(e){switch(e){case!0:return"Yes";case!1:return"No"}};return e}]).filter("wlanStatusFilter",["$translate",function(e){var t=function(t){switch(t){case!0:return e.instant("Enable");case!1:return e.instant("Disable")}};return t}]).controller("listContronller",["$scope","$modalInstance","$translate","InterService","authentifiedRequest","batchSyncConfig","toastr","wlans","hanCrypto","$timeout",function(e,t,n,a,i,r,s,o,l,c){function u(t,n){switch(n){case 1:e.isFormat_1=!t;break;case 2:e.isFormat_2=!t;break;case 3:e.isFormat_3=!t;break;case 4:e.isFormat_4=!t}}function p(t,n){switch(n){case 1:e.isEightFormat_1=!t;break;case 2:e.isEightFormat_2=!t;break;case 3:e.isEightFormat_3=!t;break;case 4:e.isEightFormat_4=!t}}function d(t,n){switch(n){case 1:e.isDownFormat_1=!t;break;case 2:e.isDownFormat_2=!t;break;case 3:e.isDownFormat_3=!t;break;case 4:e.isDownFormat_4=!t}}function f(t,n){switch(n){case 1:e.isDownEightFormat_1=!t;break;case 2:e.isDownEightFormat_2=!t;break;case 3:e.isDownEightFormat_3=!t;break;case 4:e.isDownEightFormat_4=!t}}e.skin=a.skin,e.isPersonal=!1,e.isEnterprise=!1,e.isCapital=!1,e.isCaptivePortal=!1,e.isDetailPersonal=!1,e.isDetailEnterprise=!1,e.ST={editSecurity:{id:"",name:"",units:[]}},e.Encryption={editEncryption:{id:"",name:"",value:""}},e.InterService=a,e.FORMAT={formatSelected:{id:"",name:""}},e.disabledSelect=!1,e.wlanList=o,e.band={twoG:!0,fiveG:!0},e.isTwoG=!0,e.countryCode=a.getCountryCode(),"CS"==e.countryCode&&(e.band={twoG:!1,fiveG:!0},e.isTwoG=!1),e.securityTypeArray=[{id:"00",name:"Open",units:[]},{id:"01",name:"Personal",units:[{id:"0109",name:"Both(wpa &wpa2)",value:"psk-mixed+tkip+aes"},{id:"0107",name:"wpa2-personal",value:"psk2+aes"}]},{id:"02",name:"Enterprise",units:[{id:"0209",name:"Both(wpa &wpa2)",value:"wpa-mixed+tkip+aes"},{id:"0207",name:"wpa2-enterprise",value:"wpa2+aes"}]}],e.passphraseFormatArray=[{id:"1",name:"8-63 chars"},{id:"2",name:"64 Hexadecimal chars"}],e.createSecurity=e.securityTypeArray[1],e.createEncryption=e.createSecurity.units[0],e.selectedAT=e.securityTypeArray[0],e.formatSelected=e.passphraseFormatArray[0],e.redisSwitch={isSwitch:!1},e.isRedisShow=!1,e.redisChange=function(t){t?(e.isRedisShow=!0,console.info("this is  "+t)):(e.isRedisShow=!1,console.info("this is  "+t))},e.initDivShow=function(){e.isCreate=!1,e.isEdit=!1,e.isDetail=!1,e.isWmm=!1,e.isWmmEdit=!1},e.initDivShow(),e.fprmatMsg={flag:0,msg:""},e.selecFormat=function(){"1"==this.formatSelected.id?(e.fprmatMsg.flag=1,e.fprmatMsg.msg=n.instant("enter8-63Chars")):"2"==this.formatSelected.id&&(e.fprmatMsg.flag=2,e.fprmatMsg.msg=n.instant("enter64Chars"))},e.uplink={dscpBg:"",dscpBe:"",dscpVideo:"",dscpVoice:"",eightBg:"",eightBe:"",eightVideo:"",eightVoice:""},e.downlink={dscpBg:"",dscpBe:"",dscpVideo:"",dscpVoice:"",eightBg:"",eightBe:"",eightVideo:"",eightVoice:""},e.wmmd={dscpSwitch:!1,dot1pSwitch:!1},e.urlEscape=function(e){return e=e.replace(/\+/g,"%2B"),e=e.replace(/\//g,"%2F"),e=e.replace(/\?/g,"%3F"),e=e.replace(/%/g,"%25"),e=e.replace(/#/g,"%23"),e=e.replace(/&/g,"%26"),e=e.replace(/=/g,"%3D"),e=e.replace(/\\/g,"%5C"),e=e.replace(/\./g,"%2E"),e=e.replace(/:/g,"%3A")},e.query=function(t){var n={};i.get("/wlans",n,function(n,a){if(200==a&&null!=n&&n.success){for(var i=0;i<n.result.wlanList.length;i++)n.result.wlanList[i].key=l.decoder(n.result.wlanList[i].key),n.result.wlanList[i].authSecret=l.decoder(n.result.wlanList[i].authSecret),n.result.wlanList[i].acctSecret=l.decoder(n.result.wlanList[i].acctSecret);if(e.wlanList=n.result.wlanList,""!=t)for(var i=0;i<e.wlanList.length;i++)if(t==e.wlanList[i].ssid){e.currentWlan=e.wlanList[i];break}}},function(){})},e.cancel=function(){t.close()},e.newWlan={authPort:1812,acctPort:1813},e.showCreate=function(){e.newWlan.maxClients=64,e.newWlan.probeThreshold=0,e.newWlan.hidden="No",e.newWlan.enable="Yes",e.newWlan.captivePortal="No",e.newWlan.vlanId=0,e.newWlan.upstreamLimit=0,e.newWlan.downstreamLimit=0,e.isPersonal=!0,e.isEnterprise=!1,e.isDetailPersonal=!1,e.isDetailEnterprise=!1,e.isCreate=!0,e.isEdit=!1,e.isDetail=!1,e.isWmm=!1,e.isWmmEdit=!1,e.isCapital=!1,e.redisSwitch.isSwitch=!0,this.createSecurity=e.securityTypeArray[1],this.createEncryption=this.createSecurity.units[0]},e.changeSecurityType=function(){"00"==this.createSecurity.id?(e.isPersonal=!1,e.isEnterprise=!1,e.isCapital=!0):"01"==this.createSecurity.id?(e.isPersonal=!0,e.isEnterprise=!1,e.isCapital=!1,this.createEncryption=this.createSecurity.units[0]):"02"==this.createSecurity.id&&(e.isPersonal=!1,e.isEnterprise=!0,e.isCapital=!1,e.isRedisShow=!1,e.redisSwitch.isSwitch=!1,this.createEncryption=this.createSecurity.units[0])},e.isWlanExist=function(e,t){for(var n=0;n<t.length;n++)if(e==t[n].ssid)return!0;return!1},e.createWlan=function(){if(e.isWlanExist(e.newWlan.ssid,e.wlanList))s.info(n.instant("wlanAlreadyExist1")+e.newWlan.ssid+n.instant("wlanAlreadyExist2"),"");else{if(e.band.twoG&&e.band.fiveG)e.newWlan.band="2G,5G";else if(e.band.twoG)e.newWlan.band="2G";else{if(!e.band.fiveG)return void s.info(n.instant("pleaseSelectedBand"),"");e.newWlan.band="5G"}e.newWlan.securityType=this.createSecurity.name,e.securityTypeArray[0].name!==e.newWlan.securityType&&(e.newWlan.encryption=this.createEncryption.value),e.redisSwitch.isSwitch||(e.newWlan.acctServer="",e.newWlan.acctPort="",e.newWlan.acctSecret="");var t=angular.copy(e.newWlan);t.key=l.encoder(t.key),t.keyConfirm=l.encoder(t.keyConfirm),t.authSecret=l.encoder(t.authSecret),t.acctSecret=l.encoder(t.acctSecret);var a=JSON.stringify(t),i="wlan_add_1",o=e.newWlan.ssid;r.request("post","/advanceWlan",null,a,function(){e.newWlan={},e.band.twoG=!0,e.band.fiveG=!0,e.initDivShow(),e.isDetail=!0,c(function(){e.query(t.ssid)},2e3)},null,i,null,o)}},e.oldssid="",e.oldWlan={},e.showEdit=function(t){e.oldssid=t.ssid,"open"==t.securityType?(this.ST.editSecurity=e.securityTypeArray[0],e.isDetailPersonal=!1,e.isDetailEnterprise=!1,e.isCapital=!0):"personal"==t.securityType?(e.isCapital=!1,this.ST.editSecurity=e.securityTypeArray[1],e.isDetailPersonal=!0,e.isDetailEnterprise=!1,t.keyConfirm=t.key,"psk-mixed+tkip+aes"==t.encryption?this.Encryption.editEncryption=this.ST.editSecurity.units[0]:"psk2+aes"==t.encryption&&(this.Encryption.editEncryption=this.ST.editSecurity.units[1])):"enterprise"==t.securityType&&(e.isCapital=!1,e.isDetailPersonal=!1,e.isDetailEnterprise=!0,this.ST.editSecurity=e.securityTypeArray[2],"wpa-mixed+tkip+aes"==t.encryption?this.Encryption.editEncryption=this.ST.editSecurity.units[0]:"wpa2+aes"==t.encryption&&(this.Encryption.editEncryption=this.ST.editSecurity.units[1]),null!=t.acctServer&&""!=t.acctServer?(e.redisSwitch.isSwitch=!0,e.isRedisShow=!0):(e.redisSwitch.isSwitch=!1,e.isRedisShow=!1)),console.info(t.key),64==t.key.length?this.FORMAT.formatSelected=e.passphraseFormatArray[1]:this.FORMAT.formatSelected=e.passphraseFormatArray[0],console.info(this.FORMAT.formatSelected),e.currentWlan=angular.copy(t),e.oldWlan=angular.copy(t),e.isCreate=!1,e.isEdit=!0,e.isDetail=!1,e.isWmm=!1,e.isWmmEdit=!1},e.changeSecurity=function(){e.ST.editSecurity=this.ST.editSecurity,"00"==this.ST.editSecurity.id?(e.isDetailPersonal=!1,e.isDetailEnterprise=!1,e.isCapital=!0):"01"==this.ST.editSecurity.id?(e.isDetailPersonal=!0,e.isDetailEnterprise=!1,e.isCapital=!1,this.Encryption.editEncryption=this.ST.editSecurity.units[0]):"02"==this.ST.editSecurity.id&&(e.isDetailPersonal=!1,e.isDetailEnterprise=!0,e.isCapital=!1,e.isRedisShow=!1,e.redisSwitch.isSwitch=!1,this.Encryption.editEncryption=this.ST.editSecurity.units[0])},e.newCurrentWlan={},e.editWlan=function(){if(e.oldWlan.ssid!=e.currentWlan.ssid&&e.isWlanExist(e.currentWlan.ssid,e.wlanList))return void s.info(n.instant("wlanAlreadyExist1")+e.currentWlan.ssid+n.instant("wlanAlreadyExist2"),"");e.band.twoG&&e.band.fiveG?e.currentWlan.band="2G,5G":e.band.twoG?e.currentWlan.band="2G":e.currentWlan.band="5G",e.currentWlan.securityType=this.ST.editSecurity.name,e.securityTypeArray[0].name!==e.currentWlan.securityType&&(e.currentWlan.encryption=this.Encryption.editEncryption.value),e.oldWlan.ssid!=e.currentWlan.ssid&&(e.newCurrentWlan.ssid=e.currentWlan.ssid),e.oldWlan.enable!=e.currentWlan.enable&&(e.newCurrentWlan.enable=e.currentWlan.enable),e.oldWlan.hidden!=e.currentWlan.hidden&&(e.newCurrentWlan.hidden=e.currentWlan.hidden),e.oldWlan.maxClients!=e.currentWlan.maxClients&&(e.newCurrentWlan.maxClients=e.currentWlan.maxClients),e.oldWlan.probeThreshold!=e.currentWlan.probeThreshold&&(e.newCurrentWlan.probeThreshold=e.currentWlan.probeThreshold),e.oldWlan.vlanId!=e.currentWlan.vlanId&&(e.newCurrentWlan.vlanId=e.currentWlan.vlanId),e.oldWlan.upstreamLimit!=e.currentWlan.upstreamLimit&&(e.newCurrentWlan.upstreamLimit=e.currentWlan.upstreamLimit),e.oldWlan.downstreamLimit!=e.currentWlan.downstreamLimit&&(e.newCurrentWlan.downstreamLimit=e.currentWlan.downstreamLimit),e.oldWlan.securityType.toUpperCase()!=e.currentWlan.securityType.toUpperCase()&&(e.newCurrentWlan.securityType=e.currentWlan.securityType),e.oldWlan.encryption!=e.currentWlan.encryption&&(e.newCurrentWlan.encryption=e.currentWlan.encryption),"Open"==e.currentWlan.securityType?(e.oldWlan.captivePortal!=e.currentWlan.captivePortal&&(e.newCurrentWlan.captivePortal=e.currentWlan.captivePortal),e.oldWlan.fast&&(e.newCurrentWlan.fast=0),e.oldWlan.okc&&(e.newCurrentWlan.fast=0)):"Personal"==e.currentWlan.securityType?(e.oldWlan.key!=e.currentWlan.key&&(e.newCurrentWlan.key=l.encoder(e.currentWlan.key)),e.oldWlan.fast!=e.currentWlan.fast&&(e.newCurrentWlan.fast=e.currentWlan.fast),"Yes"==e.oldWlan.captivePortal&&(e.newCurrentWlan.captivePortal="No"),e.newCurrentWlan.keyConfirm=l.encoder(e.currentWlan.keyConfirm)):"Enterprise"==e.currentWlan.securityType&&(e.oldWlan.authServer!=e.currentWlan.authServer&&(e.newCurrentWlan.authServer=e.currentWlan.authServer),""==e.oldWlan.authPort&&(e.newCurrentWlan.authPort=1812),e.oldWlan.authPort!=e.currentWlan.authPort&&(e.newCurrentWlan.authPort=e.currentWlan.authPort),e.oldWlan.authSecret!=e.currentWlan.authSecret&&(e.newCurrentWlan.authSecret=l.encoder(e.currentWlan.authSecret)),e.oldWlan.acctServer!=e.currentWlan.acctServer&&(e.newCurrentWlan.acctServer=e.currentWlan.acctServer),e.oldWlan.acctPort!=e.currentWlan.acctPort&&(e.newCurrentWlan.acctPort=e.currentWlan.acctPort),e.oldWlan.acctSecret!=e.currentWlan.acctSecret&&(e.newCurrentWlan.acctSecret=l.encoder(e.currentWlan.acctSecret)),"Yes"==e.oldWlan.captivePortal&&(e.newCurrentWlan.captivePortal="No"),e.oldWlan.fast!=e.currentWlan.fast&&(e.currentWlan.fast?e.newCurrentWlan.fast=1:e.newCurrentWlan.fast=0),e.oldWlan.okc!=e.currentWlan.okc&&(e.currentWlan.okc?e.newCurrentWlan.okc=1:e.newCurrentWlan.okc=0),e.redisSwitch.isSwitch||(e.newCurrentWlan.acctServer="",e.newCurrentWlan.acctPort="",e.newCurrentWlan.acctSecret=""));var t=JSON.stringify(e.newCurrentWlan),a="wlan_edit",i=e.oldssid;r.request("put","/wlan/"+e.urlEscape(e.oldssid),null,t,function(){e.initDivShow(),e.isDetail=!0,c(function(){e.query(e.newCurrentWlan.ssid),e.newCurrentWlan={}},2e3)},null,a,null,i)},e.viewWlan={},e.username=window.localStorage.username,e.isDetailRedius=!1,e.showDetail=function(t){e.viewWlan=angular.copy(t),"open"==e.viewWlan.securityType?(e.isPersonInfo=!1,e.isEnterpriseInfo=!1,e.isCaptivePortal=!0):"personal"==e.viewWlan.securityType?(e.viewWlan.key="**************","psk-mixed+tkip+aes"==t.encryption?e.viewWlan.encryption=e.securityTypeArray[1].units[0].name:"psk2+aes"==t.encryption&&(e.viewWlan.encryption=e.securityTypeArray[1].units[1].name),e.isPersonInfo=!0,e.isEnterpriseInfo=!1,e.isCaptivePortal=!1):"enterprise"==e.viewWlan.securityType&&(e.viewWlan.authSecret="**************",null==e.viewWlan.acctServer||""==e.viewWlan.acctServer?e.isDetailRedius=!1:(e.isDetailRedius=!0,e.viewWlan.acctSecret="**************"),"wpa-mixed+tkip+aes"==t.encryption?e.viewWlan.encryption=e.securityTypeArray[2].units[0].name:"wpa2+aes"==t.encryption&&(e.viewWlan.encryption=e.securityTypeArray[2].units[1].name),e.isPersonInfo=!1,e.isEnterpriseInfo=!0,e.isCaptivePortal=!1),e.viewWlan.fast?e.viewWlan.fast="Open":e.viewWlan.fast="Close",e.viewWlan.okc?e.viewWlan.okc="Open":e.viewWlan.okc="Close",e.isCreate=!1,e.isEdit=!1,e.isDetail=!0,e.isWmm=!1,e.isWmmEdit=!1},e.deleteWlan=function(t){var a="wlan_delete",i=t,s=n.instant("delWlan")+t+" ?";bootbox.confirm(s,function(n){n&&r.request("delete","/wlan/"+e.urlEscape(t),null,null,function(){c(function(){e.query("")},2e3)},null,a,null,i)})},e.queryWmmParam=function(t){i.get("/wlan/"+t+"/wmm/confParams",null,function(t){if(null!=t&&t.success){var n=t.result;e.uplink.dscpBg=n.bk_to_dscp,e.uplink.dscpBe=n.be_to_dscp,e.uplink.dscpVideo=n.vi_to_dscp,e.uplink.dscpVoice=n.vo_to_dscp,e.uplink.eightBg=n.bk_to_dot1p,e.uplink.eightBe=n.be_to_dot1p,e.uplink.eightVideo=n.vi_to_dot1p,e.uplink.eightVoice=n.vo_to_dot1p,e.downlink.dscpBg=n.dscp_to_bk,e.downlink.dscpBe=n.dscp_to_be,e.downlink.dscpVideo=n.dscp_to_vi,e.downlink.dscpVoice=n.dscp_to_vo,e.downlink.eightBg=n.dot1p_to_bk,e.downlink.eightBe=n.dot1p_to_be,e.downlink.eightVideo=n.dot1p_to_vi,e.downlink.eightVoice=n.dot1p_to_vo,e.wmmd.dscpSwitch=n.dscp_enable,e.wmmd.dot1pSwitch=n.dot1p_enable}},function(){})},e.showWmm=function(t){e.uplink={dscpBg:"",dscpBe:"",dscpVideo:"",dscpVoice:"",eightBg:"",eightBe:"",eightVideo:"",eightVoice:""},e.downlink={dscpBg:"",dscpBe:"",dscpVideo:"",dscpVoice:"",eightBg:"",eightBe:"",eightVideo:"",eightVoice:""},e.wmmd.dscpSwitch=!1,e.wmmd.dot1pSwitch=!1,e.wmmSsid=e.urlEscape(t),e.isCreate=!1,e.isEdit=!1,e.isDetail=!1,e.isWmm=!0,e.isWmmEdit=!1,e.queryWmmParam(e.wmmSsid)},e.showEditWmm=function(){e.isWmm=!1,e.isWmmEdit=!0},e.cancelWmm=function(){e.isWmm=!0,e.isWmmEdit=!1},e.wmmswitchchange=function(t){var n=e.wmmSsid,a={switchType:t,switchValue:0},i="wmm_log_close";"dscp_enable"==t&&e.wmmd.dscpSwitch?(a.switchValue=1,i="wmm_log_open"):"dot1p_enable"==t&&e.wmmd.dot1pSwitch&&(a.switchValue=1,i="wmm_log_open"),i+="dscp_enable"==t?"_dscpswitch":"_dot1pwitch",r.request("put","/wlan/"+n+"/wmmSwitch",null,a,function(){e.isWmmEdit=!1,e.isWmm=!0,e.queryWmmParam(n)},null,i)},e.validFlag=!1,e.saveWmmInfo=function(){var t=e.wmmSsid,n={bk_to_dscp:"",be_to_dscp:"",vi_to_dscp:"",vo_to_dscp:"",bk_to_dot1p:"",be_to_dot1p:"",vi_to_dot1p:"",vo_to_dot1p:"",dscp_to_bk:"",dscp_to_be:"",dscp_to_vi:"",dscp_to_vo:"",dot1p_to_bk:"",dot1p_to_be:"",dot1p_to_vi:"",dot1p_to_vo:""};n.bk_to_dscp=e.uplink.dscpBg,n.be_to_dscp=e.uplink.dscpBe,n.vi_to_dscp=e.uplink.dscpVideo,n.vo_to_dscp=e.uplink.dscpVoice,n.bk_to_dot1p=e.uplink.eightBg,n.be_to_dot1p=e.uplink.eightBe,n.vi_to_dot1p=e.uplink.eightVideo,n.vo_to_dot1p=e.uplink.eightVoice,n.dscp_to_bk=e.downlink.dscpBg,n.dscp_to_be=e.downlink.dscpBe,n.dscp_to_vi=e.downlink.dscpVideo,n.dscp_to_vo=e.downlink.dscpVoice,n.dot1p_to_bk=e.downlink.eightBg,n.dot1p_to_be=e.downlink.eightBe,n.dot1p_to_vi=e.downlink.eightVideo,n.dot1p_to_vo=e.downlink.eightVoice;var a="wmm_log_params_modify";r.request("put","/wlan/"+t+"/wmm/confParams",null,n,function(){e.isWmmEdit=!1,e.isWmm=!0,e.queryWmmParam(t)},null,a)},e.uplinkdscp=function(t,n){var a=/^\d+$/g;a.test(t)?0>t||t>63?(e.validFlag=!0,u(!1,n)):(e.validFlag=!1,u(!0,n)):(e.validFlag=!0,u(!1,n))},e.uplinkEight=function(t,n){var a=/^\d+$/g;a.test(t)?0>t||t>7?(e.validFlag=!0,p(!1,n)):(e.validFlag=!1,p(!0,n)):(e.validFlag=!0,p(!1,n))},e.downlink_msgInfo="",e.downlink_eight_msgInfo="",e.downlinkdscp=function(t,a){var i=/^\d+(,\d+)*$/g;if(i.test(t)){var r=t.split(",");if(r.length>8||0==r.length)e.validFlag=!0,e.downlink_msgInfo=n.instant("enterMostEight"),d(!1,a);else{e.downlink_msgInfo=n.instant("enterMustBe63");for(var s=0;s<r.length;s++){var o=parseInt(r[s]);o>63||0>o?(e.validFlag=!0,d(!1,a)):(e.validFlag=!1,d(!0,a))}}}else e.validFlag=!0,e.downlink_msgInfo=n.instant("enterNotMatch"),d(!1,a)},e.downlinkEight=function(t,a){var i=/^\d+(,\d+)*$/g;if(i.test(t)){var r=t.split(",");if(r.length>8||0==r.length)e.downlink_eight_msgInfo=n.instant("enterMostEight"),e.validFlag=!0,f(!1,a);else{e.downlink_eight_msgInfo=n.instant("enterMustBe7");for(var s=0;s<r.length;s++){var o=parseInt(r[s]);o>7||0>o?(e.validFlag=!0,f(!1,a)):(e.validFlag=!1,f(!0,a))}}}else e.downlink_eight_msgInfo=n.instant("enterNotMatch"),e.validFlag=!0,f(!1,a)},e.wmmReset=function(){e.uplink={dscpBg:"8",dscpBe:"0",dscpVideo:"40",dscpVoice:"56",eightBg:"1",eightBe:"0",eightVideo:"4",eightVoice:"5"},e.downlink={dscpBg:"8,10,16,20",dscpBe:"0,6,24,30",dscpVideo:"32,36,40,46",dscpVoice:"48,56,60,63",eightBg:"1,2",eightBe:"0,3",eightVideo:"4,5",eightVoice:"6,7"}},e.codeDetailStart=!1,e.codeDetailEnd="",e.isDetailFormat=!1,e.isDetailTrue=!0,e.changeWlanName=function(t){if(null!=t&&""!=t){var a=t.substring(0,1);"*"==a||"."==a||"\\"==a?(e.codeDetailStart=!0,e.codeDetailEnd=n.instant("canNotBegin"),e.isDetailFormat=!0,e.isDetailTrue=!0):(e.codeDetailStart=!1,e.isDetailFormat=!1,e.isDetailTrue=!1);var i=t.substring(t.length-1,t.length);e.codeDetailStart||"\\"!=i||(e.codeDetailEnd=n.instant("canNotEnd"),e.isDetailFormat=!0,e.isDetailTrue=!0);var r=/\s+/,s=r.test(t);console.log(s),s&&(e.codeDetailStart=!0,e.codeDetailEnd=n.instant("canNotBlanks"),e.isDetailFormat=!0,e.isDetailTrue=!0)}else e.isDetailFormat=!1,e.isDetailTrue=!0},e.codeEditStart=!1,e.codeEditEnd="",e.isEditFormat=!1,e.isEditTrue=!1,e.changeEditSSID=function(t){if(null!=t&&""!=t){var a=t.substring(0,1);"*"==a||"."==a||"\\"==a?(e.codeEditStart=!0,e.codeEditEnd=n.instant("canNotBegin"),e.isEditFormat=!0,e.isEditTrue=!0):(e.codeEditStart=!1,e.isEditFormat=!1,e.isEditTrue=!1);var i=t.substring(t.length-1,t.length);e.codeEditStart||"\\"!=i||(e.codeEditEnd=n.instant("canNotEnd"),e.isEditFormat=!0,e.isEditTrue=!0);var r=/\s+/,s=r.test(t);console.log(s),s&&(e.codeEditStart=!0,e.codeEditEnd=n.instant("canNotBlanks"),e.isEditFormat=!0,e.isEditTrue=!0)}else e.isEditFormat=!1,e.isEditTrue=!0},e.selecFormat=function(){e.formatSelected=this.formatSelected}}]),angular.module("wlan").controller("wlanConfContronller",["$scope","$modalInstance","$translate","InterService","batchSyncConfig","toastr","hanCrypto","wlans",function(e,t,n,a,i,r,s,o){function l(a){if(e.isWlanExist(e.wlanInfo.ssid,e.wlanList))r.info(n.instant("wlanAlreadyExist1")+e.wlanInfo.ssid+n.instant("wlanAlreadyExist2"),"");else{var o;if(a){var l="/advanceWlan";o="wlan_add_1"}else{var l="/wlan";o="wlan_add_2"}var c=e.wlanInfo.ssid,u=angular.copy(e.wlanInfo);u.key=s.encoder(u.key),u.keyConfirm=s.encoder(u.keyConfirm),u.authSecret=s.encoder(u.authSecret),u.acctSecret=s.encoder(u.acctSecret);var p=JSON.stringify(u);i.request("post",l,null,p,function(){t.close()},null,o,null,c)}}e.skin=a.skin,e.wlanList=o,e.wlanInfo={maxClients:64,probeThreshold:0,hidden:"No",enable:"Yes",captivePortal:"No",vlanId:0,upstreamLimit:0,downstreamLimit:0,securityType:"",encryption:"",authPort:1812,acctPort:1813},e.isWlan=!0,e.isAdvanceWlan=!1,e.isPersonal=!0,e.isEnterprise=!1,e.isCapital=!1,e.InterService=a,e.disabledSecurity=!1,e.disabledEncryption=!1,e.securityTypeArray=[{id:"00",name:"Open",units:[]},{id:"01",name:"Personal",units:[{id:"0109",name:"Both(wpa &wpa2)",value:"psk-mixed+tkip+aes"},{id:"0107",name:"wpa2-personal",value:"psk2+aes"}]},{id:"02",name:"Enterprise",units:[{id:"0209",name:"Both(wpa &wpa2)",value:"wpa-mixed+tkip+aes"},{id:"0207",name:"wpa2-enterprise",value:"wpa2+aes"}]}],e.passphraseFormatArray=[{id:"1",name:"8-63 chars"},{id:"2",name:"64 Hexadecimal chars"}],e.selectedSecurity=e.securityTypeArray[1],e.selectedEncryption=e.selectedSecurity.units[0],e.formatSelected=e.passphraseFormatArray[0],e.band={twoG:!0,fiveG:!0},e.isTwoG=!0,e.countryCode=a.getCountryCode(),"CS"==e.countryCode&&(e.band={twoG:!1,fiveG:!0},e.isTwoG=!1),e.redisSwitch={isSwitch:!1},e.isRedisShow=!1,e.redisChange=function(t){t?(e.isRedisShow=!0,console.info("this is  "+t)):(e.isRedisShow=!1,console.info("this is  "+t))},e.saveWlanInfo=function(){if(e.band.twoG&&e.band.fiveG)e.wlanInfo.band="2G,5G";else if(e.band.twoG)e.wlanInfo.band="2G";else{if(!e.band.fiveG)return void r.info(n.instant("pleaseSelectedBand"),"");e.wlanInfo.band="5G"}e.wlanInfo.securityType=this.selectedSecurity.name,e.securityTypeArray[0].name!==e.wlanInfo.securityType&&(e.wlanInfo.encryption=this.selectedEncryption.value),e.redisSwitch.isSwitch||(e.wlanInfo.acctServer="",e.wlanInfo.acctPort="",e.wlanInfo.acctSecret=""),l(!1)},e.cancel=function(){t.close()},e.showSimple=function(){e.isWlan=!0,e.isAdvanceWlan=!1},e.showAdvance=function(){e.isWlan=!1,e.isAdvanceWlan=!0},e.changeSecurity=function(){"00"==this.selectedSecurity.id?(e.isPersonal=!1,e.isEnterprise=!1,e.isCapital=!0):"01"==this.selectedSecurity.id?(e.isPersonal=!0,e.isEnterprise=!1,e.isCapital=!1,this.selectedEncryption=this.selectedSecurity.units[0]):"02"==this.selectedSecurity.id&&(e.isPersonal=!1,e.isEnterprise=!0,e.isCapital=!1,e.isRedisShow=!1,e.redisSwitch.isSwitch=!1,this.selectedEncryption=this.selectedSecurity.units[0])},e.saveWlanAdvance=function(){if(e.band.twoG&&e.band.fiveG)e.wlanInfo.band="2G,5G";else if(e.band.twoG)e.wlanInfo.band="2G";else{if(!e.band.fiveG)return void r.info(n.instant("pleaseSelectedBand"),"");e.wlanInfo.band="5G"}e.wlanInfo.securityType=this.selectedSecurity.name,e.securityTypeArray[0].name!==e.wlanInfo.securityType&&(e.wlanInfo.encryption=this.selectedEncryption.value),e.redisSwitch.isSwitch||(e.wlanInfo.acctServer="",e.wlanInfo.acctPort="",e.wlanInfo.acctSecret=""),l(!0)},e.isWlanExist=function(e,t){for(var n=0;n<t.length;n++)if(e==t[n].ssid)return!0;return!1},e.codeStart=!1,e.codeEnd="",e.isFormat=!1,e.isTrue=!1,e.changeSSID=function(t){if(null!=t&&""!=t){var a=t.substring(0,1);"*"==a||"."==a||"\\"==a?(e.codeStart=!0,e.codeEnd=n.instant("canNotBegin"),e.isFormat=!0,e.isTrue=!0):(e.codeStart=!1,e.isFormat=!1,e.isTrue=!1);var i=t.substring(t.length-1,t.length);e.codeStart||"\\"!=i||(e.codeEnd=n.instant("canNotEnd"),e.isFormat=!0,e.isTrue=!0);var r=/\s+/,s=r.test(t);console.log(s),s&&(e.codeStart=!0,e.codeEnd=n.instant("canNotBlanks"),e.isFormat=!0,e.isTrue=!0)}else e.isFormat=!1,e.isTrue=!0},e.codeDetailStart=!1,e.codeDetailEnd="",e.isDetailFormat=!1,e.isDetailTrue=!1,e.changeDetailSSID=function(t){if(null!=t&&""!=t){var a=t.substring(0,1);"*"==a||"."==a||"\\"==a?(e.codeDetailStart=!0,e.codeDetailEnd=n.instant("canNotBegin"),e.isDetailFormat=!0,e.isDetailTrue=!0):(e.codeDetailStart=!1,e.isDetailFormat=!1,e.isDetailTrue=!1);var i=t.substring(t.length-1,t.length);e.codeDetailStart||"\\"!=i||(e.codeDetailEnd=n.instant("canNotEnd"),e.isDetailFormat=!0,e.isDetailTrue=!0)}else e.isDetailFormat=!1,e.isDetailTrue=!0},e.selecFormat=function(){e.formatSelected=this.formatSelected}}]).directive("greenSlider",[function(){var e=function(e,t,n){$slider=jQuery(t);var a=n,i=function(e,t){t[e]&&(t[e]=parseInt(t[e]))};i("min",a),i("max",a),i("step",a),a=jQuery.extend({value:e[a.ngModel],change:function(t,a){if(n.ngModel&&a.value!=e[n.ngModel]){var i=n.ngModel+" = "+a.value;e.$apply(i),n.ngChange&&e.$eval(n.ngChange)}}},a),$slider.slider(a),a.ngModel&&e.$watch(a.ngModel,function(e){e!=$slider.slider("value")&&$slider.slider("value",e)})};return{restrict:"E",replace:!0,transclude:!1,template:"<div />",link:e}}]).filter("securityTypeFilter",[function(){var e=function(e){switch(e){case 10:return"open";case 20:return"WPA-2Personal";case 30:return"WPA-Personal(Both TKIP and AES Encryption)";case 40:return"WPA-Personal(TKIP Encryption only)";case 50:return"WPA-Personal(AES Encryption only)";case 60:return"Static WEP";case 70:return"WPA-2Enterprise";case 80:return"WPA Enterprise"}};return e}]),angular.module("monitor",[]).factory("monitorfactory",["$timeout",function(e){var t=function(e,t,n,a){null!=a&&"undefined"!=a||(a=10),nv.addGraph(function(){
for(var i=[],r=0;r<e.length;++r){var s=e[r].values,o=s.length;o>60&&s.shift();for(var l=0;l<s.length;++l)s[l].x=new Date(s[l].x),i.push(s[l].y)}var c=Math.max.apply(null,i);("undefined"==c||a>c)&&(c=a);var u=[0];u.push(c);var p=nv.models.lineChart().x(function(e){return e.x}).y(function(e){return e.y}).color(d3.scale.category10().range()).useInteractiveGuideline(!0);return p.margin({left:75}),p.xAxis.axisLabel(n).tickFormat(function(e){return d3.time.format("%X")(new Date(e))+"    "}),p.yAxis.showMaxMin(!0).tickFormat(function(e){return d3.format(".1")(e)}),p.yDomain(u),p.legend.updateState(!1),d3.select(t).datum(e).transition().duration(500).call(p),nv.utils.windowResize(p.update),p})},n=function(e,t,n){nv.addGraph(function(){var a=nv.models.discreteBarChart().x(function(e){return e.label}).y(function(e){return e.value}).color(d3.scale.category10().range()).tooltips(!1).showValues(!0).valueFormat(d3.format(".1"));a.margin({left:75}),a.xAxis.axisLabel(n).labelOffsetMark(!0),a.yAxis.showMaxMin(!0).tickFormat(function(e){return d3.format(".1")(e)});for(var i=[],r=e[0].values,s=0;s<r.length;++s){var o=r[s].value;i.push(o)}var l=Math.max.apply(null,i);("undefined"==l||10>l)&&(l=10);var c=[0];return c.push(l),a.yDomain(c),d3.select(t).datum(e).transition().duration(500).call(a),nv.utils.windowResize(a.update),a})};return{drowLineChart:t,drowDiscreteBarChart:n}}]).service("monitorService",["$filter","batchSyncConfig","authentifiedRequest","monitorfactory","clientService",function(e,t,n,a,i){vm=this,vm.obser="",vm.ap_ip="",vm.ap_mac="",vm.wlan_mac="",vm.client_mac="",vm.data_throughput=[],vm.data_cpuAndMem=[],vm.data_client=[],vm.data_rouge_apAndClient=[],vm.data_client_speed=[],vm.data_client_signal=[],vm.dataInit=function(){var t=new Date;t.setSeconds(t.getSeconds()-10);var n=e("date")(t,"yyyy/MM/dd HH:mm:ss");vm.data_throughput=[{key:"RX",values:[{x:n,y:0}]},{key:"TX",values:[{x:n,y:0}]}],vm.data_cpuAndMem=[{key:"cpu",values:[{x:n,y:0}]},{key:"mem",values:[{x:n,y:0}]}],vm.data_client=[{key:"client",values:[{x:n,y:0}]}],vm.data_rouge_apAndClient=[{key:"Rogue AP",values:[{x:n,y:0}]},{key:"Interfering AP",values:[{x:n,y:0}]}],vm.data_client_speed=[{key:"RX",values:[{x:n,y:0}]},{key:"TX",values:[{x:n,y:0}]}],vm.data_client_signal=[{key:"rssi",values:[{x:n,y:0}]}],vm.data_client_band=[{key:"bar chart",values:[{label:"2.4GHz",value:0},{label:"5GHz",value:0}]}],vm.data_client_health=[{key:"bar chart",values:[{label:"Best",value:0},{label:"Good",value:0},{label:"Fair",value:0}]}]},vm.drowClusterCpuAndMemLineChart=function(n){t.getAll("/monitor/cpuAndMemUsage",null,function(t){var i=t.length;if(0!=i){var r=t,s=e("date")(new Date,"yyyy/MM/dd HH:mm:ss"),o=0,l=0;angular.forEach(r,function(e){o+=parseInt(e.cpu),l+=parseInt(e.mem)}),o=Math.floor(o/i),l=Math.floor(l/i);var c=vm.data_cpuAndMem[0].values,u=new Array;u.x=s,u.y=o,c.push(u);var p=vm.data_cpuAndMem[1].values,d=new Array;d.x=s,d.y=l,p.push(d)}a.drowLineChart(vm.data_cpuAndMem,n,"CPU/MEM utilization(%)",null)})},vm.drowSingleApCpuAndMemLineChart=function(t,i){var r="http://",s=":8080",o=r+t+s+"/monitor/cpuAndMemUsage";n.request("get",o,null,null,15e3,function(t){if(null!=t&&t.success){var n=t.result,r=e("date")(new Date,"yyyy/MM/dd HH:mm:ss"),s=vm.data_cpuAndMem[0].values,o=new Array;o.x=r,o.y=n.cpu,s.push(o);var l=vm.data_cpuAndMem[1].values,c=new Array;c.x=r,c.y=n.mem,l.push(c)}a.drowLineChart(vm.data_cpuAndMem,i,"CPU/MEM utilization(%)",null)},function(){})},vm.drowSingleApRogueApLineChart=function(t,i){var r="http://",s=":8080",o=r+t+s+"/monitor/rogueApAndClient";n.request("get",o,null,null,15e3,function(t){if(null!=t&&t.success){var n=t.result,r=e("date")(new Date,"yyyy/MM/dd HH:mm:ss"),s=vm.data_rouge_apAndClient[0].values,o=new Array;o.x=r,o.y=n.rogue_ap_num,s.push(o);var l=vm.data_rouge_apAndClient[1].values,c=new Array;c.x=r,c.y=n.interfering_ap_num,l.push(c)}a.drowLineChart(vm.data_rouge_apAndClient,i,"Rogue/Interfering",null)},function(){})},vm.drowThroughputLineChart=function(t,n){var r=i.getClientList(),s=0,o=0,l=function(e){s=(100*s+100*Number(e.UPRATE))/100,o=(100*o+100*Number(e.DOWNRATE))/100};angular.forEach(r,function(e){"cluster"==vm.obser?l(e):"wlan"==vm.obser&&e.WLAN==t?l(e):"ap"==vm.obser&&e.AP==t?l(e):"client"==vm.obser&&e.UserMAC==t&&l(e)});var c=e("date")(new Date,"yyyy/MM/dd HH:mm:ss"),u=vm.data_throughput[0].values,p=new Array;p.x=c,p.y=s.toFixed(2),u.push(p);var d=vm.data_throughput[1].values,f=new Array;f.x=c,f.y=o.toFixed(2),d.push(f),a.drowLineChart(vm.data_throughput,n,"Throughput(Mbps)",1)},vm.drowClientsLineChart=function(t,n){var r=i.getClientList(),s=0;"cluster"==vm.obser?s=r.length:angular.forEach(r,function(e){"wlan"==vm.obser&&e.WLAN==t?s++:"ap"==vm.obser&&e.AP==t&&s++});var o=e("date")(new Date,"yyyy/MM/dd HH:mm:ss"),l=vm.data_client[0].values,c=new Array;c.x=o,c.y=s,l.push(c),a.drowLineChart(vm.data_client,n,"Client",null)},vm.drowSpeedLineChart=function(t,n){var r=i.getClientList(),s=0,o=0;angular.forEach(r,function(e){"client"==vm.obser&&e.UserMAC==t&&(s=Number(e.RXRATE),o=Number(e.TXRATE))});var l=e("date")(new Date,"yyyy/MM/dd HH:mm:ss"),c=vm.data_client_speed[0].values,u=new Array;u.x=l,u.y=s,c.push(u);var p=vm.data_client_speed[1].values,d=new Array;d.x=l,d.y=o,p.push(d),a.drowLineChart(vm.data_client_speed,n,"PHY RX/TX(Mbps)",null)},vm.drowRSSILineChart=function(t,n){var r=i.getClientList(),s=0;angular.forEach(r,function(e){"client"==vm.obser&&e.UserMAC==t&&(s=e.RSSI)});var o=e("date")(new Date,"yyyy/MM/dd HH:mm:ss"),l=vm.data_client_signal[0].values,c=new Array;c.x=o,c.y=s,l.push(c),a.drowLineChart(vm.data_client_signal,n,"RSSI",null)},vm.drowClientBandBarChart=function(e,t){var n=i.getClientList(),r=0,s=0,o=function(e){"2.4ghz"==e?r+=1:"5ghz"==e&&(s+=1)};angular.forEach(n,function(e){var n=e.FREQ.toLowerCase();("cluster"==vm.obser||"wlan"==vm.obser&&e.WLAN==t||"ap"==vm.obser&&e.AP==t)&&o(n)});var l=vm.data_client_band[0].values,c=l[0];c.value=r;var u=l[1];u.value=s,a.drowDiscreteBarChart(vm.data_client_band,e,"Client Band")},vm.drowClientHealthBarChart=function(e,t){var n=i.getClientList(),r=0,s=0,o=0,l=function(e){-75>e?o+=1:e>-60?r+=1:s+=1};angular.forEach(n,function(e){var n=parseInt(e.RSSI)-95;("cluster"==vm.obser||"wlan"==vm.obser&&e.WLAN==t||"ap"==vm.obser&&e.AP==t)&&l(n)});var c=vm.data_client_health[0].values,u=c[0];u.value=r;var p=c[1];p.value=s;var d=c[2];d.value=o,a.drowDiscreteBarChart(vm.data_client_health,e,"Client Health")},vm.updateChartview=function(){"wlan"==vm.obser?(vm.drowThroughputLineChart(vm.wlan_ssid,"#cluster_chart5 svg"),vm.drowClientsLineChart(vm.wlan_ssid,"#cluster_chart6 svg"),vm.drowClientBandBarChart("#cluster_chart7 svg",vm.wlan_ssid),vm.drowClientHealthBarChart("#cluster_chart8 svg",vm.wlan_ssid)):"client"==vm.obser?(vm.drowThroughputLineChart(vm.client_mac,"#cluster_chart5 svg"),vm.drowRSSILineChart(vm.client_mac,"#cluster_chart6 svg"),vm.drowSpeedLineChart(vm.client_mac,"#cluster_chart7 svg")):"ap"==vm.obser?(vm.drowThroughputLineChart(vm.ap_mac,"#cluster_chart5 svg"),vm.drowClientsLineChart(vm.ap_mac,"#cluster_chart6 svg"),vm.drowClientBandBarChart("#cluster_chart7 svg",vm.ap_mac),vm.drowClientHealthBarChart("#cluster_chart8 svg",vm.ap_mac)):"cluster"==vm.obser&&(vm.drowThroughputLineChart(null,"#cluster_chart5 svg"),vm.drowClientsLineChart(null,"#cluster_chart6 svg"),vm.drowClientBandBarChart("#cluster_chart7 svg",null),vm.drowClientHealthBarChart("#cluster_chart8 svg",null))},vm.changeObser=function(e,t,n){d3.select("#cluster_chart5 svg").remove(),d3.select("#cluster_chart5").append("svg"),d3.select("#cluster_chart6 svg").remove(),d3.select("#cluster_chart6").append("svg"),d3.select("#cluster_chart7 svg").remove(),d3.select("#cluster_chart7").append("svg"),d3.select("#cluster_chart8 svg").remove(),d3.select("#cluster_chart8").append("svg"),d3.select("#viewer_title").text(n),vm.wlan_ssid="",vm.ap_ip="",vm.ap_mac="",vm.client_mac="",vm.dataInit(),vm.obser=e,"wlan"==vm.obser?vm.wlan_ssid=t:"client"==vm.obser?vm.client_mac=t:"ap"==vm.obser?(vm.ap_ip=t.ip,vm.ap_mac=t.mac):"cluster"==vm.obser,vm.updateChartview()}}]).controller("monitorController",[function(){}]),angular.module("main",["ui.bootstrap","ui.router","pascalprecht.translate","ngCookies","toastr","nvd3ChartDirectives","toggle-switch","angularFileUpload","wlan","module.ap.apinfo","module.wireless.rfManagement","module.wireless.rogueAp","module.wireless.others","system","module.terminal.acl","module.terminal.authentication","module.terminal.access","module.client","common","monitor"]).config(["toastrConfig",function(e){angular.extend(e,{allowHtml:!0,closeButton:!0,closeHtml:"<button>&times;</button>",containerId:"toast-container",extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},messageClass:"toast-message",positionClass:"toast-top-right",preventOpenDuplicates:!1,tapToDismiss:!1,timeOut:6e3,titleClass:"toast-title",toastClass:"toast"})}]).config(["$httpProvider",function(e){e.interceptors.push(function(){return{responseError:function(e){return 403==e.status,e}}})}]).factory("authentifiedRequest",["$http",function(e){var t=function(t,n,a,i,r,s,o){e({method:t,url:n,params:a,data:i,timeout:r,headers:{"Content-Type":"application/json",Authorization:"sessionName "+window.localStorage.sessionId}}).success(s).error(o)};return{get:function(e,n,a,i){t("get",e,n,null,15e3,a,i)},put:function(e,n,a,i,r){t("put",e,n,a,15e3,i,r)},post:function(e,n,a,i,r){t("post",e,n,a,15e3,i,r)},"delete":function(e,n,a,i){t("delete",e,n,data,15e3,a,i)},request:t}}]).factory("task",["$http","$q","authentifiedRequest",function(e,t,n){function a(e,t,n,a,i,r,s,o,l){this.mac=e,this.ip=t,this.method=n,this.uri=a,this.params=i,this.data=r,this.defer=s,this.onCompletelistener=o,this.timeout=l}function i(e,n,i,r,s,o,l,c){var u=new a(e,n,i.toLowerCase(),r,s,o,t.defer(),l,c);return u}return a.prototype.clone=function(){return i(this.mac,this.ip,this.method,this.uri,this.params,this.data,this.onCompletelistener,this.timeout)},a.prototype.execute=function(e){e=e||1;var a=this,i="http://",r=":8080",s=i+a.ip+r+a.uri,o=function(e,t){var n={mac:a.mac,ip:a.ip,success:!1,msg:"",result:[]};null==e||""==e?(n.success=!1,n.msg="log_backendServer_error"):(e.hasOwnProperty("success")&&(n.success=e.success),e.hasOwnProperty("msg")&&(n.msg=e.msg),e.hasOwnProperty("result")&&(n.result=e.result)),a.defer.resolve(n)},l=function(e,t){var n={mac:a.mac,ip:a.ip,success:!1,msg:"log_backendServer_error"};a.defer.reject(n)},c=15e3;return null!=a.timeout&&(c=a.timeout),n.request(a.method,s,a.params,a.data,c,o,l),a.defer.promise.then(function(e){a.onCompletelistener(e)},function(n){return 3>e?(e++,a.clone().execute(e)):(a.onCompletelistener(n),void t.reject(n))})},{create:i}}]).factory("batchSyncConfig",["$translate","$q","lockScreen","task","toastr","InterService","operationLog",function(e,t,n,a,i,r,s){var o=function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=function(t){var n=0,a=0,r=e.instant("log_apNumber_success")+":",s=e.instant("log_apNumber_fault")+":",o="";angular.forEach(t,function(t){t.success?n++:(a++,o=o+"<p>IP:"+t.ip+"&nbsp;"+e.instant("log_RSN")+":"+e.instant(t.msg)+"</p>")}),r="<p>"+r+n+"</p>",s="<p>"+s+a+"</p>"+o;var l=e.instant("log_operateResult")+":";i.info(r+s,l)},c=function(e,t,n){var a=new Array;angular.forEach(t,function(e){var t="module_operate_failure";e.success&&(t="module_operate_success");var n={ip:e.ip,success:t,msg:e.msg};a.push(n)}),s.setLog(e,a,n)};return{request:function(s,o,u,p,d,f,g,m,_){function h(e){v.push(e)}var v=[];n.lock(m);var w=[];w=null==f?r.getCanConfigAps():f;var C=[];if(angular.forEach(w,function(e){var t=a.create(e.mac,e.ip,s,o,u,p,h,m);C.push(t.execute())}),0==C.length){n.unlock();var y=e.instant("log_noRunningAp_fault");return i.error(y),void(null!=d&&d())}t.all(C).then(function(e){n.unlock(),l(v),null!=g&&""!=g&&c(g,v,_),null!=d&&d()})},getAll:function(e,n,i,s){function l(e){e.success&&(o(e.result)?Array.prototype.push.apply(c,e.result):c.push(e.result))}var c=[],u=r.getApListInfo(),p=[];return angular.forEach(u,function(t){if(3==t.state){var i=a.create(t.mac,t.ip,"get",e,n,null,l,s);p.push(i.execute())}}),0==p.length?null!=i?i(c):void 0:void t.all(p).then(function(e){null!=i&&i(c)})},putAll:function(e,i,s,l){function c(e){e.success&&(o(e.result)?Array.prototype.push.apply(u,e.result):u.push(e.result))}var u=[];n.lock(l);var p=r.getApListInfo(),d=[];return angular.forEach(p,function(t){if(3==t.state){var n=a.create(t.mac,t.ip,"put",e,null,i,c,l);d.push(n.execute())}}),0==d.length?null!=s?s(u):void 0:void t.all(d).then(function(e){null!=s&&s(u)})}}}]).factory("lockScreen",["$timeout","$rootScope",function(e,t){var n=null,a=function(a){n&&e.cancel(n),n=e(function(){t.loading=!1},a)},i=function(){a(1e3)},r=function(e){t.loading=!0,a(null==e?15e3:e)};return{lock:r,unlock:i}}]).service("hanCrypto",[function(){var e=this;e.encoder=function(e){return null==e||""==e?e:BASE64.encoder(e)},e.decoder=function(e){if(null==e||""==e)return e;for(var t=BASE64.decoder(e),n="",a=0,i=t.length;i>a;++a)n+=String.fromCharCode(t[a]);return n}}]).factory("operationLog",[function(){var e=new Array,t=function(){return e},n=function(t,n,a){var i=new Date,r={logname:"",loginfo:"",datetime:"",logtemp:""};r.logname=t,r.loginfo=n,r.logtemp=a,r.datetime=i,10==e.length&&e.shift(),e.push(r)},a=function(t){e=new Array};return{getLogs:t,setLog:n,cleanLogs:a}}]).factory("singleModal",["$modal",function(e){var t=this;return t.modal=null,t.draggable=function(){$(".modal-content").draggable({handle:".modal-header",cursor:"move",refreshPositions:!1})},{open:function(n,a,i){return null!=t.modal?null:(t.modal=e.open(n),t.modal.result.then(function(e){t.modal=null,null!=a&&a(e)},function(e){t.modal=null,null!=i&&i(e)}),t.modal.opened.then(function(){setTimeout(t.draggable,3e3)}),t.modal)}}}]).service("InterService",["authentifiedRequest","$cookieStore","clientService",function(e,t,n){var a=this;a.aplistinfo=[],a.countryCode="",a.PVCinfo="",a.setCountryCode=function(e){a.countryCode=e},a.getCountryCode=function(){return a.countryCode},a.getPVCinfo=function(e){return a.PVCinfo},a.setPVCinfo=function(e){a.PVCinfo=e},a.getApListInfo=function(){return a.aplistinfo},a.getCanConfigAps=function(){var e=a.aplistinfo,t=[];return angular.forEach(e,function(e){3!=e.state&&2!=e.state||t.push(e)}),t},a.setApListInfo=function(e){a.aplistinfo=e},a.skin={isPurple:!1,isBlue:!0,imageUrl:"assets/images/blue.png",isSelectSkin:!1},a.getSkin=function(){null==t.get("skin")||"blue"==t.get("skin")?(a.skin.isPurple=!1,a.skin.isBlue=!0,a.skin.imageUrl="assets/images/blue.png"):"purple"==t.get("skin")&&(a.skin.isPurple=!0,a.skin.isBlue=!1,a.skin.imageUrl="assets/images/purple.png")},a.changeSelectedBlueToPurple=function(){var e=$("#system_title_bg");e.hasClass("unfoldedlv1menublue")&&(e.removeClass("unfoldedlv1menublue").addClass("unfoldedlv1menupurple"),$("#sys_left_iconbg").removeClass("selected_icon_blue").addClass("selected_icon_purple"),$("#sys_right_iconbg").removeClass("selected_icon_blue").addClass("selected_icon_purple"));var t=$("#wireless_title_bg");t.hasClass("unfoldedlv1menublue")&&(t.removeClass("unfoldedlv1menublue").addClass("unfoldedlv1menupurple"),$("#wire_left_iconbg").removeClass("selected_icon_blue").addClass("selected_icon_purple"),$("#wire_right_iconbg").removeClass("selected_icon_blue").addClass("selected_icon_purple"));var n=$("#access_title_bg");n.hasClass("unfoldedlv1menublue")&&(n.removeClass("unfoldedlv1menublue").addClass("unfoldedlv1menupurple"),$("#acc_left_iconbg").removeClass("selected_icon_blue").addClass("selected_icon_purple"),$("#acc_right_iconbg").removeClass("selected_icon_blue").addClass("selected_icon_purple"))},a.changeSelectedPurpleToBlue=function(){var e=$("#system_title_bg");e.hasClass("unfoldedlv1menupurple")&&(e.removeClass("unfoldedlv1menupurple").addClass("unfoldedlv1menublue"),$("#sys_left_iconbg").removeClass("selected_icon_purple").addClass("selected_icon_blue"),$("#sys_right_iconbg").removeClass("selected_icon_purple").addClass("selected_icon_blue"));var t=$("#wireless_title_bg");t.hasClass("unfoldedlv1menupurple")&&(t.removeClass("unfoldedlv1menupurple").addClass("unfoldedlv1menublue"),$("#wire_left_iconbg").removeClass("selected_icon_purple").addClass("selected_icon_blue"),$("#wire_right_iconbg").removeClass("selected_icon_purple").addClass("selected_icon_blue"));var n=$("#access_title_bg");n.hasClass("unfoldedlv1menupurple")&&(n.removeClass("unfoldedlv1menupurple").addClass("unfoldedlv1menublue"),$("#acc_left_iconbg").removeClass("selected_icon_purple").addClass("selected_icon_blue"),$("#acc_right_iconbg").removeClass("selected_icon_purple").addClass("selected_icon_blue"))},a.setSkin=function(e){"purple"==e?(t.put("skin","purple"),a.skin.isSelectSkin=!1,a.skin.isPurple=!0,a.skin.isBlue=!1,a.skin.imageUrl="assets/images/purple.png",a.changeSelectedBlueToPurple()):"blue"==e&&(t.put("skin","blue"),a.skin.isSelectSkin=!1,a.skin.isPurple=!1,a.skin.isBlue=!0,a.skin.imageUrl="assets/images/blue.png",a.changeSelectedPurpleToBlue())},a.pattern={ldu4To16:"/^[\\w]{4,16}$/",ldu1to10:"/^[\\w]{1,10}$/",ldu1to20:"/^[\\w]{1,20}$/",ldu1to25:"/^[\\w]{1,25}$/",ldu1to30:"/^[\\w]{1,30}$/",ldu1to32:"/^[\\w]{1,32}$/",ldu1to32Demo:"/^[^`=]{1,32}$/",ldu8to63:"/^[\\w]{8,63}$/",ldu8to63Demo:"/^[^`=]{8,63}$/",GroupName:"/^[\\w-]{1,25}$/",normalMAC:"/^([0-9a-fA-F]{2}:){5}([0-9a-fA-F]{2})$/",AuthMAC:"/^[0-9a-fA-F]{2}:[0-9a-fA-F]{2}:[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}:[0-9a-fA-F]{2}:[0-9a-fA-F]{2})?$/",WhitelistMAC:"/^[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){0,5}$/",Hex64char:"/^[a-fA-F\\d]{64}$/",Hex64charDemo:"/^[a-fA-F\\d]{64}$/",IP:"/^(([1-9])|([1-9]\\d)|(1\\d\\d)|(2[0-4]\\d)|(25[0-5]))(\\.(\\d|([1-9]\\d)|1\\d\\d|2[0-4]\\d|25[0-5])){3}$/",IPMask:"/^(([1-9])|([1-9]\\d)|1\\d\\d|2[0-4]\\d|25[0-5])(\\.(\\d|([1-9]\\d)|1\\d\\d|2[0-4]\\d|25[0-5])){3}(/([1-9]|[1-2][0-9]|3[0-2]))?$/",LetterDigit4To8:"/^[a-zA-Z\\d]{4,8}$/",IPAndDomain:"/^((25[0-5])|(2[0-4]\\d)|(1\\d\\d)|([1-9]\\d)|([1-9]))(\\.((25[0-5])|(2[0-4]\\d)|(1\\d\\d)|([1-9]\\d)|\\d)){3}$|^([a-zA-Z0-9]([a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,6}$/",exceptBlank1To32:"/^[\\x00-\\xff]{1,32}$/",AuthPort:"/^(^[1-9]\\d{0,3}$)|(^[1-5]\\d{4}$)|(^6[0-4][\\d]{3}$)|(^65[0-4][\\d]{2}$)|(^655[0-2][\\d]|6553[0-5]$)$/",GroupID:"/^[1-9]\\d{0,3}$/",VLANID:"/^(^[0-9]$)|(^[1-9]\\d{1,2}$)|(^[1,-3]\\d{3}$)|(^40[0-8]\\d$)|(^409[0-4]$)$/",Stream:"/^(^[0-9]\\d{0,3}$)|(^[1-5]\\d{4}$)|(^6[0-4][\\d]{3}$)|(^65[0-4][\\d]{2}$)|(^655[0-2][\\d]|6553[0-6]$)$/",maxClients:"/^(^[1-9]\\d{0,1}$)|(^1[0,1]\\d$)|(^120$)$/",RSSIThreshold:"/^(^[0-9]$)|(^[1-9]\\d$)|100$/",FirstName:"/^[a-zA-Z]{0,10}$/",LastName:"/^[a-zA-Z]{0,10}$/",Phone:"/^(?!-)[\\d-]{0,20}$/",Mail:"/^\\w[-\\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+.)+[A-Za-z]{2,14}$/",Company:"/^[a-zA-Z-_.]{0,30}$/",APName:"/^[\\w.:-]{1,20}$/"},a.errorTip={validIP:"Please enter a valid IP address.",validIPOrDomain:"Please enter a valid IP address or domain.",validMac:"Please enter the MAC address according to the format requirements.",positiveInteger:"Please enter a positive integer greater than or equal to 1.",passNotSame:"Two passphrases are not identical, please enter again.",Hexchar64:"Please enter 64 Hexadecimal chars.",ldu:"Please enter digits,letters or underlines.",wlanNameTip:"Please enter 1 to 32 any chars except spaces and Chinese.",validFTP:"Please enter the url according to the format requirements.",Hexchar64Demo:"Please enter 64 Hexadecimal chars.",APName:"Please enter 1 to 20 characters(0-9a-zA-Z.:-_)"},a.lduLengthRangeTip=function(e,t){return"Please enter "+e+" to "+t+" digits,letters or underlines."},a.lduLengthRangeTipDemo=function(e,t){return"Please enter "+e+" to "+t+" chars and can not contain `="},a.valueNotNull=function(e){return"The "+e+" can not be empty."},a.numRange=function(e,t,n){return"The "+e+" must be an integer between "+t+" and "+n},a.valueLengthRange=function(e,t){return"Please make sure the length is between "+e+" to "+t},a.LetterDigitErrorTip=function(e,t){return"Please enter "+e+" to "+t+" letters or digits."}}]).service("clientService",[function(){var e=this;e.ClientList=[],e.getClientList=function(){return e.ClientList},e.setClientList=function(t){e.ClientList=[],e.ClientList=t},e.getWlanClient=function(t){var n=[];return""==t?e.ClientList:(angular.forEach(e.ClientList,function(e){e.WLAN==t&&n.push(e)}),n)},e.getApClient=function(t){var n=[];return""==t?e.ClientList:(angular.forEach(e.ClientList,function(e){e.AP==t&&n.push(e)}),n)}}]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/static/data/",suffix:".json"}),e.preferredLanguage("en_US"),e.useCookieStorage()}]).directive("repeat",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){if(a){var i=t.inheritedData("$formController")[n.repeat],r=function(e){var t=e===i.$viewValue;return a.$setValidity("repeat",t),t?e:void 0};a.$parsers.push(r),a.$formatters.push(r),i.$parsers.push(function(e){return a.$setValidity("repeat",e===a.$viewValue),e})}}}}]).directive("integerport",[function(){return{restrict:"A",link:function(e,t,n){t.bind("paste",function(e){var t=e||window.event;t.charCode?t.preventDefault():t.returnValue=!1}),t.bind("keydown",function(e){var t=e||window.event;13==t.keyCode?t.keyCode=9:13==t.charCode&&(t.charCode=9)}),t.bind("keypress",function(e){var t=e||window.event;t.charCode&&(t.charCode<48||t.charCode>57)&&t.preventDefault(),(t.keyCode<48||t.keyCode>57)&&(t.returnValue=!1)})}}}]),angular.module("main").factory("permissions",[function(){var e=this;return e.permission="Permission_Guest",e.checkPermit=function(t){var n="!"===t[0];n&&(t=t.slice(1).trim());var a=e.permission===t;return!!(n&&!a||!n&&a)},{setPermissions:function(t){"Administrator"==t?e.permission="Permission_Admin":"Viewer"==t?e.permission="Permission_Viewer":"GuestOperator"==t&&(e.permission="Permission_Guest")},hasPermission:function(t){var n=t.split(" "),a=!1;for(i=0;i<n.length;i++)if(e.checkPermit(n[i])){a=!0;break}return a}}}]).directive("operationPermission",["permissions",function(e){return{restrict:"A",link:function(t,n,a){var i=a.operationPermission.trim(),r=e.hasPermission(i);r||n.attr("disabled","true")}}}]).directive("displayPermission",["permissions",function(e){var t=function(e){e&&e.remove&&e.remove()};return{restrict:"A",link:function(n,a,i){var r=i.displayPermission.trim(),s=e.hasPermission(r);s||(angular.forEach(a.children(),function(e){t(e)}),t(a))}}}]),angular.module("main").directive("highLight",[function(){return{restrict:"A",link:function(e,t,n){t.bind("click",function(){t.addClass("highLight"),t.siblings().removeClass("highLight")})}}}]).directive("monitorHighLight",[function(){return{restrict:"A",link:function(e,t,n){t.bind("click",function(){var e=n.monitorHighLight.trim();"ap"==e?(t.addClass("highLight"),t.parent().siblings().children(":first").removeClass("highLight"),$("#wlan_view_table tr").removeClass("highLight"),$("#client_view_table tr").removeClass("highLight")):"wlan"==e?(t.addClass("highLight"),t.siblings().removeClass("highLight"),$("#ap_view_table tr").removeClass("highLight"),$("#client_view_table tr").removeClass("highLight")):"client"==e?(t.addClass("highLight"),t.siblings().removeClass("highLight"),$("#wlan_view_table tr").removeClass("highLight"),$("#ap_view_table tr").removeClass("highLight")):"cluster"==e&&($("#wlan_view_table tr").removeClass("highLight"),$("#ap_view_table tr").removeClass("highLight"),$("#client_view_table tr").removeClass("highLight"))})}}}]),angular.module("main").directive("disableSpace",[function(){return{restrict:"A",link:function(e,t,n){t.bind("keypress",function(){32==event.keyCode&&(event.returnValue=!1)})}}}]),angular.module("system").constant("ntpTimeZoneConstant",{utc:["International-Date-Line-West@UTC+12","Coordinated-Universal-Time-11@UTC+11","Aleutian-Islands@UTC+10","Hawaii@UTC+10","Marquesas-Islands@UTC+09:30","Alaska@UTC+09","Coordinated-Universal-Time-09@UTC+09","Pacific-Time@UTC+08","Baja-California@UTC+08","Coordinated-Universal-Time-08@UTC+08","Chihuahua,La-Paz,Mazatlan@UTC+07","Mountain-Time@UTC+07","Arizona@UTC+07","Easter-Island@UTC+06","Guadalajara,Mexico-City,Monterrey@UTC+06","Saskatchewan@UTC+06","Central-Time@UTC+06","Central-America@UTC+06","Bogota,Lima,Quito,Rio-Branco@UTC+05","Eastern-Time@UTC+05","Havana@UTC+05","Haiti@UTC+05","Chetumal@UTC+05","Indiana(East)@UTC+05","Atlantic-Time@UTC+04","Caracas@UTC+04","Cuiaba@UTC+04","Georgetown,La-Paz,Manaus,San-Juan@UTC+04","Santiago@UTC+04","Turks-and-Caicos-Islands@UTC+04","Asuncion@UTC+04","Newfoundland@UTC+03:30","Araguaina@UTC+03","Brasilia@UTC+03","Buenos-Aires@UTC+03","Greenland@UTC+03","Cayenne,Fortaleza@UTC+03","Montevideo@UTC+03","Salvador@UTC+03","Saint-Pierre-and-Miquelon-Islands@UTC+03","Coordinated-Universal-Time-02@UTC+02","Cape-Verde-Is@UTC+01","Azores@UTC+01","Coordinated-Universal-Time@UTC-00","Dublin,Edinburgh,Lisbon,London@UTC-00","Casablanca@UTC-00","Monrovia,Reykjavik@UTC-00","Amsterdam,Berlin,Bern,Rome,Stockholm,Vienna@UTC-01","Belgrade,Bratislava,Budapest,Ljubljana,Prague@UTC-01","Brussels,Copenhagen,Madrid,Paris@UTC-01","Sarajevo,Skopje,Warsaw,Zagreb@UTC-01","Windhoek@UTC-01","West-Central-Africa@UTC-01","Amman@UTC-02","Beirut@UTC-02","Damascus@UTC-02","Tripoli@UTC-02","Harare,Pretoria@UTC-02","Helsinki,Kyiv,Riga,Sofia,Tallinn,Vilnius@UTC-02","Kishinev@UTC-02","Kaliningrad@UTC-02","Gaza,Hebron@UTC-02","Cairo@UTC-02","Athens,Bucharest@UTC-02","Jerusalem@UTC-02","Istanbul@UTC-02","Baghdad@UTC-03","Kuwait,Riyadh@UTC-03","Minsk@UTC-03","Moscow,Saint-Petersburg,Volgograd@UTC-03","Nairobi@UTC-03","Tehran@UTC-03:30","Abu-Dhabi,Muscat@UTC-04","Astrakhan,Ulyanovsk@UTC-04","Yerevan@UTC-04","Baku@UTC-04","Tbilisi@UTC-04","Port-Louis@UTC-04","Izevsk,Samarra@UTC-04","Kabul@UTC-04:30","Ashkhabad,Tashkent@UTC-05","Ekaterinburg@UTC-05","Islamabad,Karachi@UTC-05","Chennai,Kolkata,Mumbai,New-Delhi@UTC-05:30","Sri-Jayawardenepura@UTC-05:30","Kathmandu@UTC-05:45","Astana@UTC-06","Dhaka@UTC-06","Novosibirsk@UTC-06","Yangon@UTC-06:30","Barnaul,Gorno-altaysk@UTC-07","Hovd@UTC-07","Krasnoyarsk@UTC-07","Bangkok,Hanoi,Jakarta@UTC-07","Tomsk@UTC-07","Beijing,Chongqing,HongKong,Urumqi@UTC-08","Kuala-Lumpur,Singapore@UTC-08","Perth@UTC-08","Taipei@UTC-08","Ulaanbaatar@UTC-08","Irkutsk@UTC-08","Pyongyang@UTC-08:30","Eucla@UTC-08:45","Chita@UTC-09","Osaka,Sapporo,Tokyo@UTC-09","Seoul@UTC-09","Yakutsk@UTC-09","Adelaide@UTC-09:30","Darwin@UTC-09:30","Brisbane@UTC-10","Vladivostok@UTC-11","Guam,Port-Moresby@UTC-10","Hobart@UTC-10","Canberra,Melbourne,Sydney@UTC-10","Lord-Howe-Island@UTC-10:30","Bougainville-Island@UTC-11","Magadan@UTC-11","Norfolk-Island@UTC-11","Chokurdakh@UTC-11","Sakhalin@UTC-11","Solomon-Is,New-Caledonia@UTC-11","Anadyr,Petropavlovsk@UTC-12","Auckland,Wellington@UTC-12","Fiji@UTC-12","Coordinated-Universal-Time+12@UTC-12","Chatham-Islands@UTC-12:45","Nukualofa@UTC-13","Samoa@UTC-13","Christmas-Island@UTC-14"]}),angular.module("main").controller("logoutPromptCtrl",["$scope","$timeout","$modalInstance","authentifiedRequest","flag",function(e,t,n,a,i){e.flag=i,e.timeout;var r,s=15;e.initFunction=function(){3==i?(s=15,r=setInterval(e.changeLogout_15s_text,1e3)):(r=setInterval(e.changeLogout_5s_text,1e3),s=5),e.timeout=t(function(){e.logout()},1e3*s)},e.changeLogout_15s_text=function(){var e=$("#logout-15s");0!=s&&(s-=1);var t="Your login session is about to expire due to inactivity in "+s+" seconds.";e.text(t)},e.changeLogout_5s_text=function(){var e=$("#logout-5s");0!=s&&(s-=1);var t="Your account has logged in elsewhere,  and this visit will end in "+s+" seconds.";e.text(t)},e.unlogout=function(){t.cancel(e.timeout),clearInterval(r),a.post("/authentication/unlogout",null,null,function(e){n.dismiss("cancel")})},e.logout=function(){t.cancel(e.timeout),clearInterval(r),window.location.href="/static/login.html"},e.initFunction()}]),angular.module("module.client",[]).filter("clientOwnerName",[function(){var e=function(e){return"ap"==e?"AP":"wlan"==e?"WLAN":"cluster"==e?"Group":""};return e}]).controller("ClientController",["$scope","batchSyncConfig","clientService","monitorService","singleModal",function(e,t,n,a,i){e.clientList=[],e.clientNum=0,e.divWidth="",e.flag="cluster",e.clientOwner="",e.clientManagement.changeClient=function(t,a){"ap"==t?(e.flag="ap",e.clientOwner=a,e.clientList=n.getApClient(a)):"wlan"==t?(e.flag="wlan",e.clientOwner=a,e.clientList=n.getWlanClient(a)):(e.flag="cluster",e.clientOwner=a,e.clientList=n.getClientList()),0<e.clientList.length?(e.clientNum=e.clientList.length,4<e.clientNum?e.divWidth="padding-right:17px;":e.divWidth=""):(e.clientNum=0,e.clientList=[],e.divWidth="")},e.clientManagement.query=function(a){t.getAll("/totalclientlist",null,function(t){0<t.length&&n.setClientList(t),e.clientManagement.changeClient(e.flag,e.clientOwner),a()})},e.clientManagement.query(e.clientCallback),e.openClientPageInit=function(){i.open({templateUrl:"client/client-detail.html",controller:"ClientDetailController",size:"lg",backdrop:!0},function(t){e.clientManagement.query(e.clientCallback)},function(t){e.clientManagement.query(e.clientCallback)})},e.showClientMonitor=function(e){var t="client:"+e.UserMAC;a.changeObser("client",e.UserMAC,t)}}]),angular.module("module.client").controller("ClientDetailController",["$scope","$modalInstance","$translate","authentifiedRequest","InterService","batchSyncConfig","clientService","toastr",function(e,t,n,a,i,r,s,o){e.skin=i.skin,e.clientDetailGroupList=[],e.allClientGroupList=e.clientDetailGroupList,e.currentDetailTemp={Name:"",IP:"",UserMAC:"",WLAN:"",AP:"",APName:"",APInfo:"",Auth:"",FREQ:"",OnlineTime:"",SessionTime:"",RSSI:0,MODE:"",RXRATE:0,TXRATE:0,UPRATE:0,DOWNRATE:0,InputFlow:0,OutputFlow:0,TerminalType:"",FingerPrint:""},e.isShowDetails=!0,e.searchVisible=!1,e.search={target:""},e.showSearch=function(){e.searchVisible=!e.searchVisible},e.getCurrentClientDetail=function(t){e.currentDetailTemp=t},e.deleteuser=function(t){for(var n=e.clientDetailGroupList.length,a=0;n>a;a++)if(e.clientDetailGroupList[a].UserMAC==t.UserMAC){e.clientDetailGroupList.splice(a,1);break}},e.BlackList=[],e.getBlackList=function(){var t={};a.get("/getblacklist",t,function(t,n){200==n&&null!=t&&t.success&&(e.BlackList=t.result)},function(){})},e.getBlackList(),e.mac_compare=function(t,n,a){var i=t.length;if(console.log(t+n.Begin_MAC),(17==i||1>=a)&&t==n.Begin_MAC)return!0;if(35==i||2>=a)if(e.arr=t.split("-"),""!=n.End_MAC){if(n.Begin_MAC<=e.arr[0]&&n.End_MAC>=e.arr[0])return!0;if(n.Begin_MAC>=e.arr[0]&&n.End_MAC<=e.arr[1])return!0;if(n.Begin_MAC<=e.arr[1]&&n.End_MAC>=e.arr[1])return!0}else if(n.Begin_MAC>=e.arr[1]&&n.Begin_MAC<=e.arr[1])return!0;if(8==i||3>=a){var r=n.Begin_MAC.substr(0,8);if(t==r)return!0}return!1},e.maclistFilterDuplicateObject=function(t,n){var a=!1,i=n,r="",s=0;if(""==i.End_MAC)s=8==i.Begin_MAC.length?3:1,r=i.Begin_MAC;else{s=2;var o=i.Begin_MAC.substr(0,8),l=i.End_MAC.substr(0,8);if(o!=l||i.Begin_MAC>i.End_MAC)return!0;r=i.Begin_MAC+"-"+i.End_MAC}return $.each(t,function(t,n){var r=e.mac_compare(n.MAC,i,s);return 1==r?a=!0:void 0}),a},e.kickuser=function(t){var a=n.instant("kickOutUser")+t.UserMAC+" ?";bootbox.confirm(a,function(a){if(a){if(e.BlackList.length>=256)o.info(n.instant("client_kick_user_1"),"");else{e.BlackListTemp={Begin_MAC:t.UserMAC,End_MAC:""};var i=e.maclistFilterDuplicateObject(e.BlackList,e.BlackListTemp);if(1!=i){var s="access_add_blacklist_3",l=JSON.stringify(e.BlackListTemp);return void r.request("put","/addBlacklist",null,l,function(){e.deleteuser(t),e.currentDetailTemp=e.clientDetailGroupList[0],e.currentDetailTemp||(e.isShowDetails=!1);var n=JSON.stringify(t);r.request("put","/kickuser",null,n,function(){},null,"client_kick_user_2")},null,s)}o.info(n.instant("access_add_blacklist_1"),"")}e.deleteuser(t),e.currentDetailTemp=e.clientDetailGroupList[0],e.currentDetailTemp||(e.isShowDetails=!1);var c=JSON.stringify(t);r.request("put","/kickuser",null,c,function(){},null,"client_kick_user_2")}})},e.selectRow=function(e){
var t,n,a;t?(t.bgColor=a,a=e.bgColor,e.bgColor="#FFE9B3"):(a=e.bgColor,e.bgColor="#FFE9B3"),t=e,n=e.id},e.ok=function(){t.close()},e.cancel=function(){t.close()},e.init=function(){e.clientDetailGroupList=[],e.clientService=s,e.clientDetailGroupList=e.clientService.getClientList(),e.allClientGroupList=e.clientDetailGroupList,e.currentDetailTemp=e.clientDetailGroupList[0],e.currentDetailTemp||(e.isShowDetails=!1)},e.searchClient=function(){if(e.newClientGroupList=[],e.search.target){for(var t,n,a,i=e.allClientGroupList.length,r=0;i>r;r++)t=!e.allClientGroupList[r].IP.indexOf(e.search.target),n=!e.allClientGroupList[r].UserMAC.toUpperCase().indexOf(e.search.target.toUpperCase()),a=!e.allClientGroupList[r].Name.toUpperCase().indexOf(e.search.target.toUpperCase()),(t||a||n)&&e.newClientGroupList.push(e.allClientGroupList[r]);e.clientDetailGroupList=e.newClientGroupList}else e.clientDetailGroupList=e.allClientGroupList},e.init()}]),angular.module("module.ap.apinfo",[]).service("APService",["authentifiedRequest","batchSyncConfig","InterService","clientService",function(e,t,n,a){var i=this;i.HttpGetApListInfo=function(t){var i=n.getPVCinfo(),r="";r=null==i||""==i?"/haps":"http://"+i+":8080/haps",e.get(r,null,function(e){if(null!=e&&e.success&&null!=e.result){for(var i=e.result.length;i>0;i--){0==e.result[i-1].state&&(e.result[i-1].state="1");var r=a.getApClient(e.result[i-1].mac);null!=r?e.result[i-1].clients=r.length:e.result[i-1].clients=0,e.result[i-1].hasOwnProperty("name")&&""!=e.result[i-1].name&&null!=e.result[i-1].name?e.result[i-1].apname=e.result[i-1].name:e.result[i-1].apname=e.result[i-1].mac,e.result[i-1].hasOwnProperty("version")||(e.result[i-1].version=" ")}n.setApListInfo(e.result),null!=t&&t()}},function(){})},i.HttpGetPvcInfo=function(){var t="/pvcinfo";e.get(t,null,function(e){null!=e&&e.success&&null!=e.result&&""!=e.result&&n.setPVCinfo(e.result)},function(){})}}]).controller("APController",["$scope","$rootScope","$translate","InterService","authentifiedRequest","clientService","monitorService","lockScreen","singleModal","operationLog","APService","toastr",function(e,t,n,a,i,r,s,o,l,c,u,p){function d(){e.aps.length>7?e.apsWidth="padding-right:17px":e.apsWidth=""}function f(){for(var t=0,a=0,i=0,r=0;r<e.aps.length;r++)switch(e.aps[r].state){case"1":a++;for(var s=!1,o=e.aps[r].mac,l=0;l<e.aps.length;l++)r!=l&&e.aps[r].ip==e.aps[l].ip&&(o=o+", "+e.aps[l].mac,s=!0);if(s){var c=n.instant("duplicate_ip_tip1")+o+n.instant("duplicate_ip_tip2")+e.aps[r].ip;p.warning(c,"")}break;case"2":case"3":t++;break;case"4":i++}for(var r=0;r<e.aps.length-1;r++)if(1==e.aps[r].state){var s=!1,o="";o=e.aps[r].mac;for(var l=0;l<e.aps.length;l++)r!=l&&e.aps[r].ip==e.aps[l].ip&&(o=o+","+e.aps[l].mac,s=!0);if(s){var c=n.instant("duplicate_ip_tip")+e.aps[r].ip;p.warning(c,"")}}e.apInfo={working:t,lost:i,joining:a},d()}e.InterService=a;var g="http://",m=":8080";e.apInfo={working:"0",lost:"0",joining:"0"},e.aps=a.getApListInfo(),f(),e.apsWidth="",d(),e.modal=null,e.openApinfo=function(){var t=l.open({templateUrl:"ap/aplist.html",controller:"APinfoController",size:"lg",backdrop:!0});t.result.then(function(t){u.HttpGetApListInfo(function(){e.aps=a.getApListInfo(),f()})},function(t){u.HttpGetApListInfo(function(){e.aps=a.getApListInfo(),f()})})},e.acceptAp=function(t){var a={mac:t.mac},r=e.aps.length-e.apInfo.joining;16>r?bootbox.confirm(n.instant("joingAp"),function(e){if(e){o.lock();var t="ap_access_group_name",r=[{ip:"PVC",success:"module_operate_failure",msg:""}];i.put("/toauth",null,a,function(e){null!=e&&e.success?(p.info(n.instant("successfullyAp"),""),u.HttpGetApListInfo(null),r[0].success="module_operate_success",r[0].msg="ap_log_success",o.unlock()):(p.info(n.instant("failedAp"),""),r[0].success="module_operate_failure",r[0].msg="ap_log_error_1",o.unlock()),c.setLog(t,r)},function(){p.info(n.instant("failedServer"),""),r[0].success="module_operate_failure",r[0].msg="failedServer",c.setLog(t,r),o.unlock()})}}):p.warning(n.instant("apgroupFull"),"")},e.ShowLedOperate=function(e){if(e.ledshow=!e.ledshow,e.ledshow){var t=g+e.ip+m+"/ledstatus";i.get(t,null,function(t){if(null!=t&&t.success)switch(t.result){case 0:e.operate={open:!1,off:!0,blink:!1};break;case 1:e.operate={open:!0,off:!1,blink:!1};break;case 2:e.operate={open:!1,off:!1,blink:!0}}},function(){})}},e.LedOperate=function(e,t){var a={type:t},r="";switch(t){case 100:r=n.instant("locateAp");break;case 101:r=n.instant("restoreAp");break;case 102:r=n.instant("onLedAp");break;case 103:r=n.instant("offLedAp")}var s=g+e.ip+m+"/ledControl";bootbox.confirm(r,function(r){if(r){o.lock();var l="set_led_status_log_name",u=[{ip:e.ip,success:"module_operate_failure",msg:""}];i.put(s,null,a,function(a){if(null!=a&&a.success){switch(t){case 100:e.operate={open:!1,off:!1,blink:!0};break;case 101:e.operate={open:!0,off:!1,blink:!1};break;case 102:e.operate={open:!0,off:!1,blink:!1};break;case 103:e.operate={open:!1,off:!0,blink:!1}}u[0].success="module_operate_success",u[0].msg="ap_log_success",o.unlock()}else p.warning(n.instant("setApLedF"),""),u[0].success="module_operate_failure",u[0].msg="ap_log_error_1",o.unlock();c.setLog(l,u)},function(){p.warning(n.instant("failedServer"),""),u[0].success="module_operate_failure",u[0].msg="failedServer",c.setLog(l,u),o.unlock()})}})},e.$on("to-aplist-child",function(t,n){e.aps=a.getApListInfo(),f()}),e.showApMonitorData=function(t){var n="AP:"+t.mac,a=new Array;a.ip=t.ip,a.mac=t.mac,s.changeObser("ap",a,n),e.clientManagement.changeClient("ap",t.mac)}}]).filter("apStatusFilter",[function(){var e=function(e){switch(e){case"1":return"Joining";case"2":return"Initializing";case"3":return"Working";case"4":return"Down"}};return e}]),angular.module("module.ap.apinfo").controller("APinfoController",["$rootScope","$scope","$modalInstance","$translate","authentifiedRequest","InterService","batchSyncConfig","FileUploader","lockScreen","$http","ClusterService","toastr","operationLog","$interval","APService",function(e,t,n,a,i,r,s,o,l,c,u,p,d,f,g){function m(){t.aplistinfo=r.getApListInfo(),t.aplistdetailinfo.working=r.getCanConfigAps();for(var e=0,n=0,a=0,i=0,s=0;s<t.aplistinfo.length;s++)3==t.aplistinfo[s].role&&1!=t.aplistinfo[s].state?(t.aplistdetailinfo.MEM[n]=t.aplistinfo[s],t.aplistdetailinfo.MEM[n].uploadFaseFlag=100,n++):1==t.aplistinfo[s].role?(t.aplistdetailinfo.PVC[e]=t.aplistinfo[s],t.aplistdetailinfo.PVC[e].uploadFaseFlag=100,t.funDetailInfo(t.aplistinfo[s]),e++):2==t.aplistinfo[s].role&&1!=t.aplistinfo[s].state&&(t.aplistdetailinfo.SVC[a]=t.aplistinfo[s],t.aplistdetailinfo.SVC[a].uploadFaseFlag=100,a++),1==t.aplistinfo[s].state&&(t.aplistdetailinfo.joining[i]=t.aplistinfo[s],i++)}function _(e,n,i){var r="restore_configration_log_name",s=[{ip:e.ip,success:"module_operate_failure",msg:""}];200==i&&1==n.success?(s[0].success="module_operate_success",s[0].msg="ap_log_success",t.uploadflag.mac.toUpperCase()==e.mac.toUpperCase()&&k(),p.info("IP:"+e.ip+"&nbsp;msg:Configuration has been uploaded successfully. The AP is restoring!","")):(200==i?"100"==n.result?(s[0].success="module_operate_failure",s[0].msg="ap_restore_error_1",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("ap_restore_error_1"),"")):"101"==n.result?(s[0].success="module_operate_failure",s[0].msg="ap_restore_error_2",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("ap_restore_error_2"),"")):"102"==n.result?(s[0].success="module_operate_failure",s[0].msg="ap_restore_error_3",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("ap_restore_error_3"),"")):"103"==n.result?(s[0].success="module_operate_failure",s[0].msg="ap_restore_error_4",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("ap_restore_error_4"),"")):(s[0].success="module_operate_failure",s[0].msg="ap_log_error_1",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("ap_log_error_1"),"")):(s[0].success="module_operate_failure",s[0].msg="failedServer",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("msg_base")+a.instant("failedServer"),"")),t.uploadflag.mac.toUpperCase()==e.mac.toUpperCase()&&l.unlock()),d.setLog(r,s,null)}function h(e){l.lock(42e4);var n=t.aplistdetailinfo.working[t.num].mac.toUpperCase(),a=t.uploadflag.mac.toUpperCase();a==n&&t.uploadflag.connect?(t.uploadflag.num=t.num,t.num=t.num+1,t.num<t.aplistdetailinfo.working.length?(e.url=S+t.aplistdetailinfo.working[t.num].ip+b+"/restorecfg/"+e.file.name,e.upload()):t.restorefile(P.queue[0])):(e.url=S+t.aplistdetailinfo.working[t.num].ip+b+"/restorecfg/"+e.file.name,e.upload())}function v(e,n,i){var r="upgrade_verion_log_name",s=[{ip:e,success:"module_operate_failure",msg:""}];s[0].success=i.flag,s[0].msg=i.msg,i.flag?(t.uploadflag.mac.toUpperCase()==n.toUpperCase()&&(t.uploadflag.byurlflag=!0,k()),p.info("IP:"+e+"&nbsp;"+a.instant(i.msg),"")):p.warning("IP:"+e+"&nbsp;"+a.instant(i.msg),""),d.setLog(r,s,null)}function w(e,n){if(1==e.role)t.aplistdetailinfo.PVC[0].uploadFaseFlag=n;else if(2==e.role){for(var a=0;a<t.aplistdetailinfo.SVC.length;a++)if(e.mac==t.aplistdetailinfo.SVC[a].mac){t.aplistdetailinfo.SVC[a].uploadFaseFlag=n;break}}else if(3==e.role)for(var a=0;a<t.aplistdetailinfo.MEM.length;a++)if(e.mac==t.aplistdetailinfo.MEM[a].mac){t.aplistdetailinfo.MEM[a].uploadFaseFlag=n;break}}function C(e,n,i,r){var s="upgrade_version_http_log_name",o=[{ip:e.ip,success:"module_operate_failure",msg:""}];200==i&&1==n.success?(w(e,102),1==r?t.uploadflag.mac.toUpperCase()==e.mac.toUpperCase()?k():l.unlock():t.uploadflag.mac.toUpperCase()==e.mac.toUpperCase()&&k(),o[0].success="module_operate_success",o[0].msg="ap_log_success",p.info("IP:"+e.ip+"&nbsp;"+a.instant("uploadVersionByUrlS"),"")):(200==i?"100"==n.result?(o[0].success="module_operate_failure",o[0].msg="ap_log_error_3",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("noMemoryOsupgrade"),"")):(o[0].success="module_operate_failure",o[0].msg="ap_log_error_4",p.warning("IP:"+e.ip+"&nbsp;"+a.instant("osupgradeF"),"")):(o[0].success="module_operate_failure",o[0].msg="failedServer",p.warning("IP:"+e.ip+"&nbsp;msg:"+a.instant("failedServer"),"")),1==r?l.unlock():t.uploadflag.mac.toUpperCase()==e.mac.toUpperCase()&&l.unlock(),w(e,101)),d.setLog(s,o,null)}function y(e){l.lock(42e4);var n=t.aplistdetailinfo.working[t.num].mac.toUpperCase(),a=t.uploadflag.mac.toUpperCase();a==n&&t.uploadflag.connect?(t.uploadflag.num=t.num,t.num=t.num+1,t.num<t.aplistdetailinfo.working.length?(e.url=S+t.aplistdetailinfo.working[t.num].ip+b+"/updatefirm/"+e.file.name,e.upload()):t.UpdatetoAll(T.queue[0],2)):(e.url=S+t.aplistdetailinfo.working[t.num].ip+b+"/updatefirm/"+e.file.name,e.upload())}t.skin=r.skin;var S="http://",b=":8080";t.aplistinfo={},t.uploadflag={connect:!1,num:0,mac:"",byurlflag:!1},t.select={selectall:!1},t.aplistdetailinfo={PVC:[],SVC:[],MEM:[],working:[],joining:[]},t.flag={isEditApname:!1,isEditip:!1,showdhcp:!0,apinfoshow:!0,upload2one:!0,noeditloc:!0},t.tabflag={detailtab:!0,cfgtab:!1,updatetab:!1,restoretab:!1},t.edit={apNewName:"",mac:"",proto:"",ipaddr:"",netmask:"",gateway:""},t.editloc={aploc:""},t.byurl={url:""},t.currentApInfo={},t.apInfo={},t.InterService=r,t.iSurlorloc="false",t.timer=null,t.roottimer=null,l.lock();var A=function(){null!=t.timer&&f.cancel(t.timer),t.aplistdetailinfo={PVC:[],SVC:[],MEM:[],working:[],joining:[]},g.HttpGetApListInfo(function(){L(),m(),t.clusterInfo=u.getClusterinfoSer(),t.$emit("to-aplist-parent",!0)})},k=function(){t.$emit("modal-to-main","cancelTimer");var e=f(function(){l.lock(6e4),i.get("/checkstate",null,function(e){null!=e&&e.success&&(l.unlock(),window.location.href="login.html")},function(){})},3e4);t.roottimer=e};A();var L=function(){i.get("/getapname",null,function(e){null!=e&&e.success?t.uploadflag.mac=e.result.mac:t.uploadflag.mac=""},function(){t.uploadflag.mac=""})};t.funDetailInfo=function(e){if(t.currentApInfo=e,t.flag.upload2one=!0,t.tabflag={detailtab:!0,cfgtab:!1,updatetab:!1,restoretab:!1},t.flag={isEditApname:!1,isEditip:!1,showdhcp:!0,apinfoshow:!0,upload2one:!0,noeditloc:!0},4==e.state||1==e.state)return t.flag.apinfoshow=!1,void p.warning(a.instant("apinfoShow"));t.apInfo={},t.flag.showdhcp=!0,t.flag.apinfoshow=!0;var n=S+e.ip+b+"/baseinfo";l.lock(),i.get(n,null,function(e){null!=e&&e.success?(t.apInfo=e.result,l.unlock()):(l.unlock(),p.warning(a.instant("getinfoApF")))},function(){l.unlock(),p.warning(a.instant("getinfoApF"))})},t.funcfg=function(e){t.currentApInfo=e,t.flag.upload2one=!0,t.cfgtext={content:""},t.tabflag={detailtab:!1,cfgtab:!0,updatetab:!1,restoretab:!1};var n=S+e.ip+b+"/currentcfg";l.lock(),i.get(n,null,function(e){null!=e&&e.success?(t.cfgtext.content=e.result,l.unlock()):(l.unlock(),p.warning(a.instant("getconfigureApF")))},function(){l.unlock(),p.warning(a.instant("getconfigureApF"))})},t.showRestore=function(){t.flag.upload2one=!0,t.tabflag={detailtab:!1,cfgtab:!1,updatetab:!1,restoretab:!0}},t.funupdate=function(e){t.flag.upload2one=!0,t.currentApInfo=e,t.tabflag={detailtab:!1,cfgtab:!1,updatetab:!0,restoretab:!1}},t.showbashupload=function(){t.flag.upload2one=!1,t.tabflag={detailtab:!1,cfgtab:!1,updatetab:!0,restoretab:!1}},t.reboot=function(e){t.flag.upload2one=!0;var n=S+e.ip+b+"/reboot";bootbox.confirm(a.instant("rebootAp"),function(r){if(r){var s="reboot_ap_log_name",o=[{ip:e.ip,success:"module_operate_failure",msg:""}];l.lock(6e4),i.put(n,null,null,function(n){null!=n&&n.success?(o[0].success="module_operate_success",o[0].msg="ap_log_success",e.mac.toUpperCase()==t.uploadflag.mac.toUpperCase()?k():l.unlock(),p.warning(a.instant("rebootApS"))):(o[0].success="module_operate_failure",o[0].msg="ap_log_error_1",p.warning(a.instant("rebootApF")),l.unlock()),d.setLog(s,o,null)},function(){o[0].success="module_operate_failure",o[0].msg="failedServer",d.setLog(s,o,null),p.warning(a.instant("failedServer")),l.unlock()})}})},t.saveOrCancelApName=function(e){if(100==e)t.edit={apNewName:"",mac:"",proto:"",ipaddr:"",netmask:"",gateway:""},t.flag.isEditApname=!t.flag.isEditApname;else if(101==e){var n=S+t.currentApInfo.ip+b+"/chgapname",r={mac:t.currentApInfo.mac,apname:t.edit.apNewName},s="modify_apName_log_name",o=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}];l.lock(),i.put(n,null,r,function(e){if(null!=e&&e.success){t.apInfo.apName=t.edit.apNewName,t.flag.isEditApname=!t.flag.isEditApname;var n=t.currentApInfo.mac.toUpperCase();if(1==t.currentApInfo.role)t.aplistdetailinfo.PVC[0].apname=t.edit.apNewName;else if(2==t.currentApInfo.role)for(var i=0;i<t.aplistdetailinfo.SVC.length;i++){var r=t.aplistdetailinfo.SVC[i].mac.toUpperCase();if(n==r){t.aplistdetailinfo.SVC[i].apname=t.edit.apNewName;break}}else if(3==t.currentApInfo.role)for(var i=0;i<t.aplistdetailinfo.MEM.length;i++){var r=t.aplistdetailinfo.MEM[i].mac.toUpperCase();if(n==r){t.aplistdetailinfo.MEM[i].apname=t.edit.apNewName;break}}o[0].success="module_operate_success",o[0].msg="ap_log_success",l.unlock()}else l.unlock(),p.warning(a.instant("setNameApF")),o[0].success="module_operate_failure",o[0].msg="ap_log_error_1";d.setLog(s,o,null)},function(){l.unlock(),o[0].success="module_operate_failure",o[0].msg="failedServer",d.setLog(s,o,null),p.warning(a.instant("failedServer"))})}else 102==e&&(t.flag.isEditApname=!t.flag.isEditApname,t.edit.apNewName="")},t.acceptAp=function(){var e={mac:t.currentApInfo.mac},n=t.aplistinfo.length-t.aplistdetailinfo.joining.length;16>n?bootbox.confirm(a.instant("joingAp"),function(n){if(n){l.lock();var r=S+t.aplistdetailinfo.PVC[0].ip+b+"/toauth",s="ap_access_group_name",o=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}];i.put(r,null,e,function(e){null!=e&&e.success?(p.info(a.instant("successfullyAp"),""),o[0].success="module_operate_success",o[0].msg="ap_log_success"):(p.warning(a.instant("failedAp"),""),o[0].success="module_operate_failure",o[0].msg="ap_log_error_1"),d.setLog(s,o,null);var n=f(function(){A()},3e3);t.timer=n},function(){o[0].success="module_operate_failure",o[0].msg="failedServer",d.setLog(s,o,null),p.warning(a.instant("failedServer")),l.unlock()})}}):p.warning(a.instant("apgroupFull"),"")},t.kickOffAp=function(){var e={mac:t.currentApInfo.mac};bootbox.confirm(a.instant("kickOffAp"),function(n){if(n){l.lock();var r=S+t.aplistdetailinfo.PVC[0].ip+b+"/kickoffap",s="kick_ap_log_name",o=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}];i.put(r,null,e,function(e){null!=e&&e.success?(p.info(a.instant("kickOffApS"),""),o[0].success="module_operate_success",o[0].msg="ap_log_success"):(o[0].success="module_operate_failure",o[0].msg="ap_log_error_1",p.warning(a.instant("kickOffApF"),"")),d.setLog(s,o,null);var n=f(function(){A()},3e3);t.timer=n},function(){o[0].success="module_operate_failure",o[0].msg="failedServer",d.setLog(s,o,null),p.warning(a.instant("failedServer")),l.unlock()})}})},t.deleteAp=function(){var e={mac:t.currentApInfo.mac};bootbox.confirm(a.instant("delAp"),function(n){if(n){l.lock();var r=S+t.aplistdetailinfo.PVC[0].ip+b+"/deleteap",s="delete_ap_log_name",o=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}];i.put(r,null,e,function(e){null!=e&&e.success?(p.info(a.instant("delApS"),""),o[0].success="module_operate_success",o[0].msg="ap_log_success"):(o[0].success="module_operate_failure",o[0].msg="ap_log_error_1",p.warning(a.instant("delApF"),"")),d.setLog(s,o,null);var n=f(function(){A()},3e3);t.timer=n},function(){o[0].success="module_operate_failure",o[0].msg="failedServer",d.setLog(s,o,null),p.warning(a.instant("failedServer")),l.unlock()})}})},t.Update2PVC=function(){var e={mac:t.currentApInfo.mac},n=S+t.currentApInfo.ip+b+"/prioritychange";bootbox.confirm(a.instant("apToPvc"),function(r){if(r){l.lock();var o="update2pvc_log_name",c=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}],u="update2vc_log_name",f=[{ip:"PVC",success:"module_operate_failure",msg:""}];i.put(n,null,e,function(n){if(null!=n&&n.success){c[0].success="module_operate_success",c[0].msg="ap_log_success";var r=S+t.aplistdetailinfo.PVC[0].ip+b+"/prioritychange";i.put(r,null,e,function(e){if(null!=e&&e.success){p.info(a.instant("changeRoleS"),""),f[0].success="module_operate_success",f[0].msg="ap_log_success";var t="restart_ap_cluster_log_name";s.request("put","/reloadclt",null,null,null,null,t),l.unlock()}else f[0].success="module_operate_failure",f[0].msg="ap_log_error_1",p.warning(a.instant("changeRoleF"),""),l.unlock();d.setLog(u,f,null)},function(){f[0].success="module_operate_failure",f[0].msg="failedServer",d.setLog(u,f,null),p.warning(a.instant("failedServer")),l.unlock()})}else c[0].success="module_operate_failure",c[0].msg="ap_log_error_1",p.warning(a.instant("changeRoleF"),""),l.unlock();d.setLog(o,c,null)},function(){c[0].success="module_operate_failure",c[0].msg="failedServer",d.setLog(o,c,null),p.warning(a.instant("failedServer")),l.unlock()})}})},t.saveOrCancelApLocation=function(e){if(100==e)t.editloc.aploc="",t.flag.noeditloc=!1;else if(101==e){var n=S+t.currentApInfo.ip+b+"/chgaploc",r={mac:t.currentApInfo.mac,aploc:t.editloc.aploc};l.lock();var s="modify_ap_location_log_name",o=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}];i.put(n,null,r,function(e){null!=e&&e.success?(t.apInfo.apLoc=t.editloc.aploc,t.flag.noeditloc=!0,o[0].success="module_operate_success",o[0].msg="ap_log_success",l.unlock()):(l.unlock(),o[0].success="module_operate_failure",o[0].msg="ap_log_error_1",p.warning(a.instant("modifyLocationApF"))),d.setLog(s,o,null)},function(){l.unlock(),o[0].success="module_operate_failure",o[0].msg="failedServer",d.setLog(s,o,null),p.warning(a.instant("failedServer"))})}else 102==e&&(t.flag.noeditloc=!0,t.editloc.aploc="")},t.show_ip_edit=function(e){100==e?t.flag.isEditip=!1:101==e&&(t.flag.isEditip=!0)},t.saveDhcpOpration=function(e){if(100==e)t.flag.showdhcp=!1,t.edit={apNewName:"",mac:"",proto:"",ipaddr:"",netmask:"",gateway:""},"STATIC"==t.apInfo.netproto.toUpperCase()?(t.edit.proto="static",t.flag.isEditip=!0):(t.edit.proto="dhcp",t.flag.isEditip=!1);else if(101==e){t.edit.mac=t.currentApInfo.mac;var n=S+t.currentApInfo.ip+b+"/chgnetaddr",r=S+t.currentApInfo.ip+b+"/reload",s=t.edit;l.lock();var o="modify_ap_ip_log_name",c=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}];i.put(n,null,s,function(e){null!=e&&e.success?(i.get(r,null,function(e){},function(){}),t.flag.showdhcp=!0,l.unlock(),c[0].success="module_operate_success",c[0].msg="ap_log_success",p.info(a.instant("modifyIpApS"),"")):(l.unlock(),p.warning(a.instant("modifyIpApF"),""),c[0].success="module_operate_failure",c[0].msg="ap_log_error_1"),d.setLog(o,c,null)},function(){l.unlock(),c[0].success="module_operate_failure",c[0].msg="failedServer",d.setLog(o,c,null),p.warning(a.instant("failedServer"))})}else 102==e&&(t.flag.showdhcp=!0)},t.clearAllCfg=function(){t.flag.upload2one=!0,bootbox.confirm(a.instant("clearConfigurationAllAp"),function(e){if(e){var t="clear_configuration_log_name";s.request("put","/clearallcfg",null,null,null,null,t)}})},t.downloadServerDetailList=function(e){t.flag.upload2one=!0;var n="download_ap_configration_log_name",i=[{ip:"PVC",success:"module_operate_failure",msg:""}];bootbox.confirm(a.instant("backupConfiguration"),function(e){e&&c({method:"get",url:"/backupcfg",headers:{Authorization:"sessionName "+window.localStorage.sessionId}}).success(function(e,t,r){var s="application/octet-stream",o=!1;r=r();var l=r["content-disposition"],c=new Array;c=l.split("=");var u=c[1],f=r["content-type"]||s;try{var g=new Blob([e],{type:f});if(navigator.msSaveBlob)navigator.msSaveBlob(g,u);else{var m=navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob;if(void 0===m)throw"Not supported";m(g,u),o=!0}}catch(_){console.log(_)}if(!o){var h=window.URL||window.webkitURL||window.mozURL||window.msURL;if(h){var v=document.createElement("a");if("download"in v)try{var g=new Blob([e],{type:f}),w=h.createObjectURL(g);v.setAttribute("href",w),v.setAttribute("download",u);var C=document.createEvent("MouseEvents");C.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),v.dispatchEvent(C),o=!0}catch(_){console.log(_)}if(!o)try{var g=new Blob([e],{type:s}),w=h.createObjectURL(g);window.location=w,o=!0}catch(_){console.log(_)}}}o?(i[0].success="module_operate_success",i[0].msg="ap_log_success"):(i[0].success="module_operate_failure",i[0].msg="ap_log_error_2",p.warning(a.instant("faileddownload"))),d.setLog(n,i,null)}).error(function(e,t){console.log("Request failed with status: "+t),i[0].success="module_operate_failure",i[0].msg="failedServer",d.setLog(n,i,null),p.warning(a.instant("failedServer"))})})},t.num=0;var P=t.uploader=new o({removeAfterUpload:!1,headers:{Authorization:"sessionName "+window.localStorage.sessionId}});P.onAfterAddingFile=function(e){var n=/^[\w- ()]+\.conf$/,i=n.test(e.file.name.toLowerCase());if(!i)return t.clearItems(),void p.warning(a.instant("fileFormatConf"),"");var r=Math.floor(e.file.size/1024/1024);return r>20?(t.clearItems(),void p.warning(a.instant("file_too_big"),"")):void 0},P.onCompleteItem=function(e,n,a,i){_(t.aplistdetailinfo.working[t.num],n,a),t.num++,t.num<t.aplistdetailinfo.working.length&&t.uploadflag.connect?t.restorefile(P.queue[0]):t.uploadflag.connect?t.restorefile(P.queue[0]):t.num=0},t.restorefile=function(e){t.uploadflag.connect?(t.num<t.aplistdetailinfo.working.length||(t.num=t.uploadflag.num,t.uploadflag.connect=!1),h(e)):bootbox.confirm(a.instant("restoreConfiguration"),function(n){if(n){if(t.aplistdetailinfo.working.length<1)return void p.warning(a.instant("havingNoApRestore"),"");""==t.uploadflag.mac?(L(),p.warning(a.instant("failedLocateConnAp"))):(t.uploadflag.connect=!0,h(e))}})},t.clearItems=function(){P.clearQueue()},t.checkAll=function(e){angular.forEach(t.aplistinfo,function(t){3==t.state&&(t.$checked=e)})},t.UpdateByUrl=function(e){var n=t.byurl;100==e?t.aplistdetailinfo.working.length<1?p.warning(a.instant("havingNoApUpgrade"),""):bootbox.confirm(a.instant("osupgradeVersionAllAp"),function(e){e&&s.putAll("/updatebyurl",n,function(e){for(var n=0;n<e.length;n++){var a=e[n].mac.toUpperCase(),i=!1,r=t.aplistdetailinfo.PVC[0].mac.toUpperCase();if(r==a&&(e[n].flag?(t.aplistdetailinfo.PVC[0].uploadFaseFlag=102,v(t.aplistdetailinfo.PVC[0].ip,t.aplistdetailinfo.PVC[0].mac,e[n])):(t.aplistdetailinfo.PVC[0].uploadFaseFlag=101,v(t.aplistdetailinfo.PVC[0].ip,t.aplistdetailinfo.PVC[0].mac,e[n]),i=!0)),!i)for(var s=0;s<t.aplistdetailinfo.SVC.length;s++){var r=t.aplistdetailinfo.SVC[s].mac.toUpperCase();if(r==a){e[n].flag?(t.aplistdetailinfo.SVC[s].uploadFaseFlag=102,v(t.aplistdetailinfo.SVC[s].ip,t.aplistdetailinfo.SVC[s].mac,e[n])):(t.aplistdetailinfo.SVC[s].uploadFaseFlag=101,v(t.aplistdetailinfo.SVC[s].ip,t.aplistdetailinfo.SVC[s].mac,e[n]),i=!0);break}}if(!i)for(var s=0;s<t.aplistdetailinfo.MEM.length;s++){var r=t.aplistdetailinfo.MEM[s].mac.toUpperCase();if(r==a){e[n].flag?(t.aplistdetailinfo.MEM[s].uploadFaseFlag=102,v(t.aplistdetailinfo.MEM[s].ip,t.aplistdetailinfo.MEM[s].mac,e[n])):(t.aplistdetailinfo.MEM[s].uploadFaseFlag=101,v(t.aplistdetailinfo.MEM[s].ip,t.aplistdetailinfo.MEM[s].mac,e[n]),i=!0);break}}}t.uploadflag.byurlflag||l.unlock(),t.uploadflag.byurlflag=!1},84e4)}):200==e&&bootbox.confirm(a.instant("osupgradeVersionAp"),function(e){if(e){var r=S+t.currentApInfo.ip+b+"/updatebyurl",s="upgrade_verion_log_name",o=[{ip:t.currentApInfo.ip,success:"module_operate_failure",msg:""}];l.lock(18e4),i.request("put",r,null,n,18e4,function(e){null!=e&&e.success?(o[0].success=e.result.flag,o[0].msg=e.result.msg,t.currentApInfo.mac.toUpperCase()==t.uploadflag.mac.toUpperCase()?k():l.unlock(),p.info("IP:"+t.currentApInfo.ip+"&nbsp;"+a.instant(e.result.msg),"")):(o[0].success="module_operate_failure",o[0].msg="ap_log_error_1",l.unlock(),p.warning("IP:"+t.currentApInfo.ip+"&nbsp;"+a.instant("uploadVersionByUrlF"),"")),d.setLog(s,o,null)},function(){l.unlock(),p.warning("IP:"+t.currentApInfo.ip+"&nbsp;msg:"+a.instant("failedServer"),""),o[0].success="module_operate_failure",o[0].msg="failedServer",d.setLog(s,o,null)})}})};var T=t.uploaderfirm=new o({removeAfterUpload:!1,headers:{Authorization:"sessionName "+window.localStorage.sessionId}});t.updatetype=0,t.clearItemsfirm=function(){T.clearQueue()},T.onAfterAddingFile=function(e){var n=/^[\w-\.]+\.bin$/,i=n.test(e.file.name.toLowerCase());if(!i)return t.clearItemsfirm(),void p.warning(a.instant("fileFormatbin"),"");var r=Math.floor(e.file.size/1024/1024);return r>20?(t.clearItemsfirm(),void p.warning(a.instant("file_too_big"),"")):void 0},T.onCompleteItem=function(e,n,a,i){1==t.updatetype?(t.num=0,C(t.currentApInfo,n,a,1)):2==t.updatetype&&(C(t.aplistdetailinfo.working[t.num],n,a,2),t.num++,t.num<t.aplistdetailinfo.working.length&&t.uploadflag.connect?t.UpdatetoAll(T.queue[0],2):t.uploadflag.connect?t.UpdatetoAll(T.queue[0],2):t.num=0)},t.UpdatetoAll=function(e,n){t.updatetype=n,1==n?bootbox.confirm(a.instant("osupgradeVersionAp"),function(n){n&&(""==t.uploadflag.mac?(L(),p.warning(a.instant("getinfoApF"))):(l.lock(42e4),e.url=S+t.currentApInfo.ip+b+"/updatefirm/"+e.file.name,e.upload()))}):2==n&&(t.uploadflag.connect?(t.num<t.aplistdetailinfo.working.length||(t.num=t.uploadflag.num,t.uploadflag.connect=!1),y(e)):bootbox.confirm(a.instant("osupgradeVersionAllAp"),function(n){if(n){if(t.aplistdetailinfo.working.length<1)return void p.warning(a.instant("havingNoApUpload"),"");""==t.uploadflag.mac?(L(),p.warning(a.instant("getinfoApF"))):(t.uploadflag.connect=!0,y(e))}}))},t.cancel=function(){n.close("test")}}]).filter("rolechange",[function(){var e=function(e){switch(e){case"3":return"Member";case"1":return"PVC";case"2":return"SVC"}};return e}]).filter("apStatusFilter",[function(){var e=function(e){switch(e){case"1":return"Joining";case"2":return"Initializing";case"3":return"Working";case"4":return"Down"}};return e}]),angular.module("main").filter("switchFilter",["$translate",function(e){var t=function(t){switch(t){case!0:return e.instant("Open");case!1:return e.instant("Close")}};return t}]),angular.module("main").run(["$rootScope","$interval","toastr","InterService","authentifiedRequest","permissions","clientService",function(e,t,n,a,i,r,s){$.ajax({async:!1,type:"get",url:"/haps",timeout:15e3,dataType:"json",headers:{Authorization:"sessionName "+window.localStorage.sessionId},error:function(){console.error("inithaps fail")},success:function(e){if(null!=e&&null!=e.result&&e.success){for(var t=!1,n=e.result.length;n>0;n--){e.result[n-1].hasOwnProperty("name")&&""!=e.result[n-1].name&&null!=e.result[n-1].name?e.result[n-1].apname=e.result[n-1].name:e.result[n-1].apname=e.result[n-1].mac,e.result[n-1].hasOwnProperty("version")||(e.result[n-1].version=" "),0==e.result[n-1].state&&(e.result[n-1].state="1");var i=s.getApClient(e.result[n-1].mac);null!=i?e.result[n-1].clients=i.length:e.result[n-1].clients=0,t||1==e.result[n-1].role&&(a.setPVCinfo(e.result[n-1].ip),t=!0)}a.setApListInfo(e.result)}else console.error("inithaps fail")}}),e.loading=!1,r.setPermissions(window.localStorage.username),i.get("/other/countryCode",null,function(e){null!=e&&e.success&&a.setCountryCode(e.countryFlag)})}]).controller("mainController",["$rootScope","$scope","$translate","singleModal","InterService","$interval","$translate","ClusterService","monitorService","$cookieStore","operationLog","APService","authentifiedRequest","$modal",function(e,t,n,a,i,r,n,s,o,l,c,u,p,d){function f(){null==l.get("lang")||"en"==l.get("lang")?(t.isEnglish=!0,t.isChiness=!1,t.isBoth=!1):"zh"==l.get("lang")&&(t.isEnglish=!1,t.isChiness=!0,t.isBoth=!1),null==l.get("cycleName")||"30s"==l.get("cycleName")?(l.put("cycleName","30s"),t.pollingCycleSelected=t.pollingCycles[0]):"60s"==l.get("cycleName")?t.pollingCycleSelected=t.pollingCycles[1]:"120s"==l.get("cycleName")&&(t.pollingCycleSelected=t.pollingCycles[2]),i.getSkin()}function g(){var e=r(function(){$(".pos-rts").hide(1e3),r.cancel(t.logTime)},3e3);t.logTime=e}function m(e){var n=r(function(){t.clientManagement.query(t.clientCallback),u.HttpGetPvcInfo()},1e3*e);h=n}t.isEnglish=!0,t.isChiness=!1,t.isBoth=!1,t.pollingCycleSelected={},t.pollingCycles=[{name:"30s"},{name:"60s"},{name:"120s"}],f(),t.langInterval={},t.setLang=function(e){var a="en_US";switch(e){case 0:a="en_US",l.put("lang","en"),t.isEnglish=!1,t.isChiness=!1,t.isBoth=!0,t.langInterval=r(function(){t.isBoth=!1,t.isEnglish=!0,t.isChiness=!1},3e3,1);break;case 1:a="zh_CH",l.put("lang","zh"),t.isEnglish=!1,t.isChiness=!1,t.isBoth=!0,t.langInterval=r(function(){t.isBoth=!1,t.isEnglish=!1,t.isChiness=!0},3e3,1);break;case 2:r.cancel(t.langInterval),a="en_US",l.put("lang","en"),t.isEnglish=!0,t.isChiness=!1,t.isBoth=!1;break;case 3:r.cancel(t.langInterval),a="zh_CH",l.put("lang","zh"),t.isEnglish=!1,t.isChiness=!0,t.isBoth=!1}n.use(a)},t.logs=[],t.logs_temp=[],t.logTime={},t.logClick=function(e){t.logs_temp=angular.copy(c.getLogs()),t.logs=t.logs_temp.reverse(),$(".pos-rts").show(1e3),g()},t.logLeave=function(){r.cancel(t.logTime),$(".pos-rts").hide(1e3)},t.cancelInterval=function(){r.cancel(t.logTime)},t.userName=window.localStorage.username,t.InterService=i,t.ClusterService=s,t.skin=i.skin,t.setSkin=i.setSkin,t.clusterInfo={},t.wlanManagement={},t.clientManagement={},t.skinInterval={},t.showSkinOption=function(){t.skin.isSelectSkin=!0,t.skinInterval=r(function(){t.skin.isSelectSkin=!1},3e3,1)},t.helpTip={isEabled:!1},t.helpButtonTip={title:n.instant("mouseMovedHelpViewInfo")},t.$watch("ClusterService.ClusterinfoSer",function(e,n){e!==n&&(t.clusterInfo=s.getClusterinfoSer(),t.showMonitorData(t.clusterInfo.cluster_name))},!0),t.clientCallback=function(){t.wlanManagement.query(),u.HttpGetApListInfo(function(){t.$broadcast("to-aplist-child",!0)}),o.updateChartview()};var _=parseInt(l.get("cycleName").trim()),h=null,v=null;e.$on("modal-to-main",function(e,t){null!=h&&r.cancel(h),null!=v&&r.cancel(v)}),u.HttpGetApListInfo(function(){t.$broadcast("to-aplist-child",!0)}),m(_),t.pollingChange=function(){r.cancel(h);var e=this.pollingCycleSelected.name;l.put("cycleName",e),_=parseInt(e.replace("s","").trim()),m(_)},t.showMonitorData=function(e){var n="Group: "+e;o.changeObser("cluster",null,n),t.clientManagement.changeClient("cluster",e);
},t.showAbout=function(){a.open({templateUrl:"common/about/about.html",controller:"aboutContronller",size:"md",backdrop:!0})},t.showTools=function(){a.open({templateUrl:"common/tools/tools.html",controller:"toolsContronller",size:"lg",backdrop:!0})},t.showHelp=function(){t.helpTip.isEabled=!t.helpTip.isEabled,1==t.helpTip.isEabled?t.helpButtonTip.title=n.instant("clickDisabledHelp"):t.helpButtonTip.title=n.instant("mouseMoveHelpCheckHelp")},t.getColorClass=function(){1==t.skin.isPurple?(t.menu_class="unfoldedlv1menupurple",t.icon_bg="selected_icon_purple"):(t.menu_class="unfoldedlv1menublue",t.icon_bg="selected_icon_blue")},$("#system_menu").click(function(){t.getColorClass();var e=$("#collapsesystem").hasClass("blackmenu");1==e?($("#collapsesystem").toggleClass("blackmenu",!1),$("#system_icon").attr("src","assets/images/up.png"),$("#collapsewireless").toggleClass("blackmenu",!0),$("#wireless_icon").attr("src","assets/images/down.png"),$("#collapseaccess").toggleClass("blackmenu",!0),$("#access_icon").attr("src","assets/images/down.png"),$("#system_title_bg").addClass(t.menu_class),$("#sys_left_iconbg").addClass(t.icon_bg),$("#sys_right_iconbg").addClass(t.icon_bg),$("#wireless_title_bg").removeClass(t.menu_class),$("#wire_left_iconbg").removeClass(t.icon_bg),$("#wire_right_iconbg").removeClass(t.icon_bg),$("#access_title_bg").removeClass(t.menu_class),$("#acc_left_iconbg").removeClass(t.icon_bg),$("#acc_right_iconbg").removeClass(t.icon_bg)):($("#system_icon").attr("src","assets/images/down.png"),$("#collapsesystem").toggleClass("blackmenu",!0),$("#system_title_bg").removeClass(t.menu_class),$("#sys_left_iconbg").removeClass(t.icon_bg),$("#sys_right_iconbg").removeClass(t.icon_bg))}),$("#wireless_menu").click(function(){t.getColorClass();var e=$("#collapsewireless").hasClass("blackmenu");1==e?($("#collapsewireless").toggleClass("blackmenu",!1),$("#wireless_icon").attr("src","assets/images/up.png"),$("#collapsesystem").toggleClass("blackmenu",!0),$("#system_icon").attr("src","assets/images/down.png"),$("#collapseaccess").toggleClass("blackmenu",!0),$("#access_icon").attr("src","assets/images/down.png"),$("#system_title_bg").removeClass(t.menu_class),$("#sys_left_iconbg").removeClass(t.icon_bg),$("#sys_right_iconbg").removeClass(t.icon_bg),$("#wireless_title_bg").addClass(t.menu_class),$("#wire_left_iconbg").addClass(t.icon_bg),$("#wire_right_iconbg").addClass(t.icon_bg),$("#access_title_bg").removeClass(t.menu_class),$("#acc_left_iconbg").removeClass(t.icon_bg),$("#acc_right_iconbg").removeClass(t.icon_bg)):($("#wireless_icon").attr("src","assets/images/down.png"),$("#collapsewireless").toggleClass("blackmenu",!0),$("#wireless_title_bg").removeClass(t.menu_class),$("#wire_left_iconbg").removeClass(t.icon_bg),$("#wire_right_iconbg").removeClass(t.icon_bg))}),$("#access_menu").click(function(){t.getColorClass();var e=$("#collapseaccess").hasClass("blackmenu");1==e?($("#collapseaccess").toggleClass("blackmenu",!1),$("#access_icon").attr("src","assets/images/up.png"),$("#collapsesystem").toggleClass("blackmenu",!0),$("#system_icon").attr("src","assets/images/down.png"),$("#collapsewireless").toggleClass("blackmenu",!0),$("#wireless_icon").attr("src","assets/images/down.png"),$("#system_title_bg").removeClass(t.menu_class),$("#sys_left_iconbg").removeClass(t.icon_bg),$("#sys_right_iconbg").removeClass(t.icon_bg),$("#wireless_title_bg").removeClass(t.menu_class),$("#wire_left_iconbg").removeClass(t.icon_bg),$("#wire_right_iconbg").removeClass(t.icon_bg),$("#access_title_bg").addClass(t.menu_class),$("#acc_left_iconbg").addClass(t.icon_bg),$("#acc_right_iconbg").addClass(t.icon_bg)):($("#access_icon").attr("src","assets/images/down.png"),$("#collapseaccess").toggleClass("blackmenu",!0),$("#access_title_bg").removeClass(t.menu_class),$("#acc_left_iconbg").removeClass(t.icon_bg),$("#acc_right_iconbg").removeClass(t.icon_bg))}),t.toggleManager={},$("#collapseOne").on("show.bs.collapse",function(e){"collapseOne"==e.target.id&&(t.toggleManager.ntpInit(),t.toggleManager.syslogInit(),t.toggleManager.clusterInit())}),$("#collapseOne").on("hidden.bs.collapse",function(e){"collapseOne"==e.target.id&&t.toggleManager.ntpDestory()}),$("#collapseTwo").on("show.bs.collapse",function(){t.toggleManager.rfInit(),t.toggleManager.rogueApInit(),t.toggleManager.otherInit()}),$("#collapseFour").on("show.bs.collapse",function(){t.toggleManager.getauthinfo(),t.toggleManager.aclGetRule(),t.toggleManager.getBlackList(),t.toggleManager.getWhiteList(),t.toggleManager.getWallList()}),t.f_logout=function(){p.post("/authentication/logout",null,null,function(e){window.location.href="/static/login.html"})},t.prompt=null;var w=r(function(){p.post("/authentication/sessionStatus",null,null,function(e){if(null!=e&&e.success){if(0==e.flag)return;if(null!=t.prompt)return;t.prompt=d.open({templateUrl:"logout-prompt.html",controller:"logoutPromptCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{flag:function(){return e.flag}}}),t.prompt.result.then(function(e){t.prompt=null},function(e){t.prompt=null})}},function(){})},1e4);v=w}]),$(document).ready(function(){$("#loading").hide(),$("#loaded").show()});